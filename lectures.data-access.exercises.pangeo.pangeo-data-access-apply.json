{"version":3,"kind":"Notebook","sha256":"32c8dc6ba7a01e53fd0af9bdbcb484db3c8aa52de8a3cd086198cea4b2ea5d69","slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-apply","location":"/lectures/2.3_data_access/exercises/pangeo/23_pangeo_data_access_apply.ipynb","dependencies":[],"frontmatter":{"title":"2.3 Data Access and Basic Processing","content_includes_title":true,"kernelspec":{"name":"conda-env-cubes-and-clouds-cubes-and-clouds-pangeo-py","display_name":"cubes-and-clouds-cubes-and-clouds-pangeo","language":"python"},"github":"https://github.com/EO-college/cubes-and-clouds","subject":"Cubes and Clouds learning materials","numbering":{"title":{"offset":3}},"source_url":"https://github.com/EO-college/cubes-and-clouds/blob/main/lectures/2.3_data_access/exercises/pangeo/23_pangeo_data_access_apply.ipynb","edit_url":"https://github.com/EO-college/cubes-and-clouds/edit/main/lectures/2.3_data_access/exercises/pangeo/23_pangeo_data_access_apply.ipynb","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","exports":[{"format":"ipynb","filename":"23_pangeo_data_access_apply.ipynb","url":"/cubes-and-clouds/build/23_pangeo_data_acces-df5bcdaef662314b418dd76c3984060c.ipynb"}]},"widgets":{"application/vnd.jupyter.widget-state+json":{"state":{"1ee75a6331134a04a06deabf8a654e5b":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{}},"a0a550207abd48ea9cef5da731f6b5f5":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"VBoxModel","state":{"layout":"IPY_MODEL_1ee75a6331134a04a06deabf8a654e5b"}}},"version_major":2,"version_minor":0}},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","children":[{"type":"image","style":{"float":"center","marginRight":"10px","marginLeft":"10px","maxHeight":"250px"},"url":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","alt":"Cubes & Clouds logo","key":"bucpmjIHXD","urlSource":"https://raw.githubusercontent.com/EO-College/cubes-and-clouds/main/icons/cnc_3icons_process_circle.svg"}],"key":"Z9uk6EmzVB"}],"key":"CiDIRuFln3"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.3 Data Access and Basic Processing","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CXWzKmCs5K"}],"identifier":"id-2-3-data-access-and-basic-processing","label":"2.3 Data Access and Basic Processing","html_id":"id-2-3-data-access-and-basic-processing","implicit":true,"key":"mQeGi85Po6"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"image","style":{"float":"center","marginRight":"10px","maxHeight":"80px"},"url":"/cubes-and-clouds/build/0f8adf2e4ec0feb14584840545a0ae3a.png","alt":"Pangeo logo","key":"FL7fTVfEH0","urlSource":"https://raw.githubusercontent.com/pangeo-data/pangeo.io/refs/heads/main/public/Pangeo-assets/pangeo_logo.png"}],"key":"JGYDRk0HEj"},{"type":"heading","depth":2,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Apply Operator with Pangeo ecosystem","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"J1Xw7bs1f2"}],"identifier":"apply-operator-with-pangeo-ecosystem","label":"Apply Operator with Pangeo ecosystem","html_id":"apply-operator-with-pangeo-ecosystem","implicit":true,"key":"Q0ci5CtXti"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The apply operator applies a process to each value in the data cube (i.e. a local operation).","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"HvkpGzxu5E"}],"key":"cfxZqXYzf3"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Letâ€™s start again with the same sample data from the Sentinel-2 STAC Collection, applying the filters directly in the ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Xp1P6Hac1o"},{"type":"inlineCode","value":"stackstac.stack","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ADYya3D7Dv"},{"type":"text","value":" call, to reduce the amount of data.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"tfD3CJXFDf"}],"key":"MggxDdDrJh"}],"key":"hQoTM9Ctp7"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import pystac_client\nimport stackstac\nimport xarray as xr","visibility":"show","key":"SrDTeotPc7"},{"type":"outputs","id":"ShC9VaIZ8Zv0kUu-GyOKS","children":[],"visibility":"show","key":"BOfGE2rPg1"}],"visibility":"show","key":"ZeofEQgXdj"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#                  West,     South,     East,      North\nspatial_extent = [11.259613, 46.461019, 11.406212, 46.522237]\ntemporal_extent = ['2022-07-10T00:00:00Z','2022-07-13T00:00:00Z']\nbands = [\"red\",\"green\",\"blue\"]","visibility":"show","key":"xkFIdySKNt"},{"type":"outputs","id":"VkOs7Pjv4BVTK1U2FT0Ce","children":[],"visibility":"show","key":"tnMGS4D4tm"}],"visibility":"show","key":"IoQupmS8Ru"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"URL = \"https://earth-search.aws.element84.com/v1\"\ncatalog = pystac_client.Client.open(URL)\ns2_items = catalog.search(\n    bbox=spatial_extent,\n    datetime=temporal_extent,\n    query=[\"eo:cloud_cover<50\"],\n    collections=[\"sentinel-2-l2a\"]\n).item_collection()\n\ns2_cube = stackstac.stack(s2_items,\n                     bounds_latlon=spatial_extent,\n                     assets=bands\n)\ns2_cube","visibility":"show","key":"FPF9E1m6GK"},{"type":"outputs","id":"VIPe6o3K-j2Kqqr8EvAWj","children":[],"visibility":"show","key":"x7dcAYbPKL"}],"visibility":"show","key":"ieSYXFAgZc"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize the RGB bands of our sample dataset:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"W9tNWyEYeo"}],"key":"fNnxE6qZiw"}],"key":"SsJ3GjZs4f"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"s2_cube.isel(time=0).plot.imshow()","visibility":"show","key":"kmpjYhu0JH"},{"type":"outputs","id":"ySo1bAytwCGgwP4RZdE1w","children":[],"visibility":"show","key":"W0FRDnPwkB"}],"visibility":"show","key":"HknfeFPe57"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Apply an arithmetic formula","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OmYlCkedkH"}],"identifier":"apply-an-arithmetic-formula","label":"Apply an arithmetic formula","html_id":"apply-an-arithmetic-formula","implicit":true,"key":"JlKh1sR2CF"}],"key":"PlW07iJn2e"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We would like to improve the previous visualization, rescaling all the pixels between 0 and 1.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RbNFHSTAWa"}],"key":"drpvH3Ymzc"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We can use ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Zh4WVJb8f4"},{"type":"inlineCode","value":"apply","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JFwJ3Id0vZ"},{"type":"text","value":" with an ad-hoc ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aNn3PB9U32"},{"type":"inlineCode","value":"rescale","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"egB0ryETtR"},{"type":"text","value":" function.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BS6tg9p72F"}],"key":"NWD1WcnVoF"}],"key":"TarXmPzSeI"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"input_min = -0.1\ninput_max = 0.2\noutput_min = 0\noutput_max = 1\n\n\ndef rescale(arr):\n    norm_arr = arr.clip(min=input_min, max=input_max)\n    norm_arr = ((norm_arr - input_min) / (input_max - input_min)) * (output_max - output_min) + output_min\n    return norm_arr\n\nscaled_data = s2_cube.to_dataset().apply(rescale)","visibility":"show","key":"H7w2r2kgj0"},{"type":"outputs","id":"cqhuoY1O4zg21WsuWfLcX","children":[],"visibility":"show","key":"iNuSGtokA0"}],"visibility":"show","key":"aBUGl6SeB8"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualise the scaled image","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kFXFxgFQHw"}],"identifier":"visualise-the-scaled-image","label":"Visualise the scaled image","html_id":"visualise-the-scaled-image","implicit":true,"key":"rDAI4i4lf1"}],"key":"oVypjJjHMf"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize the result and see how ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LbCHlJ7a2T"},{"type":"inlineCode","value":"apply","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gBGUrgBP6Q"},{"type":"text","value":" scaled the data resulting in a more meaningful visualization:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OsYQVyVRKx"}],"key":"GcM2GSDQb4"}],"key":"RoGjTXIWY1"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"scaled_data.to_dataarray().squeeze().plot.imshow()","visibility":"show","key":"ynEJwrsLIJ"},{"type":"outputs","id":"5YffSTLr2_ATGGhF6cvm1","children":[],"visibility":"show","key":"qKg7W4KCjT"}],"visibility":"show","key":"JEVeF3YBUd"}],"key":"JQK3yLjXlH"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"2.3 Data Access and Basic Processing","url":"/lectures/data-access/exercises/pangeo/pangeo-data-access-aggregate","group":"Data access with pangeo"},"next":{"title":"Data Formats and Performance","url":"/lectures/formats-and-performance/formats-and-performance","group":"Data formats for achieving scalability"}}},"domain":"http://localhost:3000"}