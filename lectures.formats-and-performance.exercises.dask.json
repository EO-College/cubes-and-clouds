{"version":3,"kind":"Notebook","sha256":"e4872f8a7dc7ea373cedaa741ad82c315e3880bf5067dc7a5229a20675a5a22a","slug":"lectures.formats-and-performance.exercises.dask","location":"/lectures/2.4_formats_and_performance/exercises/24_dask.ipynb","dependencies":[],"frontmatter":{"title":"2.4 Scaling with Pangeo","content_includes_title":false,"kernelspec":{"name":"conda-env-cubes-and-clouds-cubes-and-clouds-pangeo-dask-py","display_name":"cubes-and-clouds-cubes-and-clouds-pangeo-dask","language":"python"},"github":"https://github.com/EO-college/cubes-and-clouds","subject":"Cubes and Clouds learning materials","numbering":{"title":{"offset":3}},"source_url":"https://github.com/EO-college/cubes-and-clouds/blob/main/lectures/2.4_formats_and_performance/exercises/24_dask.ipynb","edit_url":"https://github.com/EO-college/cubes-and-clouds/edit/main/lectures/2.4_formats_and_performance/exercises/24_dask.ipynb","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","exports":[{"format":"ipynb","filename":"24_dask.ipynb","url":"/cubes-and-clouds/build/24_dask-6ae0e48f1a3a01781c9b9cee1a67f80b.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"image","style":{"float":"center","marginRight":"10px"},"url":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","alt":"Cubes & Clouds logo","key":"oKMmAhUHe9","urlSource":"https://raw.githubusercontent.com/EO-College/cubes-and-clouds/main/icons/cnc_3icons_process_circle.svg"}],"key":"qSCBmYm1Eh"}],"key":"iRwkPdlsxS"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"image","style":{"float":"center","marginRight":"10px"},"url":"/cubes-and-clouds/build/0f8adf2e4ec0feb14584840545a0ae3a.png","alt":"Pangeo logo","key":"WWGVFNUe03","urlSource":"https://raw.githubusercontent.com/pangeo-data/pangeo.io/refs/heads/main/public/Pangeo-assets/pangeo_logo.png"}],"key":"bXMlUNXPih"}],"key":"u6xi7gK1sR"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Parallel computing with Dask","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AcIqwP7h9I"}],"identifier":"parallel-computing-with-dask","label":"Parallel computing with Dask","html_id":"parallel-computing-with-dask","implicit":true,"key":"hXVqhm1SAs"}],"key":"QtZDJnkMy6"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"alert alert-info","children":[{"type":"emphasis","children":[],"key":"kw30WGLuAL"},{"type":"strong","children":[{"type":"text","value":"Overview","key":"mLsgY0wKNw"}],"key":"owvLVk3FV8"},{"type":"text","value":" ","key":"hdQWxBDWTt"},{"type":"break","key":"WrJpw2l4pz"},{"type":"break","key":"KpwP1Lo2Ux"},{"type":"strong","children":[{"type":"text","value":"Questions","key":"jzShBglrIs"}],"key":"XGNEVd6AI7"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"What is Dask?","key":"XctmzI1KGt"}],"key":"FZ6xWw1qZ6"}],"key":"xkUbMTrShM"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"How can I parallelize my data analysis with Dask?","key":"hENaPuZIlK"}],"key":"Tb6IbuEiPc"}],"key":"R5RAwtfHWS"}],"key":"YoendEllxC"},{"type":"strong","children":[{"type":"text","value":"Objectives","key":"KeR1ahBqkw"}],"key":"rZGI4AFG6n"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Learn about Dask","key":"pQrCQ84Uti"}],"key":"B3NNgxDYtv"}],"key":"cX5Hmseijw"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Learn about Dask Gateway, Dask Client, Scheduler, Workers","key":"nXFxpBaZTF"}],"key":"OSjaSGmAdN"}],"key":"Rl9d5u9GFy"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Understand out-of-core and speed-up limitations","key":"tz7D5QFq7i"}],"key":"eVVCjKhPYH"}],"key":"eZ3ystlNHo"}],"key":"bhQdQ4OACh"}],"key":"jM5HAQpJ1W"}],"key":"rTeMac4QSx"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Context","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NNA1ZxaHpL"}],"identifier":"context","label":"Context","html_id":"context","implicit":true,"key":"BKYAXGnUYl"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We will be using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YbFGTCGa4S"},{"type":"link","url":"https://docs.dask.org/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Dask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"f1ko5yqKlM"}],"urlSource":"https://docs.dask.org/","key":"GhJFLlSOCv"},{"type":"text","value":" with ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CtrmJtCHm1"},{"type":"link","url":"https://docs.xarray.dev/en/stable/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Xarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mJkgRls3JP"}],"urlSource":"https://docs.xarray.dev/en/stable/","key":"YBPuTGvMld"},{"type":"text","value":" to parallelize our data analysis.  We will continue to use the NDVI example.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lYKRqIWVLd"}],"key":"INKyoQmAxa"}],"key":"aOyydv4usv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Parallelize with Dask","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cG0YTrwhju"}],"identifier":"parallelize-with-dask","label":"Parallelize with Dask","html_id":"parallelize-with-dask","implicit":true,"key":"TgQ0xoPgMg"}],"key":"dpYP8SeUdP"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We know from the previous exercise ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"W79QgMHWhA"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.4_chunking","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qwgM0Max9J"}],"key":"ijIT5zwE8t"},{"type":"text","value":" that chunking is key to analyzing large data sets. In this exercise, we will learn how to parallelize our data analysis using ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Fkzk0XPDCj"},{"type":"link","url":"https://docs.dask.org/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Dask","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GBbX0m1Mgl"}],"urlSource":"https://docs.dask.org/","key":"gvoi9ZQuy4"},{"type":"text","value":" on our chunked dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Nyb5Pg7tyA"}],"key":"Pb7m5KGHIe"}],"key":"fAho3TuZFO"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"What is ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"c4akxaPGBc"},{"type":"link","url":"https://docs.dask.org/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Dask","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mS6sZrnbP3"}],"urlSource":"https://docs.dask.org/","key":"ZdbSW0H9Mj"},{"type":"text","value":" ?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zjBDG43rbo"}],"identifier":"what-is-dask","label":"What is Dask ?","html_id":"what-is-dask","implicit":true,"key":"qZCmQXNjJE"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Dask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LTRcu1So64"}],"key":"mbXWOwhcUE"},{"type":"text","value":" is a powerful and flexible library for parallel computing in Python. It enables users to scale their computations effortlessly while working with large datasets that exceed available memory.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bz8aPZlebb"}],"key":"ocARcorqKI"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"With minimal code changes, Dask accelerates existing Python libraries such as NumPy, Pandas, and Scikit-learn.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rgTfKZktup"}],"key":"SPZ3wDUtmw"}],"key":"EcSVeBr8wY"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Designed for processing massive datasets, Dask is widely used in Earth Science and other data-intensive fields.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"QeG4Hzo2jX"}],"key":"iIFpwqPhds"}],"key":"TItVOLkDZ0"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"It scales effortlessly from a single laptop to clusters, cloud environments, and HPC systems.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"PWqMFv2ctJ"}],"key":"OBVOf8vJs2"}],"key":"cUrLEkAj9G"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Dask bridges the gap between exploratory analysis and large-scale production workflows.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"CpP91zhrEw"}],"key":"VcFazmGy12"}],"key":"nys8G5HTje"}],"key":"NUb65hYo9p"}],"key":"OAVl7Ia6U6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"How does Dask scale and accelerate your data analysis?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K6t8r25fdt"}],"identifier":"how-does-dask-scale-and-accelerate-your-data-analysis","label":"How does Dask scale and accelerate your data analysis?","html_id":"how-does-dask-scale-and-accelerate-your-data-analysis","implicit":true,"key":"Yt1E1PQfFQ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"link","url":"https://docs.dask.org/en/stable/10-minutes-to-dask.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Dask proposes different abstractions to distribute your computation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pcWG7uNETT"}],"urlSource":"https://docs.dask.org/en/stable/10-minutes-to-dask.html","key":"WEv8zMGQXr"},{"type":"text","value":". In this ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QVxRkJDXGp"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Dask Introduction","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZQJEAyNyRX"}],"key":"jxydHYSZ2r"},{"type":"text","value":" section, we will focus on ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FTQXMMecml"},{"type":"link","url":"https://docs.dask.org/en/stable/array.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Dask Array","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BS7vcbg347"}],"urlSource":"https://docs.dask.org/en/stable/array.html","key":"BVfDwWnmkJ"},{"type":"text","value":" which is widely used in the Pangeo ecosystem as a backend of Xarray.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"L8ffXkaCJc"}],"key":"Rv11zG7PiE"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The chunks of a Dask Array are standard NumPy arrays. By transforming large datasets into Dask Arrays and utilizing chunks, a large array is handled as many smaller NumPy arrays. This allows us to compute each of these chunks independently.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"mVyjzo9zyV"}],"key":"wdKsMZUQqn"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"image","url":"/cubes-and-clouds/build/8476ef8dfea9da4ad663e93b475cbbe7.svg","alt":"Dask and Numpy","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"L95GBRnpEu","urlSource":"https://examples.dask.org/_images/dask-array-black-text.svg"},{"type":"break","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"WMrjcaJZVL"},{"type":"emphasis","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Image source: Dask documentation (© 2025 Dask core developers, BSD-3 Licensed).","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"oZvB5rOsMe"}],"key":"N1IG2XAHZl"}],"key":"Nr1KuWNGeE"}],"key":"AFo2buBwls"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"alert alert-info","children":[{"type":"emphasis","children":[],"key":"jIV072l7hj"},{"type":"strong","children":[{"type":"text","value":"Note","key":"mIz1yvHZhK"}],"key":"bSGN0DIT6o"},{"type":"break","key":"QciXHqEXn1"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Xarray uses Dask Arrays instead of Numpy when chunking is enabled, and thus all Xarray operations are performed through Dask, which enables distributed processing.","key":"Pz5poEvOr9"}],"key":"v8h3phbyTC"}],"key":"qNyphJBuwZ"}],"key":"zbuORbJdla"}],"key":"amXFsd9A2p"}],"key":"FWFZzZxcwe"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"How does Xarray with Dask distribute data analysis?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DN2hVp4awQ"}],"identifier":"how-does-xarray-with-dask-distribute-data-analysis","label":"How does Xarray with Dask distribute data analysis?","html_id":"how-does-xarray-with-dask-distribute-data-analysis","implicit":true,"key":"dLjjjniQWK"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"When we use chunks with Xarray, the real computation is only done when needed or explicitly requested, usually by invoking the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eO78GxT5cm"},{"type":"inlineCode","value":"compute()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BClQheagft"},{"type":"text","value":" or ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aKbiJR16pt"},{"type":"inlineCode","value":"load()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DtyePbvuo9"},{"type":"text","value":" functions. Dask generates a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FWaof41lEM"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"task graph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Re3FZEY5sC"}],"key":"JiGKNDqfvz"},{"type":"text","value":" describing the computations to be performed. When using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zfXYupfHkv"},{"type":"link","url":"https://distributed.dask.org/en/stable/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Dask Distributed","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LTF9Rs8hk8"}],"urlSource":"https://distributed.dask.org/en/stable/","key":"vioWSPN72U"},{"type":"text","value":", a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EAcxaKGbNs"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Scheduler","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"B6y2UbnFXI"}],"key":"gOgDR9jvZP"},{"type":"text","value":" distributes these tasks across several ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AlbPmYPTEQ"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Workers","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dh9IEqHiCK"}],"key":"i140B3D23Y"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rstzlkpyci"}],"key":"Am2Xq8X7EN"},{"type":"image","url":"/cubes-and-clouds/build/be3fbd3e89d036a01dd22375bae5e36e.png","alt":"Xarray with dask","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"HjD2l3Q0eP","urlSource":"https://raw.githubusercontent.com/EO-College/cubes-and-clouds/refs/heads/main/lectures/2.4_formats_and_performance/exercises/assets/dask-xarray-explained.png"}],"key":"QLBm40nWG6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"What is a Dask Distributed cluster?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jj8WIYOQ0B"}],"identifier":"what-is-a-dask-distributed-cluster","label":"What is a Dask Distributed cluster?","html_id":"what-is-a-dask-distributed-cluster","implicit":true,"key":"sjUlvfiUWf"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"A Dask Distributed cluster is made up of two main components:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TwN3T6bQWC"}],"key":"v8HmHNxwLi"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"kTdaDgayvh"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Scheduler","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jJkpymw6Zy"}],"key":"c075ZKIEJQ"},{"type":"text","value":", responsible for handling the computation graph and distributing tasks to Workers.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"k2bpj3gtyf"}],"key":"MvhrNHO3f8"}],"key":"br9t34onL2"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"One or several ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"qjdYSUfyvF"},{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Workers","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"z0OaSQC3wB"}],"key":"HIdzUknqaj"},{"type":"text","value":", which compute individual tasks and store results and data in distributed memory (RAM and/or the worker’s local disk).","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"pkUeeu8Fr7"}],"key":"BXzJgwZoRT"}],"key":"DKUQtUyeBg"}],"key":"k8e2iSyrls"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"A user typically needs ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Q1ELwmNHhv"},{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Client","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"giQ5L5MXXr"}],"key":"wEWR0mPqAD"},{"type":"text","value":" and ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"WnV0WL7pwK"},{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Cluster","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"g3JYyMhoqM"}],"key":"fqnVfhI5xN"},{"type":"text","value":" objects, as shown below, to use Dask Distributed.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"G2ZBj88ywb"}],"key":"e0sJPvzcbf"},{"type":"image","url":"/cubes-and-clouds/build/5f88b4250ac348093751d7c8111d1944.png","alt":"Dask Distributed Cluster","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"pifTRT6FuT","urlSource":"https://user-images.githubusercontent.com/306380/66413985-27111600-e9be-11e9-9995-8f418ff48f8a.png"}],"key":"zM67FdqxwS"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Where can we deploy a Dask distributed cluster?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"U0OTJ2ME2D"}],"identifier":"where-can-we-deploy-a-dask-distributed-cluster","label":"Where can we deploy a Dask distributed cluster?","html_id":"where-can-we-deploy-a-dask-distributed-cluster","implicit":true,"key":"lECRhIFaZZ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"link","url":"https://docs.dask.org/en/stable/deploying.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Dask distributed clusters can be deployed on your laptop or on distributed infrastructures (Cloud, HPC centers, Hadoop, etc.).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Jkt5s0IEA0"}],"urlSource":"https://docs.dask.org/en/stable/deploying.html","key":"JL5idkTisF"},{"type":"text","value":"  Dask distributed ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RTiY0inwUQ"},{"type":"inlineCode","value":"Cluster","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uCrFt7lx6d"},{"type":"text","value":" object is responsible of deploying and scaling a Dask Cluster on the underlying resources.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GtQKaTKpGm"}],"key":"cZ0909klyT"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"image","url":"/cubes-and-clouds/build/5bb4678f8c7e666155eecf57b9320e34.svg","alt":"Dask Cluster deployment","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"pifRHus0vC","urlSource":"https://docs.dask.org/en/stable/_images/dask-cluster-manager.svg"},{"type":"emphasis","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Image source: Dask documentation (© 2025 Dask core developers, BSD-3 Licensed).","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"adzzanM9o1"}],"key":"fwZdhoHPBB"}],"key":"zMvX3aUHLk"}],"key":"ukgRkEG6Zu"},{"type":"block","kind":"notebook-content","children":[{"type":"blockquote","position":{"start":{"line":1,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Tip","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PnTRL0niel"},{"type":"break","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zVB7B9sHPO"},{"type":"text","value":"A Dask ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YO9lJNveEx"},{"type":"inlineCode","value":"Cluster","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SBpqy9V6wV"},{"type":"text","value":" can be created on a single machine (e.g. your laptop), which means you do not need dedicated computing resources. This corresponds to ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ey7Y7JgfHn"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Vertical scaling","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oZ9B6Qkp4I"}],"key":"Pvtvdm3u4A"},{"type":"text","value":" as described in lecture ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iCg80dN8NT"},{"type":"link","url":"/lectures/formats-and-performance/formats-and-performance","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.4 Formats and Performance","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ExzpBZiwqt"}],"urlSource":"../2.4_formats_and_performance.md","dataUrl":"/lectures.formats-and-performance.formats-and-performance.json","internal":true,"protocol":"file","key":"WYgCLuXWTf"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"x1LGGqN2I8"}],"key":"t2kHxGFxqp"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"However, the speed up is limited to the resources of your single machine. This is where ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"t2UvZCr9Ap"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"horizontal scaling","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"aZuYoJ0CKa"}],"key":"WSo6F75IHv"},{"type":"text","value":" comes in.  By adding resources from other machines, you can expand your computing power!","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"MdOS42H9P9"}],"key":"drEwquc9mc"}],"key":"E1MCGH1bKo"}],"key":"H9lflzmhOj"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Dask distributed Client","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j3RmbE0Mx4"}],"identifier":"dask-distributed-client","label":"Dask distributed Client","html_id":"dask-distributed-client","implicit":true,"key":"N2qvc7wud7"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The Dask distributed ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jo6tZs0Vv9"},{"type":"inlineCode","value":"Client","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eeDo74iCVw"},{"type":"text","value":" is what allows you to interact with Dask distributed Clusters. When using Dask distributed, you always need to create a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ygxe4p8gwq"},{"type":"inlineCode","value":"Client","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QGkJ0XFEOS"},{"type":"text","value":" object. Once a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QPSNIJGEg8"},{"type":"inlineCode","value":"Client","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vhW2nBX2cu"},{"type":"text","value":" has been created, it will be used by default by each call to a Dask API, even if you do not explicitly use it.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GxRR03cHml"}],"key":"e9p1z45cZ5"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"No matter the Dask API (e.g. Arrays, Dataframes, Delayed, Futures, etc.) that you use, under the hood, Dask will create a Directed Acyclic Graph (DAG) of tasks by analysing the code. Client will be responsible to submit this DAG to the Scheduler along with the final result you want to compute. The Client will also gather results from the Workers, and aggregate it back in its underlying Python process.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"S0TXp69d39"}],"key":"rez7uq5UgU"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Using ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"kFAg8p0RFf"},{"type":"inlineCode","value":"Client()","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"U4JrEWJY8k"},{"type":"text","value":" function with no argument, you will create a local Dask cluster with a number of workers and threads per worker corresponding to the number of cores in the ‘local’ machine. The ‘local’ machine is the jupyterlab you are using in the Cloud, and the number of cores is the number of cores available in the cloud instance (not on your laptop).","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"aIP6Ms7CAk"}],"key":"Nwpuuz2vny"}],"key":"ad3MTDtuRQ"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from dask_gateway import JupyterHubAuth, Gateway\ngateway = Gateway()\ncluster_options = gateway.cluster_options()\ncluster = gateway.new_cluster(cluster_options=cluster_options)\ncluster.scale(3)  # create a local dask cluster on the local machine specifying 3\nclient = cluster.get_client()\nclient","visibility":"show","key":"a28AeejV5N"},{"type":"outputs","id":"zyk1wFdhv_l-IUvrxknRt","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":1,"metadata":{},"data":{"text/html":{"content":"<div>\n    <div style=\"width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;\"> </div>\n    <div style=\"margin-left: 48px;\">\n        <h3 style=\"margin-bottom: 0px;\">Client</h3>\n        <p style=\"color: #9D9D9D; margin-bottom: 0px;\">Client-f149272f-05be-11f1-82f7-0255ac10009f</p>\n        <table style=\"width: 100%; text-align: left;\">\n\n        <tr>\n        \n            <td style=\"text-align: left;\"><strong>Connection method:</strong> Cluster object</td>\n            <td style=\"text-align: left;\"><strong>Cluster type:</strong> dask_gateway.GatewayCluster</td>\n        \n        </tr>\n\n        \n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Dashboard: </strong> <a href=\"https://hub.earthcode.eox.at/services/eoxhub-gateway/cubes-and-clouds/traefik-dask-gateway/clusters/cubes-and-clouds.2c86221c2f1a4c72acb054d2ad2da70f/status\" target=\"_blank\">https://hub.earthcode.eox.at/services/eoxhub-gateway/cubes-and-clouds/traefik-dask-gateway/clusters/cubes-and-clouds.2c86221c2f1a4c72acb054d2ad2da70f/status</a>\n                </td>\n                <td style=\"text-align: left;\"></td>\n            </tr>\n        \n\n        </table>\n\n        \n\n        \n            <details>\n            <summary style=\"margin-bottom: 20px;\"><h3 style=\"display: inline;\">Cluster Info</h3></summary>\n            <div style='background-color: #f2f2f2; display: inline-block; padding: 10px; border: 1px solid #999999;'>\n  <h3>GatewayCluster</h3>\n  <ul>\n    <li><b>Name: </b>cubes-and-clouds.2c86221c2f1a4c72acb054d2ad2da70f\n    <li><b>Dashboard: </b><a href='https://hub.earthcode.eox.at/services/eoxhub-gateway/cubes-and-clouds/traefik-dask-gateway/clusters/cubes-and-clouds.2c86221c2f1a4c72acb054d2ad2da70f/status' target='_blank'>https://hub.earthcode.eox.at/services/eoxhub-gateway/cubes-and-clouds/traefik-dask-gateway/clusters/cubes-and-clouds.2c86221c2f1a4c72acb054d2ad2da70f/status</a>\n  </ul>\n</div>\n\n            </details>\n        \n\n    </div>\n</div>","content_type":"text/html"},"text/plain":{"content":"<Client: 'tls://172.16.0.66:8786' processes=0 threads=0, memory=0 B>","content_type":"text/plain"}}},"children":[],"key":"YbJU9t2b1Q"}],"visibility":"show","key":"v72Yss9lRV"}],"visibility":"show","key":"Td0o2Sseli"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Inspecting the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bKFGYQFqVr"},{"type":"inlineCode","value":"Cluster Info","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MO4yUweNDY"},{"type":"text","value":" section above gives us information about the created cluster: we have 2 or 4 workers and the same number of threads (e.g. 1 thread per worker).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Lf9wC0QQsx"}],"key":"REN9PjN3tf"}],"key":"IIgiJEUSH7"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"alert alert-warning","children":[{"type":"emphasis","children":[],"key":"oVFQSRl6PV"},{"type":"strong","children":[{"type":"text","value":"Go further","key":"ZqHjvWNKhE"}],"key":"peEuYUSPLH"},{"type":"break","key":"WUiA1SitKB"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"You can also create a local cluster with the `LocalCluster` constructor and use `n_workers` and `threads_per_worker` to manually specify the number of processes and threads you want to use. For instance, we could use `n_workers=2` and `threads_per_worker=2`.","key":"TAQ4CuwseN"}],"key":"gnz5xAJKLI"}],"key":"Jk9kjwdayf"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"This is sometimes preferable (in terms of performance), or when you run this tutorial on your PC, you can avoid dask to use all your resources you have on your PC!","key":"BRxfCve3Q4"}],"key":"CSaq6gi5bn"}],"key":"Y8Q2VQmFFG"}],"key":"jiv0iD3uaH"}],"key":"ECh9Gux15V"}],"key":"hHNgOkAWwQ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Dask Dashboard","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kNpWtDdea9"}],"identifier":"dask-dashboard","label":"Dask Dashboard","html_id":"dask-dashboard","implicit":true,"key":"khOt5Ju7z0"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Dask comes with a really handy interface: the Dask Dashboard. It is a web interface that you can open in a separate tab of your browser.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"f3BJHjqQEJ"}],"key":"Lc1x2xLrLQ"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We will learn how to use it through the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TC8mW6Z1lZ"},{"type":"link","url":"https://github.com/dask/dask-labextension","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"dask jupyterlab extension","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"pu0rFxQxYs"}],"urlSource":"https://github.com/dask/dask-labextension","error":true,"key":"GgASEyXoLp"},{"type":"text","value":".","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"d018VqWMJj"}],"key":"MWLtB7Gk0P"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"To use Dask Dashboard through jupyterlab extension,\nyou just need to click on the orange icon shown in the following figure,","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"VTjNjq8Gcm"}],"key":"JR5mQAjkup"},{"type":"image","url":"/cubes-and-clouds/build/13301335bb11e404715202634c4bb6c0.png","alt":"Dask.array","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"DTt1gj0l7D","urlSource":"https://raw.githubusercontent.com/EO-College/cubes-and-clouds/refs/heads/main/lectures/2.4_formats_and_performance/exercises/assets/dashboardlink.png"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"You can click several buttons marked with blue arrows in the following images, and then drag and drop them wherever you want.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"xaVAjo9JmN"}],"key":"AukHiQIWMy"},{"type":"image","url":"/cubes-and-clouds/build/7cd9c2228eabbba5874d10af09e69bf8.png","alt":"Dask.array","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"x6aopkafrY","urlSource":"https://raw.githubusercontent.com/EO-College/cubes-and-clouds/refs/heads/main/lectures/2.4_formats_and_performance/exercises/assets/dasklab.png"},{"type":"image","url":"/cubes-and-clouds/build/4ab5130b44730782abf1860db4574b53.png","alt":"Dask.array","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"Nvy7XK158X","urlSource":"https://raw.githubusercontent.com/EO-College/cubes-and-clouds/refs/heads/main/lectures/2.4_formats_and_performance/exercises/assets/exampledasklab.png"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"It’s really helpful to understand your computation and how it’s distributed.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"fE6d47nTnU"}],"key":"ssN7qtzxCg"}],"key":"hemCiVQUot"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Dask Distributed computations on our dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"boQFHF5KEa"}],"identifier":"dask-distributed-computations-on-our-dataset","label":"Dask Distributed computations on our dataset","html_id":"dask-distributed-computations-on-our-dataset","implicit":true,"key":"NP5P6aegW0"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Let’s open the Zarr dataset we’ve prepared in ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nVxf6Lqa6u"},{"type":"link","url":"/lectures/formats-and-performance/exercises/chunking","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"previous chunking excersise","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Z9Milzip5z"}],"urlSource":"./24_chunking.ipynb","dataUrl":"/lectures.formats-and-performance.exercises.chunking.json","internal":true,"protocol":"file","key":"jKqAqgIVPa"},{"type":"text","value":", select a single location over time, visualize the task graph generated by Dask, and observe the Dask Dashboard.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LTvtxVAfof"}],"key":"eBe7uRBUPH"}],"key":"JHb9BTnAKA"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nndvi = xr.open_zarr('test.zarr')\nndvi","visibility":"show","key":"YUG8TYkZBW"},{"type":"outputs","id":"2FrKCt7JCADnaZozp1-BU","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"812b9c096b38c45cef792f5a74133dc6","path":"/cubes-and-clouds/build/812b9c096b38c45cef792f5a74133dc6.html"},"text/plain":{"content":"<xarray.Dataset> Size: 211MB\nDimensions:                                  (time: 3, y: 3341, x: 2630)\nCoordinates: (12/33)\n    constellation                            <U10 40B ...\n    created                                  (time) <U24 288B dask.array<chunksize=(3,), meta=np.ndarray>\n    earthsearch:boa_offset_applied           (time) bool 3B dask.array<chunksize=(3,), meta=np.ndarray>\n    earthsearch:payload_id                   (time) <U74 888B dask.array<chunksize=(3,), meta=np.ndarray>\n    earthsearch:s3_path                      (time) <U79 948B dask.array<chunksize=(3,), meta=np.ndarray>\n    eo:cloud_cover                           (time) float64 24B dask.array<chunksize=(3,), meta=np.ndarray>\n    ...                                       ...\n  * time                                     (time) datetime64[ns] 24B 2019-0...\n    updated                                  (time) <U24 288B dask.array<chunksize=(3,), meta=np.ndarray>\n    view:sun_azimuth                         (time) float64 24B dask.array<chunksize=(3,), meta=np.ndarray>\n    view:sun_elevation                       (time) float64 24B dask.array<chunksize=(3,), meta=np.ndarray>\n  * x                                        (x) float64 21kB 6.543e+05 ... 6...\n  * y                                        (y) float64 27kB 5.202e+06 ... 5...\nData variables:\n    data                                     (time, y, x) float64 211MB dask.array<chunksize=(1, 3341, 2630), meta=np.ndarray>\n    spatial_ref                              int64 8B ...","content_type":"text/plain"}}},"children":[],"key":"kNlr05sMoo"}],"visibility":"show","key":"sNcX19r0kq"}],"visibility":"show","key":"cxrdftLElX"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ndvi['data'].mean(dim='x')","visibility":"show","key":"viVqDJMaRP"},{"type":"outputs","id":"UZ-AoN_f1fsmDjdRGsNAQ","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"4f804197ed6af80e3f9198f23c247013","path":"/cubes-and-clouds/build/4f804197ed6af80e3f9198f23c247013.html"},"text/plain":{"content":"<xarray.DataArray 'data' (time: 3, y: 3341)> Size: 80kB\ndask.array<mean_agg-aggregate, shape=(3, 3341), dtype=float64, chunksize=(1, 3341), chunktype=numpy.ndarray>\nCoordinates: (12/32)\n    constellation                            <U10 40B ...\n    created                                  (time) <U24 288B dask.array<chunksize=(3,), meta=np.ndarray>\n    earthsearch:boa_offset_applied           (time) bool 3B dask.array<chunksize=(3,), meta=np.ndarray>\n    earthsearch:payload_id                   (time) <U74 888B dask.array<chunksize=(3,), meta=np.ndarray>\n    earthsearch:s3_path                      (time) <U79 948B dask.array<chunksize=(3,), meta=np.ndarray>\n    eo:cloud_cover                           (time) float64 24B dask.array<chunksize=(3,), meta=np.ndarray>\n    ...                                       ...\n    s2:sequence                              (time) <U1 12B dask.array<chunksize=(3,), meta=np.ndarray>\n  * time                                     (time) datetime64[ns] 24B 2019-0...\n    updated                                  (time) <U24 288B dask.array<chunksize=(3,), meta=np.ndarray>\n    view:sun_azimuth                         (time) float64 24B dask.array<chunksize=(3,), meta=np.ndarray>\n    view:sun_elevation                       (time) float64 24B dask.array<chunksize=(3,), meta=np.ndarray>\n  * y                                        (y) float64 27kB 5.202e+06 ... 5...","content_type":"text/plain"}}},"children":[],"key":"XBqFH7kjPq"}],"visibility":"show","key":"AhUBp6bvMi"}],"visibility":"show","key":"Fa6rawAswj"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Did you notice something on the Dask Dashboard when running the two previous cells?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"b5DTxnHd6C"}],"identifier":"did-you-notice-something-on-the-dask-dashboard-when-running-the-two-previous-cells","label":"Did you notice something on the Dask Dashboard when running the two previous cells?","html_id":"did-you-notice-something-on-the-dask-dashboard-when-running-the-two-previous-cells","implicit":true,"key":"Ff7kDE3lVF"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We didn’t actually ‘compute’ anything. Instead, we built a Dask task graph, with its size indicated as a count above, but we didn’t ask Dask to return a result.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tUkSa6UlFN"}],"key":"tsbp9mXA8C"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"You can check the ‘Dask graph’ to see how many layers it contains, which will help you estimate the complexity of your computation.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"dEmVuE9RDT"}],"key":"LtO2qlXrKH"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"It shows that you have ‘4 graphs’. This can be optimized in the following steps.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"xQu2He8D8T"}],"key":"tCjO5hKPRP"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Let’s try to plot the Dask graph before computation and understand what the Dask workers will do to compute the result we asked for.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"N4zam6v6DB"}],"key":"iFMWELjelE"}],"key":"YMfYVfopdq"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ndvi['data'].mean(dim='x').data.visualize()","visibility":"show","key":"iUJcd0JaJ5"},{"type":"outputs","id":"TQrzHfxjEj3k6PcmDzC7-","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a78728d610c2e609a5f1add6ab18f2e7","path":"/cubes-and-clouds/build/a78728d610c2e609a5f1add6ab18f2e7.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"KfwAbPKzyM"}],"visibility":"show","key":"J5fksYC27u"}],"visibility":"show","key":"kGRcAuFUIU"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s average the time dimension and see how it differs","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"y3oacUlyaA"}],"key":"ar0nBABycS"}],"key":"CHJBsPDAhR"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ndvi['data'].mean(dim='time').data.visualize()","visibility":"show","key":"VuWIwdEoIh"},{"type":"outputs","id":"q-qAKOTzg2ySI4p_IetAL","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"34ac92f8bda7f141afe66629fa929a72","path":"/cubes-and-clouds/build/34ac92f8bda7f141afe66629fa929a72.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"ZnXym4012V"}],"visibility":"show","key":"KRJ0KSPGjl"}],"visibility":"show","key":"L0H6ik10jx"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s compute on the Dask workers","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pGiMJrenvl"}],"identifier":"lets-compute-on-the-dask-workers","label":"Let’s compute on the Dask workers","html_id":"lets-compute-on-the-dask-workers","implicit":true,"key":"EkLvuGILjS"}],"key":"nnH04cfW8R"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ndvi['data'].mean(dim='time').compute()","visibility":"show","key":"jo0eNI02b5"},{"type":"outputs","id":"aTSZ2yXbBf9IRzcr0-Z6s","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"347413654911640ae6eb0465e76f4112","path":"/cubes-and-clouds/build/347413654911640ae6eb0465e76f4112.html"},"text/plain":{"content":"<xarray.DataArray 'data' (y: 3341, x: 2630)> Size: 70MB\narray([[nan, nan, nan, ..., nan, nan, nan],\n       [nan, nan, nan, ..., nan, nan, nan],\n       [nan, nan, nan, ..., nan, nan, nan],\n       ...,\n       [nan, nan, nan, ..., nan, nan, nan],\n       [nan, nan, nan, ..., nan, nan, nan],\n       [nan, nan, nan, ..., nan, nan, nan]], shape=(3341, 2630))\nCoordinates:\n    constellation                            <U10 40B 'sentinel-2'\n    epsg                                     int64 8B 32632\n    gsd                                      int64 8B 10\n    instruments                              <U3 12B 'msi'\n    mgrs:latitude_band                       <U1 4B 'T'\n    mgrs:utm_zone                            int64 8B 32\n    proj:epsg                                int64 8B 32632\n    s2:datatake_type                         <U8 32B 'INS-NOBS'\n    s2:product_type                          <U7 28B 'S2MSI2A'\n    s2:saturated_defective_pixel_percentage  int64 8B 0\n  * x                                        (x) float64 21kB 6.543e+05 ... 6...\n  * y                                        (y) float64 27kB 5.202e+06 ... 5...","content_type":"text/plain"}}},"children":[],"key":"ezTTmROtxy"}],"visibility":"show","key":"Tc7lFjZtnt"}],"visibility":"show","key":"Lf4AtxDPer"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Calling compute on our Xarray object triggered the execution on Dask Cluster side.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CWKRy1HS4J"}],"key":"JoBTS0dY5z"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"You should be able to see how Dask is working on Dask Dashboard.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QuC6Tg6DpN"}],"key":"o8kP7qbpan"}],"key":"g7s31TyXkR"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s try a bigger computation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K7VD0RRQw5"}],"identifier":"lets-try-a-bigger-computation","label":"Let’s try a bigger computation","html_id":"lets-try-a-bigger-computation","implicit":true,"key":"po5BXyfSEA"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We will re-use the procedure we’ve learned in the previous chunking notebook.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"bIvOnKkpOT"}],"key":"AZye4oOGU0"}],"key":"msy7ssvLCt"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"### Load data using stackstac (with specific chunk) \nimport stackstac\nimport pystac_client\nimport geopandas as gpd\nfrom shapely.geometry import mapping\nimport numpy as np\nimport warnings\nimport rioxarray\n\nwarnings.filterwarnings(\"ignore\")\nwarnings.simplefilter(\"ignore\", RuntimeWarning)\n\naoi = gpd.read_file('./assets/catchment_outline.geojson', crs=\"EPGS:4326\")\naoi_geojson = mapping(aoi.iloc[0].geometry)\nURL = \"https://earth-search.aws.element84.com/v1\"\ncatalog = pystac_client.Client.open(URL)\nitems = catalog.search(\n    intersects=aoi_geojson,\n    collections=[\"sentinel-2-l2a\"],\n    datetime=\"2019-02-01/2019-03-28\",\n    query= {\"proj:epsg\": dict(eq=32632)}\n).item_collection()\n\nds = stackstac.stack(items,\n                     assets=['red','nir'],\n                     chunksize=(1,2,1024,1024),\n                     epsg = 32632\n                    )\nds","visibility":"show","key":"RDb8nXqJ4J"},{"type":"outputs","id":"chzzry2ALtfj2XaMuKjo0","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"e4c7a9e28db50c01108386be5f6dc26e","path":"/cubes-and-clouds/build/e4c7a9e28db50c01108386be5f6dc26e.html"},"text/plain":{"content":"<xarray.DataArray 'stackstac-aa62f8e6578d5768117ad9dea72fd911' (time: 56,\n                                                                band: 2,\n                                                                y: 83380,\n                                                                x: 15048)> Size: 1TB\ndask.array<fetch_raster_window, shape=(56, 2, 83380, 15048), dtype=float64, chunksize=(1, 2, 1024, 1024), chunktype=numpy.ndarray>\nCoordinates: (12/52)\n  * time                                     (time) datetime64[ns] 448B 2019-...\n    id                                       (time) <U24 5kB 'S2B_32TPT_20190...\n  * band                                     (band) <U3 24B 'red' 'nir'\n  * x                                        (x) float64 120kB 5.982e+05 ... ...\n  * y                                        (y) float64 667kB 5.303e+06 ... ...\n    s2:high_proba_clouds_percentage          (time) object 448B 28.474605 ......\n    ...                                       ...\n    proj:centroid                            (time) object 448B None ... None\n    s2:tile_id                               (time) object 448B None ... None\n    view:azimuth                             (time) object 448B None ... None\n    proj:shape                               object 8B {10980}\n    gsd                                      int64 8B 10\n    epsg                                     int64 8B 32632\nAttributes:\n    spec:           RasterSpec(epsg=32632, bounds=(598150.5065312386, 5087469...\n    crs:            epsg:32632\n    transform:      | 7.68, 0.00, 598150.51|\\n| 0.00,-2.58, 5302980.29|\\n| 0....\n    resolution_xy:  (7.681990477386707, 2.584686340731679)","content_type":"text/plain"}}},"children":[],"key":"zlcVmYgB94"}],"visibility":"show","key":"pBjDRSVERV"}],"visibility":"show","key":"u52nf28rqR"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"By inspecting any of the variables in the representation above, you’ll see that the data array represents ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"plDb5sxvTK"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"over 188 GiB of data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qGV6tisXep"}],"key":"HGFo93gBF6"},{"type":"text","value":", which is much more than the available memory on this notebook server or the Dask Local Cluster we created earlier. But thanks to chunking, we can still analyze it!","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DXRKwfPM5R"}],"key":"ovbFS5xF90"}],"key":"we7NRjMZxw"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"## Computing the NDVI\ndef NDVI(data):\n    red = data.sel(band=\"red\")\n    nir = data.sel(band=\"nir\")\n    ndvi = (nir - red)/(nir + red)\n    return ndvi\n\nndvi_xr = NDVI(ds)\n\n## Clip the data\naoi_utm32 = aoi.to_crs(epsg=32632)\ngeom_utm32 = aoi_utm32.iloc[0]['geometry']\nndvi_xr.rio.write_crs(\"EPSG:32632\", inplace=True)\nndvi_xr.rio.set_nodata(np.nan, inplace=True)\nndvi_xr = ndvi_xr.rio.clip([geom_utm32])\nndvi_xr.rio.set_nodata(np.nan, inplace=True)\n\nndvi_xr = ndvi_xr.groupby(ndvi_xr.time.dt.floor('D')).max(skipna=True)\nndvi_xr = ndvi_xr.chunk({\"floor\": 1, \"y\": 2048, \"x\": 2048})\nndvi_xr","visibility":"show","key":"Krs3MgNtvH"},{"type":"outputs","id":"Pj6fDJVszprXcy2odbLu3","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"aafaa7b662530192335ef2d33a923252","path":"/cubes-and-clouds/build/aafaa7b662530192335ef2d33a923252.html"},"text/plain":{"content":"<xarray.DataArray 'stackstac-aa62f8e6578d5768117ad9dea72fd911' (floor: 23,\n                                                                y: 12926,\n                                                                x: 3423)> Size: 8GB\ndask.array<rechunk-merge, shape=(23, 12926, 3423), dtype=float64, chunksize=(1, 2048, 2048), chunktype=numpy.ndarray>\nCoordinates: (12/15)\n  * x                                        (x) float64 27kB 6.543e+05 ... 6...\n  * y                                        (y) float64 103kB 5.202e+06 ... ...\n    proj:code                                <U10 40B 'EPSG:32632'\n    s2:datatake_type                         <U8 32B 'INS-NOBS'\n    constellation                            <U10 40B 'sentinel-2'\n    instruments                              <U3 12B 'msi'\n    ...                                       ...\n    mgrs:utm_zone                            int64 8B 32\n    proj:shape                               object 8B {10980}\n    gsd                                      int64 8B 10\n    epsg                                     int64 8B 32632\n    spatial_ref                              int64 8B 0\n  * floor                                    (floor) datetime64[ns] 184B 2019...\nAttributes:\n    _FillValue:  nan","content_type":"text/plain"}}},"children":[],"key":"AtgqSbWaSu"}],"visibility":"show","key":"KIAm91gxtU"}],"visibility":"show","key":"rBxncPBtfi"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Perform the same steps as in the previous exercise to convert to a Dataset and clean out problematic attributes","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EZefqPfJRM"}],"key":"PVYh7pCZ61"}],"key":"fWDz6kaeBP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ndvi_xr = ndvi_xr.to_dataset(name='data')\n\ndef remove_attrs(obj, to_remove):\n    new = obj.copy()\n    new.attrs = {k: v for k, v in obj.attrs.items() if k not in to_remove}\n    return new\n\ndef encode(obj):\n    object_coords = [name for name, coord in obj.coords.items() if coord.dtype.kind == \"O\"]\n    return obj.drop_vars(object_coords).pipe(remove_attrs, [\"spec\", \"transform\"])\n\nndvi_xr = ndvi_xr.pipe(encode)","key":"wfnUx7QAGr"},{"type":"outputs","id":"kyt12bBmdHV13cX6Xgc-0","children":[],"key":"dvHVuc7yUA"}],"key":"NrSekcRdQb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from dask.diagnostics import ProgressBar\nndvi_w = ndvi_xr.persist()\nwith ProgressBar():\n    ndvi_w.to_zarr(\"ndvi.zarr\", mode=\"w\", consolidated=True)","key":"jI6N5Mj8HH"},{"type":"outputs","id":"ASuvEcjLIB3Ge36xO-x_l","children":[{"type":"output","jupyter_data":{"ename":"FutureCancelledError","evalue":"finalize-hlgfinalizecompute-7bcd06d0559948638d7f848a63af28f9 cancelled for reason: scheduler-connection-lost.\nClient lost the connection to the scheduler. Please check your connection and re-run your work.","output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mFutureCancelledError\u001b[39m                      Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[11]\u001b[39m\u001b[32m, line 4\u001b[39m\n\u001b[32m      2\u001b[39m ndvi_w = ndvi_xr.persist()\n\u001b[32m      3\u001b[39m \u001b[38;5;28;01mwith\u001b[39;00m ProgressBar():\n\u001b[32m----> \u001b[39m\u001b[32m4\u001b[39m     \u001b[43mndvi_w\u001b[49m\u001b[43m.\u001b[49m\u001b[43mto_zarr\u001b[49m\u001b[43m(\u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43mndvi.zarr\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mmode\u001b[49m\u001b[43m=\u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43mw\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mconsolidated\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43;01mTrue\u001b[39;49;00m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m/home/conda/cubes-and-clouds/7f8203a7-1770295160-39-pangeo-dask/lib/python3.11/site-packages/xarray/core/dataset.py:2364\u001b[39m, in \u001b[36mDataset.to_zarr\u001b[39m\u001b[34m(self, store, chunk_store, mode, synchronizer, group, encoding, compute, consolidated, append_dim, region, safe_chunks, align_chunks, storage_options, zarr_version, zarr_format, write_empty_chunks, chunkmanager_store_kwargs)\u001b[39m\n\u001b[32m   2186\u001b[39m \u001b[38;5;250m\u001b[39m\u001b[33;03m\"\"\"Write dataset contents to a zarr group.\u001b[39;00m\n\u001b[32m   2187\u001b[39m \n\u001b[32m   2188\u001b[39m \u001b[33;03mZarr chunks are determined in the following way:\u001b[39;00m\n\u001b[32m   (...)\u001b[39m\u001b[32m   2360\u001b[39m \u001b[33;03m    The I/O user guide, with more details and examples.\u001b[39;00m\n\u001b[32m   2361\u001b[39m \u001b[33;03m\"\"\"\u001b[39;00m\n\u001b[32m   2362\u001b[39m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mxarray\u001b[39;00m\u001b[34;01m.\u001b[39;00m\u001b[34;01mbackends\u001b[39;00m\u001b[34;01m.\u001b[39;00m\u001b[34;01mapi\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m to_zarr\n\u001b[32m-> \u001b[39m\u001b[32m2364\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mto_zarr\u001b[49m\u001b[43m(\u001b[49m\u001b[43m  \u001b[49m\u001b[38;5;66;43;03m# type: ignore[call-overload,misc]\u001b[39;49;00m\n\u001b[32m   2365\u001b[39m \u001b[43m    \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m,\u001b[49m\n\u001b[32m   2366\u001b[39m \u001b[43m    \u001b[49m\u001b[43mstore\u001b[49m\u001b[43m=\u001b[49m\u001b[43mstore\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   2367\u001b[39m \u001b[43m    \u001b[49m\u001b[43mchunk_store\u001b[49m\u001b[43m=\u001b[49m\u001b[43mchunk_store\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   2368\u001b[39m \u001b[43m    \u001b[49m\u001b[43mstorage_options\u001b[49m\u001b[43m=\u001b[49m\u001b[43mstorage_options\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   2369\u001b[39m \u001b[43m    \u001b[49m\u001b[43mmode\u001b[49m\u001b[43m=\u001b[49m\u001b[43mmode\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   2370\u001b[39m \u001b[43m    \u001b[49m\u001b[43msynchronizer\u001b[49m\u001b[43m=\u001b[49m\u001b[43msynchronizer\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   2371\u001b[39m \u001b[43m    \u001b[49m\u001b[43mgroup\u001b[49m\u001b[43m=\u001b[49m\u001b[43mgroup\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   2372\u001b[39m \u001b[43m    \u001b[49m\u001b[43mencoding\u001b[49m\u001b[43m=\u001b[49m\u001b[43mencoding\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   2373\u001b[39m \u001b[43m    \u001b[49m\u001b[43mcompute\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcompute\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   2374\u001b[39m \u001b[43m    \u001b[49m\u001b[43mconsolidated\u001b[49m\u001b[43m=\u001b[49m\u001b[43mconsolidated\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   2375\u001b[39m \u001b[43m    \u001b[49m\u001b[43mappend_dim\u001b[49m\u001b[43m=\u001b[49m\u001b[43mappend_dim\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   2376\u001b[39m \u001b[43m    \u001b[49m\u001b[43mregion\u001b[49m\u001b[43m=\u001b[49m\u001b[43mregion\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   2377\u001b[39m \u001b[43m    \u001b[49m\u001b[43msafe_chunks\u001b[49m\u001b[43m=\u001b[49m\u001b[43msafe_chunks\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   2378\u001b[39m \u001b[43m    \u001b[49m\u001b[43mzarr_version\u001b[49m\u001b[43m=\u001b[49m\u001b[43mzarr_version\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   2379\u001b[39m \u001b[43m    \u001b[49m\u001b[43mzarr_format\u001b[49m\u001b[43m=\u001b[49m\u001b[43mzarr_format\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   2380\u001b[39m \u001b[43m    \u001b[49m\u001b[43mwrite_empty_chunks\u001b[49m\u001b[43m=\u001b[49m\u001b[43mwrite_empty_chunks\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   2381\u001b[39m \u001b[43m    \u001b[49m\u001b[43mchunkmanager_store_kwargs\u001b[49m\u001b[43m=\u001b[49m\u001b[43mchunkmanager_store_kwargs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   2382\u001b[39m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m/home/conda/cubes-and-clouds/7f8203a7-1770295160-39-pangeo-dask/lib/python3.11/site-packages/xarray/backends/api.py:2464\u001b[39m, in \u001b[36mto_zarr\u001b[39m\u001b[34m(dataset, store, chunk_store, mode, synchronizer, group, encoding, compute, consolidated, append_dim, region, safe_chunks, align_chunks, storage_options, zarr_version, zarr_format, write_empty_chunks, chunkmanager_store_kwargs)\u001b[39m\n\u001b[32m   2462\u001b[39m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m   2463\u001b[39m     dump_to_store(dataset, zstore, writer, encoding=encoding)\n\u001b[32m-> \u001b[39m\u001b[32m2464\u001b[39m     writes = \u001b[43mwriter\u001b[49m\u001b[43m.\u001b[49m\u001b[43msync\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m   2465\u001b[39m \u001b[43m        \u001b[49m\u001b[43mcompute\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcompute\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mchunkmanager_store_kwargs\u001b[49m\u001b[43m=\u001b[49m\u001b[43mchunkmanager_store_kwargs\u001b[49m\n\u001b[32m   2466\u001b[39m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m   2467\u001b[39m \u001b[38;5;28;01mfinally\u001b[39;00m:\n\u001b[32m   2468\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m compute:\n\n\u001b[36mFile \u001b[39m\u001b[32m/home/conda/cubes-and-clouds/7f8203a7-1770295160-39-pangeo-dask/lib/python3.11/site-packages/xarray/backends/common.py:412\u001b[39m, in \u001b[36mArrayWriter.sync\u001b[39m\u001b[34m(self, compute, chunkmanager_store_kwargs)\u001b[39m\n\u001b[32m    409\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m chunkmanager_store_kwargs \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\u001b[32m    410\u001b[39m     chunkmanager_store_kwargs = {}\n\u001b[32m--> \u001b[39m\u001b[32m412\u001b[39m delayed_store = \u001b[43mchunkmanager\u001b[49m\u001b[43m.\u001b[49m\u001b[43mstore\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    413\u001b[39m \u001b[43m    \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43msources\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    414\u001b[39m \u001b[43m    \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mtargets\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    415\u001b[39m \u001b[43m    \u001b[49m\u001b[43mlock\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mlock\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    416\u001b[39m \u001b[43m    \u001b[49m\u001b[43mcompute\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcompute\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    417\u001b[39m \u001b[43m    \u001b[49m\u001b[43mflush\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43;01mTrue\u001b[39;49;00m\u001b[43m,\u001b[49m\n\u001b[32m    418\u001b[39m \u001b[43m    \u001b[49m\u001b[43mregions\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mregions\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    419\u001b[39m \u001b[43m    \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mchunkmanager_store_kwargs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    420\u001b[39m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    421\u001b[39m \u001b[38;5;28mself\u001b[39m.sources = []\n\u001b[32m    422\u001b[39m \u001b[38;5;28mself\u001b[39m.targets = []\n\n\u001b[36mFile \u001b[39m\u001b[32m/home/conda/cubes-and-clouds/7f8203a7-1770295160-39-pangeo-dask/lib/python3.11/site-packages/xarray/namedarray/daskmanager.py:247\u001b[39m, in \u001b[36mDaskManager.store\u001b[39m\u001b[34m(self, sources, targets, **kwargs)\u001b[39m\n\u001b[32m    239\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34mstore\u001b[39m(\n\u001b[32m    240\u001b[39m     \u001b[38;5;28mself\u001b[39m,\n\u001b[32m    241\u001b[39m     sources: Any | Sequence[Any],\n\u001b[32m    242\u001b[39m     targets: Any,\n\u001b[32m    243\u001b[39m     **kwargs: Any,\n\u001b[32m    244\u001b[39m ) -> Any:\n\u001b[32m    245\u001b[39m     \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mdask\u001b[39;00m\u001b[34;01m.\u001b[39;00m\u001b[34;01marray\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m store\n\u001b[32m--> \u001b[39m\u001b[32m247\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mstore\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    248\u001b[39m \u001b[43m        \u001b[49m\u001b[43msources\u001b[49m\u001b[43m=\u001b[49m\u001b[43msources\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    249\u001b[39m \u001b[43m        \u001b[49m\u001b[43mtargets\u001b[49m\u001b[43m=\u001b[49m\u001b[43mtargets\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    250\u001b[39m \u001b[43m        \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    251\u001b[39m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m/home/conda/cubes-and-clouds/7f8203a7-1770295160-39-pangeo-dask/lib/python3.11/site-packages/dask/array/core.py:1221\u001b[39m, in \u001b[36mstore\u001b[39m\u001b[34m(***failed resolving arguments***)\u001b[39m\n\u001b[32m   1218\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m return_stored:\n\u001b[32m   1219\u001b[39m     \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mdask\u001b[39;00m\n\u001b[32m-> \u001b[39m\u001b[32m1221\u001b[39m     \u001b[43mdask\u001b[49m\u001b[43m.\u001b[49m\u001b[43mcompute\u001b[49m\u001b[43m(\u001b[49m\u001b[43marrays\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m   1222\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m\n\u001b[32m   1223\u001b[39m \u001b[38;5;28;01melse\u001b[39;00m:\n\n\u001b[36mFile \u001b[39m\u001b[32m/home/conda/cubes-and-clouds/7f8203a7-1770295160-39-pangeo-dask/lib/python3.11/site-packages/dask/base.py:681\u001b[39m, in \u001b[36mcompute\u001b[39m\u001b[34m(traverse, optimize_graph, scheduler, get, *args, **kwargs)\u001b[39m\n\u001b[32m    678\u001b[39m     expr = expr.optimize()\n\u001b[32m    679\u001b[39m     keys = \u001b[38;5;28mlist\u001b[39m(flatten(expr.__dask_keys__()))\n\u001b[32m--> \u001b[39m\u001b[32m681\u001b[39m     results = \u001b[43mschedule\u001b[49m\u001b[43m(\u001b[49m\u001b[43mexpr\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mkeys\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    683\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m repack(results)\n\n\u001b[36mFile \u001b[39m\u001b[32m/home/conda/cubes-and-clouds/7f8203a7-1770295160-39-pangeo-dask/lib/python3.11/site-packages/distributed/client.py:2420\u001b[39m, in \u001b[36mClient._gather\u001b[39m\u001b[34m(self, futures, errors, direct, local_worker)\u001b[39m\n\u001b[32m   2418\u001b[39m     exception = st.exception\n\u001b[32m   2419\u001b[39m     traceback = st.traceback\n\u001b[32m-> \u001b[39m\u001b[32m2420\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m exception.with_traceback(traceback)\n\u001b[32m   2421\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m errors == \u001b[33m\"\u001b[39m\u001b[33mskip\u001b[39m\u001b[33m\"\u001b[39m:\n\u001b[32m   2422\u001b[39m     bad_keys.add(key)\n\n\u001b[31mFutureCancelledError\u001b[39m: finalize-hlgfinalizecompute-7bcd06d0559948638d7f848a63af28f9 cancelled for reason: scheduler-connection-lost.\nClient lost the connection to the scheduler. Please check your connection and re-run your work."},"children":[],"key":"dyqXnQuO1d"}],"key":"ezTat6VgdA"}],"key":"ZVFFyL2LtF"},{"type":"block","kind":"notebook-code","data":{"scrolled":true,"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"%%time\nimport numpy\nwith np.errstate(all=\"ignore\"):\n    ndvi_xr.to_zarr('ndvi.zarr',mode='w')","visibility":"show","key":"H9glM4na3U"},{"type":"outputs","id":"gTvnX4NrhEECwKi12HOge","children":[],"visibility":"show","key":"JLaYWMAgQj"}],"visibility":"show","key":"HuWkw1CjKy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"omTh46KqMw"},{"type":"outputs","id":"lV9Nu2tiNXQIHEx-X4isi","children":[],"key":"LXXWxzDYER"}],"key":"aaF57TJcbu"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Close client to terminate local dask cluster","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SrFyK6xgDo"}],"identifier":"close-client-to-terminate-local-dask-cluster","label":"Close client to terminate local dask cluster","html_id":"close-client-to-terminate-local-dask-cluster","implicit":true,"key":"b2vldwbBTY"}],"key":"Qj3MeKlGe4"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pV4vlaharX"},{"type":"inlineCode","value":"Client","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"abyQ06QJTV"},{"type":"text","value":" and associated ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j6d8Y7oULF"},{"type":"inlineCode","value":"LocalCluster","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jhWu09AIkV"},{"type":"text","value":" object will be automatically closed when your Python session ends. When using Jupyter notebooks, we recommend to close it explicitely whenever you are done with your local Dask cluster.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UIeYuHgKyQ"}],"key":"IF8i3IMVqt"}],"key":"Zi6gA0N7xi"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"client.close()","visibility":"show","key":"aOGBba1SBd"},{"type":"outputs","id":"rxMingwlE45CUUh-PdFZw","children":[],"visibility":"show","key":"jspL4Z5zUN"}],"visibility":"show","key":"rJPuc0QiVO"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Conclusion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KbuRWOB1Ww"}],"identifier":"conclusion","label":"Conclusion","html_id":"conclusion","implicit":true,"key":"I7WRZYutLh"}],"key":"JGrs1n95SI"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In this exercise, we created a Dask cluster on a single machine, which is equivalent to vertical scaling as described in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lPdNwoWjXL"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.4 Formats and Performance","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SM5NTUVF3R"}],"key":"F6GT0RcxIC"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"g3d3oNmoE1"}],"key":"D28CIu6slB"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"However, the speedup is limited to the resources of your single machine. This is where horizontal scaling comes in. By adding resources from other machines, you can expand your computing power! In the case of dask, you can use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BZTbO41Acc"},{"type":"link","url":"https://gateway.dask.org/#dask-gateway","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Dask Gatway","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NZJ8p8H23A"}],"urlSource":"https://gateway.dask.org/#dask-gateway","key":"LDoGrQ8GqR"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mLVnZRLaBW"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qxFhnUq8om"},{"type":"text","value":"The Pangeo community hosts tutorials using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vyLPUL4R0N"},{"type":"link","url":"'https://pangeo-eosc.vm.fedcloud.eu/hub/'","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Pangeo@EOSC","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"D03Ih2JQy0"}],"urlSource":"'https://pangeo-eosc.vm.fedcloud.eu/hub/'","key":"LObJOb3YhO"},{"type":"text","value":". With the Pangeo EOSC deployment, you can learn how to use Dask Gateway to manage Dask clusters over Kubernetes, allowing us to run our data analysis in parallel, e.g. distribute tasks across multiple workers.\nIf you are a user of HPC center, you can also consider using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nFLrkfomOC"},{"type":"link","url":"https://docs.dask.org/en/stable/deploying-hpc.html#high-performance-computers","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Dask-jobque","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Dr3GkFEbtT"}],"urlSource":"https://docs.dask.org/en/stable/deploying-hpc.html#high-performance-computers","key":"bczwBWEW9g"},{"type":"text","value":" or Dask HPC for this.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nFaVmHCJmJ"}],"key":"ujGicCSa5q"}],"key":"BJ2b6be0qO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"Ur9iIHqYua"},{"type":"outputs","id":"aQA0M7WpgyLJAvty-xlax","children":[],"key":"cri92nuMmj"}],"key":"PAsPOGQIaM"}],"key":"G7Zv8RlEbW"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"2.4 Data Chunking with Pangeo","url":"/lectures/formats-and-performance/exercises/chunking","group":"Data formats for achieving scalability"},"next":{"title":"2.4 Formats and Performance","url":"/lectures/formats-and-performance/exercises/energy-consumption","group":"Data formats for achieving scalability"}}},"domain":"http://localhost:3000"}