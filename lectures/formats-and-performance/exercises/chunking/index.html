<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>2.4 Data chunking with Pangeo - Cubes and Clouds Notebooks</title><meta property="og:title" content="2.4 Data chunking with Pangeo - Cubes and Clouds Notebooks"/><meta name="generator" content="mystmd"/><meta name="description" content="Collection of Cubes and Clouds learning notebooks"/><meta property="og:description" content="Collection of Cubes and Clouds learning notebooks"/><meta name="keywords" content=""/><meta name="image" content="/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg"/><meta property="og:image" content="/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg"/><link rel="stylesheet" href="/cubes-and-clouds/build/_assets/app-OIHP3NGU.css"/><link rel="stylesheet" href="/cubes-and-clouds/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/cubes-and-clouds/favicon.ico"/><link rel="stylesheet" href="/cubes-and-clouds/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block lg:hidden"><button class="myst-top-nav-menu-button flex items-center justify-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100 w-10 h-10"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/cubes-and-clouds/"><span class="text-md sm:text-xl tracking-tight sm:mr-5">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-10 h-10 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] lg:hidden hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="myst-fm-block-subject flex-none pr-2 smallcaps">Cubes and Clouds learning materials</div><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/EO-college/cubes-and-clouds" title="GitHub Repository: EO-college/cubes-and-clouds" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/EO-college/cubes-and-clouds/edit/main/lectures/2.4_formats_and_performance/exercises/24_chunking.ipynb" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">2.4 Data chunking with Pangeo</h1></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="M4APoJ1Ka9" class="myst-jp-nb-block relative group/block"><img id="JSImMo9HAJ" style="margin-left:auto;margin-right:auto" src="/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg" alt="Cubes &amp; Clouds logo" data-canonical-url="https://raw.githubusercontent.com/EO-College/cubes-and-clouds/main/icons/cnc_3icons_process_circle.svg" class=""/></div><div id="K6RaHxWht1" class="myst-jp-nb-block relative group/block"><img id="yUEUKzsi07" style="margin-left:auto;margin-right:auto" src="/cubes-and-clouds/build/0f8adf2e4ec0feb14584840545a0ae3a.png" alt="Pangeo logo" data-canonical-url="https://raw.githubusercontent.com/pangeo-data/pangeo.io/refs/heads/main/public/Pangeo-assets/pangeo_logo.png" class=""/></div><div id="uInv8DCrmn" class="myst-jp-nb-block relative group/block"><h1 id="id-2-4-data-chunking-with-pangeo" class="relative group"><span class="heading-text">2.4 Data chunking with Pangeo</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-4-data-chunking-with-pangeo" title="Link to this Section" aria-label="Link to this Section">¶</a></h1><h2 id="data-chunking" class="relative group"><span class="heading-text">Data chunking</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#data-chunking" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="rdFI8oSYqy" class="myst-jp-nb-block relative group/block"><div class="alert alert-info"><em></em><strong>Overview</strong> <br/><br/><strong>Questions</strong><ul><li><p>What is chunking and why does it matter?</p></li><li><p>How can we utilize chunking to make our processing more efficient?</p></li></ul><strong>Objectives</strong><ul><li><p>Explore chunking of data</p></li><li><p>Learn about the Zarr file format</p></li></ul></div></div><div id="oCTtiuaCmk" class="myst-jp-nb-block relative group/block"><h2 id="context" class="relative group"><span class="heading-text">Context</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#context" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>As explained in Section 2.4 - Formats and Performance, when working with large data files or collections, it is often impractical to load the entire dataset into the memory of a single computer at once. This is where the Pangeo ecosystem is particularly useful. In Section 2.3 - Data Access, we discussed the concept of lazy loading. Xarray enables lazy processing of data in <strong>chunks</strong>, meaning the dataset is divided into manageable pieces. By reading and processing the data in these chunks, we can efficiently handle large datasets on a single computer or scale the processing to a distributed computing cluster using Dask (e.g., on the cloud or high-performance computing environments).</p><p>How we process these chunks in a parallel environment to scale our computation vertically is discussed in <a class="link" href="/cubes-and-clouds./dask.ipynb">2.4 dask</a>. In this notebook, you will explore the concept of chunks through various exercises.</p><p>Processing data piece by piece is more efficient when both our input and output data are also stored in chunks. As introduced in Section 2.4 - Formats and Performance, <a target="_blank" rel="noreferrer" href="https://zarr.readthedocs.io/en/stable/" class="link">Zarr<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="external-link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a> is a cloud-native data format and serves as the reference library in the Pangeo ecosystem for storing Xarray multi-dimensional datasets in <strong>chunks</strong>.</p><h2 id="data" class="relative group"><span class="heading-text">Data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We’ll begin with the same sample data retrieval method from the Sentinel-2 STAC collection, as described in Exercise 2.3 - Data Access: Lazy Loading with Pangeo.</p><p>The analysis will be similar to our previous exercises, but this time, we’ll use a larger spatial extent to demonstrate the scalability.</p></div><div id="UDi1XOzzhG" class="myst-jp-nb-block relative group/block"><p>We start by copying the data files needed to complete the exercise using the following shell commands</p></div><div id="lH3u1jqs6e" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">!cp -r ${DATA_PATH%/*/*}/notebooks/cubes-and-clouds/lectures/2.4_formats_and_performance/exercises/assets $HOME/</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="hG4SMixJJUqodbrP4dlT2" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="iEX76iBBVq" class="myst-jp-nb-block relative group/block"><h2 id="load-libraries" class="relative group"><span class="heading-text">Load Libraries</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#load-libraries" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="TFUu7qfNeC" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import pystac_client
import geopandas as gpd
from shapely.geometry import mapping
import stackstac
import warnings
import xarray as xr
import numpy as np
import rioxarray as rio
warnings.filterwarnings(&quot;ignore&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="gjKpkUrRSgWr40lqfT2gk" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="BpIjcfJvTQ" class="myst-jp-nb-block relative group/block"><h2 id="load-sentinel-2-data" class="relative group"><span class="heading-text">Load Sentinel-2 data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#load-sentinel-2-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="vS1r7l9r7Z" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">aoi = gpd.read_file(&#x27;./assets/catchment_outline.geojson&#x27;, crs=&quot;EPGS:4326&quot;)
aoi_geojson = mapping(aoi.iloc[0].geometry)
URL = &quot;https://earth-search.aws.element84.com/v1&quot;
catalog = pystac_client.Client.open(URL)
items = catalog.search(
    intersects=aoi_geojson,
    collections=[&quot;sentinel-2-l2a&quot;],
    datetime=&quot;2019-02-01/2019-04-28&quot;,
    query= {&quot;proj:epsg&quot;: dict(eq=32632)}
).item_collection()
sentinel2_l2a = stackstac.stack(items,assets=[&quot;red&quot;,&quot;nir&quot;])
sentinel2_l2a</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="dsmIU_m9gZDUjXj7k3UaZ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="rBvHvuc95X" class="myst-jp-nb-block relative group/block"><h2 id="what-is-a-chunk" class="relative group"><span class="heading-text">What is a <strong>Chunk</strong>?</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#what-is-a-chunk" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>If you closely examine the <code>sentinel2_l2a</code> dataset, you’ll notice that the <code>xarray.DataArray</code> is backed by a <code>dask.array</code> with a chunk size of <code>(1, 1, 1024, 1024)</code>. The full dataset consists of arrays with dimensions <code>(102, 2, 20982, 10980)</code>, totaling 47,124 chunks, which amounts to 350.16 GiB of data potentially loaded into the computer’s RAM.</p><p>You can view the <code>dask.array</code> information by clicking the blue-circled icon in the image below.</p><img id="ezvep3a2YK" style="margin-left:auto;margin-right:auto" src="/cubes-and-clouds/build/4e7b4046c0507a2dc115bda61e72c2f0.png" alt="Dask.array" data-canonical-url="https://raw.githubusercontent.com/EO-College/cubes-and-clouds/refs/heads/main/lectures/2.4_formats_and_performance/exercises/assets/datasize.png" class=""/><p>By clicking the red-circled triangle icon, you’ll see detailed information about the <code>xarray.DataArray</code>, including its Coordinates, Indexes, and Attributes.</p><p>When creating an <code>Xarray</code> object using <code>stackstac</code>, we can easily convert a STAC collection into a lazily-loaded, chunked <code>xarray.DataArray</code> backed by Dask.</p><p>The size and shape of the chunks determine the level of parallelization performed by Dask. Therefore, selecting an appropriate chunk size can significantly impact the performance of your computation.</p><p>This is where understanding and effectively using chunking becomes crucial.</p></div><div id="ugEJ8QMZBF" class="myst-jp-nb-block relative group/block"><p>In our case, for the moment, we used <code>stackstac</code> without specifying the ‘chunk’ explicitly. The dataset is composed of 8 MiB chunks, each containing 1 time step, 1 band, and a resolution of 1024 x 1024 in the x and y directions.</p><img id="Eeb46EfP13" style="margin-left:auto;margin-right:auto" src="/cubes-and-clouds/build/2ef91feac1ae68f3219ac81953a16827.png" alt="chunk_original" data-canonical-url="https://raw.githubusercontent.com/EO-College/cubes-and-clouds/refs/heads/main/lectures/2.4_formats_and_performance/exercises/assets/chunk_original.png" class=""/><p>If the chunk size is too small, our workflow will be divided into too many tiny pieces, which can lead to excessive communication and increased distribution overhead.</p><p>On the other hand, if the chunk size is too large, there may not be enough memory available to handle the workload, causing the workflow to fail.</p><p>The optimal chunk size depends on both your computation and the machine you’re using.</p><p>For example, 8 MiB is relatively small compared to the typical RAM size available. Dask’s default array chunk size, for instance, is 128 MiB.</p></div><div id="OxZZThoK36" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import dask
dask.config.get(&#x27;array.chunk-size&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="AJY8XlAcm22cElQcAwqTs" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Pu2OMJKU3H" class="myst-jp-nb-block relative group/block"><h2 id="modifying-chunks" class="relative group"><span class="heading-text">Modifying chunks</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#modifying-chunks" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Let’s try to modify our chunk size.</p><p>To modify chunks on your existing <code>xarray.DataArray</code> we can use the <code>chunk</code> method.
We know that we only need 2 bands to compute the Normalized Difference Vegetation Index (NDVI) example, so we select only <code>red</code> and <code>nir</code> to simplify our example.</p><p>We would like to have each time series separated in each chunk, then keep all band information on one chunk, and let dask to compute x and y coordinate’s chunk size.</p></div><div id="wMC2TSpQzK" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def NDVI(data):
    red = data.sel(band=&quot;red&quot;)
    nir = data.sel(band=&quot;nir&quot;)
    ndvi = (nir - red)/(nir + red)
    return ndvi

ndvi_xr = NDVI(sentinel2_l2a)
ndvi_xr</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="UewqMnDfWtQr2nION5RJX" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="a6ZL1XBwka" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">sentinel2_l2a = sentinel2_l2a.sel(
    band=[&#x27;red&#x27;,&#x27;nir&#x27;]).chunk(
    chunks={&#x27;time&#x27;: 1, &#x27;band&#x27;:2, &#x27;x&#x27;:&#x27;auto&#x27;,&#x27;y&#x27;:&#x27;auto&#x27;})
sentinel2_l2a</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="1Bc4CVfpU9orAroQjQsx9" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="F2rMg9q26W" class="myst-jp-nb-block relative group/block"><p>If you look into the details of any variable in the representation above, you’ll see that each x and y coordinate’s chunk is bigger, and we have less chunks than the example before.</p><p>Note here from the chunk size, the auto option computed the optimal chunk size for y and x if we want to keep the chunk size of time and band as 1 and 2 respectively.</p></div><div id="TPrhA8QwZw" class="myst-jp-nb-block relative group/block"><div class="alert alert-warning"><em></em><strong>Go Further</strong> <br/><br/>You can try to apply different ways for specifying chunk.<ul><li><p>chunks = -1 -&gt; the entire array will be used as a single chunk</p></li><li><p>chunks = {&#x27;x&#x27;:-1, &#x27;y&#x27;: 1000} -&gt; chunks of entire _x_ dimension, but splitted every 1000 values on _y_ dimension</p></li><li><p>chunks = {&#x27;x&#x27;:-1, &#x27;y&#x27;: &#x27;auto&#x27;} -&gt; Xarray relies on Dask to use an ideal size according to the preferred chunk sizes for _y_ dimension</p></li><li><p>chunks = { &#x27;x&#x27;:-1 ,&#x27;y&#x27;:&quot;500MiB&quot; } -&gt; Xarray seeks the size according to a specific memory target expressed in MiB</p></li><li><p>chunks = ( 1, 3, 12048,2048) -&gt; Specifying chunk size in the order of dimension.</p></li></ul></div></div><div id="ARCaZmg9Ek" class="myst-jp-nb-block relative group/block"><h2 id="defining-the-chunk-size-at-the-creation-with-xarray" class="relative group"><span class="heading-text">Defining the chunk size at the creation with Xarray</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#defining-the-chunk-size-at-the-creation-with-xarray" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We can define the chunk size when we create the object.<br/>This is usually done with Xarray using the <code>chunks</code> kwarg when opening a file with <code>xr.open_dataset</code> or with <code>xr.open_mfdataset</code>, if you create Xarray from your local file.</p><p>In our NDVI example, we create Xarray from <code>stackstac</code>. As <code>stackstac</code>’s default ‘chunksize’ definition is 1024 for the x and y dimensions, we had that chunk size. We can pass the <code>chunksize</code> option to <code>stackstac</code> and make it larger.</p></div><div id="nzbYdmZQfH" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%time
sentinel2_l2a = stackstac.stack(items,
                                assets=[&#x27;red&#x27;,&#x27;nir&#x27;],
                                chunksize=( 1, 2, 2048,2048)
)
sentinel2_l2a</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="jyK34MI5cgKpP7sHd3pdl" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="ap4aqyWPHH" class="myst-jp-nb-block relative group/block"><h2 id="so-why-chunks" class="relative group"><span class="heading-text">So, why chunks?</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#so-why-chunks" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>As explained in <strong>Section 2.4 - Formats and Performance</strong>, chunks are mandatory for accessing files or datasets that are larger than a single computer’s memory. If all the data has to be accessed, it can be done sequentially (i.e., chunks are processed one after the other).</p><p>Moreover, chunks allow for distributed processing and increased speed for your data analysis, as seen in the next section.</p><h3 id="chunks-and-files" class="relative group"><span class="heading-text">Chunks and files</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#chunks-and-files" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Xarray chunking capabilities also depend on the underlying input or output file format used. Most modern file formats allow datasets or single files to be stored using chunks. For example, <strong>NetCDF4</strong> uses chunks when storing a file on the disk via HDF5. Any read of data from a NetCDF4 file will load at least one chunk of that file. So when reading one of its chunks as defined in the <code>open_dataset</code> call, Xarray will take advantage of native file chunking and won’t need to read the entire file.</p><p>However, it is important to note that <strong>Xarray chunks and file chunks are not necessarily the same</strong>. It is a good practice to configure Xarray chunks so that they align well with the input file format chunks (ideally, Xarray chunks should contain one or several input file chunks).</p></div><div id="dCFmO6qTru" class="myst-jp-nb-block relative group/block"><h2 id="zarr-storage-format" class="relative group"><span class="heading-text">Zarr storage format</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#zarr-storage-format" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>This brings us to our next subject: <a target="_blank" rel="noreferrer" href="https://zarr.readthedocs.io/en/stable/" class="link">Zarr<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="external-link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a>.</p><p>If we can have our original dataset already ‘chunked’ and accessed in an optimized way according to its actual byte storage on disk, we won’t need to load the entire dataset every time. This can greatly optimize our data analysis, even when working with the entire dataset.</p><p>Let’s convert our intermediate data into Zarr format so that we can learn what it is. We can keep the data as a <code>DataArray</code> or convert it into a <code>Dataset</code> before storing it.</p><p>We start again by loading data using <code>stackstac</code>, but this time, we proceed to the next step: clipping the data and computing the NDVI. Then, let’s try to save those intermediate results in a Zarr file.</p></div><div id="xYRtPIIGpY" class="myst-jp-nb-block relative group/block"><h2 id="data-loading" class="relative group"><span class="heading-text">Data Loading</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#data-loading" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Load data using stackstac (with specific chunk size)</p></div><div id="RbbnPiwRlH" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">aoi = gpd.read_file(&quot;./assets/catchment_outline.geojson&quot;, crs=&quot;EPGS:4326&quot;)
aoi_geojson = mapping(aoi.iloc[0].geometry)
URL = &quot;https://earth-search.aws.element84.com/v1&quot;
catalog = pystac_client.Client.open(URL)
items = catalog.search(
    intersects=aoi_geojson,
    collections=[&quot;sentinel-2-l2a&quot;],
    datetime=&quot;2019-02-01/2019-04-28&quot;,
    query= {&quot;proj:epsg&quot;: dict(eq=32632)}
).item_collection()
ds = stackstac.stack(items,
                     assets=[&#x27;red&#x27;,&#x27;nir&#x27;],
                     chunksize=( 1, 2, 1024,1024)
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="tR0KoSrA8Ea5zTVbhmEn4" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="UMsUUNoICD" class="myst-jp-nb-block relative group/block"><h2 id="ndvi-computation" class="relative group"><span class="heading-text">NDVI computation</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#ndvi-computation" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Compute the NDVI as in 2.3 Data Access - Reduce</p></div><div id="fjhd2Pe3z8" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def NDVI(data):
    red = data.sel(band=&quot;red&quot;)
    nir = data.sel(band=&quot;nir&quot;)
    ndvi = (nir - red)/(nir + red)
    return ndvi

ndvi_xr = NDVI(ds)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="IF6SBSRzIqNifNyut4VCt" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="YvQ3lxHiJR" class="myst-jp-nb-block relative group/block"><h2 id="spatial-clipping" class="relative group"><span class="heading-text">Spatial clipping</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#spatial-clipping" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Restrict the data to the area of interest from the loaded polygon</p></div><div id="aDUrHWBgLJ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">aoi_utm32 = aoi.to_crs(epsg=32632)
geom_utm32 = aoi_utm32.iloc[0][&#x27;geometry&#x27;]
ndvi_xr.rio.write_crs(&quot;EPSG:32632&quot;, inplace=True)
ndvi_xr.rio.set_nodata(np.nan, inplace=True)
ndvi_xr = ndvi_xr.rio.clip([geom_utm32])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="LZcm6aanDbgKTQWMZ3WB-" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="qLdEts5wrH" class="myst-jp-nb-block relative group/block"><h2 id="save-to-zarr" class="relative group"><span class="heading-text">Save to Zarr</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#save-to-zarr" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Select just a few days, to reduce the amount of data for this example</p></div><div id="H5xmvAcIwk" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">ndvi_small = ndvi_xr.isel(time=slice(0,3))
ndvi_small</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="epvEdIpCqMA5CoTtFr1WB" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="L62cfBEAWl" class="myst-jp-nb-block relative group/block"><p>Before saving, we can modify the chunk shape</p></div><div id="man7TaUZGy" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">ndvi_small = ndvi_small.chunk(chunks = {&#x27;x&#x27;:&#x27;auto&#x27;, &#x27;y&#x27;: &#x27;auto&#x27;}).to_dataset(name=&#x27;data&#x27;)
ndvi_small</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Xbo_9_xQw_bPVTtb-42YN" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="inwbhFwV6T" class="myst-jp-nb-block relative group/block"><p>Then clean attributes that might create issues while writing and save to Zarr</p></div><div id="PnYSuLphJz" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%time

def remove_attrs(obj, to_remove):
    new = obj.copy()
    new.attrs = {k: v for k, v in obj.attrs.items() if k not in to_remove}
    return new

def encode(obj):
    object_coords = [name for name, coord in obj.coords.items() if coord.dtype.kind == &quot;O&quot;]
    return obj.drop_vars(object_coords).pipe(remove_attrs, [&quot;spec&quot;, &quot;transform&quot;])

ndvi_small.pipe(encode).to_zarr(&#x27;test.zarr&#x27;,mode=&#x27;w&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="W05eCP_xYRLPSpD4cGchc" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="IagXwwNOzB" class="myst-jp-nb-block relative group/block"><div class="alert alert-warning"><em></em><strong>Exercise</strong><br/><ul><li><p>What about saving the data in Netcdf format? `ls -la test.zarr` and `ls -la test.zarr/nobs `</p></li><li><p>You can try to explore the zarr file you just created using `ls -la test.zarr` and `ls -la test.zarr/nobs `</p></li><li><p>You can explore zarr metadata file by `cat test.zarr/.zmetadata`</p></li><li><p>Did you find the __chunks__ we defined previously in your zarr file?</p></li></ul></div></div><div id="kFatq8xCVp" class="myst-jp-nb-block relative group/block"><h2 id="compare-zarr-and-netcdf" class="relative group"><span class="heading-text">Compare Zarr and netCDF</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#compare-zarr-and-netcdf" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Lets compare how the zarr and NetCDF files are stored.<br/>We read our sample dataset from Zarr and store it as netCDF:</p></div><div id="z6FhYDWoKM" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">xr.open_zarr(&#x27;test.zarr&#x27;).to_netcdf(&#x27;test.nc&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="dQ-N188SOHpyZAJ76Xvvk" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="e6uruNbgQ8" class="myst-jp-nb-block relative group/block"><p>Compare the disk space used by the two formats:</p></div><div id="WhSp52t29G" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">!du -sh test.zarr/ test.nc</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="_G4wx61AXyUK0WW8e_nkT" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="jDd5loKynw" class="myst-jp-nb-block relative group/block"><p>List the content of the Zarr directory:</p></div><div id="HNJYeLQwn1" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">!ls  -la test.zarr/</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="_G0xSziqGqZUn2u85ob0c" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="jQXJ9Nqsce" class="myst-jp-nb-block relative group/block"><p>List the content of the Zarr data directory:</p></div><div id="CEWXyTaYnC" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">!ls  -la test.zarr/data</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="kmH0AOfEeibITVCGmF-VP" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="i85Fn90LMf" class="myst-jp-nb-block relative group/block"><p>Print the content of the Zarr metadata file</p></div><div id="G1hBwSFsUh" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">!cat test.zarr/.zmetadata | head -n 30</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="F8gGviBgBS0cVB7fq9_V4" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="AyyDvHWT40" class="myst-jp-nb-block relative group/block"><h3 id="zarr-format-main-characteristics" class="relative group"><span class="heading-text">Zarr format main characteristics</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#zarr-format-main-characteristics" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="vuiMxoIe0l" class="myst-jp-nb-block relative group/block"><ul><li><p>Every chunk of a Zarr dataset is stored as a single file (see x.y files in <code>ls -al test.zarr/data</code>)</p></li><li><p>Each Data array in a Zarr dataset has a two unique files containing metadata:</p><ul><li><p>.zattrs for dataset or dataarray general metadatas</p></li><li><p>.zarray indicating how the dataarray is chunked, and where to find them on disk or other storage.</p></li></ul></li></ul></div><div id="bjFSRCSuB3" class="myst-jp-nb-block relative group/block"><h2 id="conclusion" class="relative group"><span class="heading-text">Conclusion</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#conclusion" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Understanding chunking is key to optimize your data analysis when dealing with large datasets. In this exercise, we learned how to optimize data access time and memory resources by using native file chunks loaded by stackstac and instructing Xarray to modify the chunk. Computing on large datasets can be very slow on a single machine, and to optimize your time we may need to parallelize your computations. This is what you will learn in the next exercise with Dask.</p></div><div class="myst-backmatter-parts"></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/cubes-and-clouds/build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-7UUHRSK3.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/root-EDJFWIEV.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-ECLX7DIY.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/routes/$-AD65NCUT.js"/><script>window.__remixContext = {"url":"/lectures/formats-and-performance/exercises/chunking","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.8.0","options":{"hide_toc":true,"hide_footer_links":true,"folders":true},"nav":[],"actions":[],"projects":[{"subject":"Cubes and Clouds learning materials","title":"Cubes and Clouds Notebooks","description":"Collection of Cubes and Clouds learning notebooks","github":"https://github.com/EO-college/cubes-and-clouds","id":"7095e86f-a94c-4858-b97b-80694fdbcdf1","thumbnail":"/cubes-and-clouds/build/4e7b95cc5159f11ae65e2049a64650a6.svg","exports":[],"bibliography":[],"index":"readme","pages":[{"slug":"contributing","title":"How to contribute","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"contributors","title":"Contributors","description":"","date":"","thumbnail":"/cubes-and-clouds/build/bee0df1dcfe29799901d54c333adae56.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"title":"Lectures","level":1},{"slug":"lectures.readme","title":"Lectures","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"Introduction","level":2},{"slug":"lectures.introduction.introduction","title":"Introduction","description":"","date":"","thumbnail":"/cubes-and-clouds/build/864d3fc75ed1a08ac2d4c8f21d9d6a63.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.introduction.exercises.login","title":"0. Introduction","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"1","level":2},{"slug":"lectures.intro-platform.intro-platform","title":"Earth Observation cloud platforms","description":"","date":"","thumbnail":"/cubes-and-clouds/build/b334c40d1c998a2fb3e79e903892672d.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"1","level":2},{"slug":"lectures.data-cube.data-cube","title":"What is a data cube?","description":"","date":"","thumbnail":"/cubes-and-clouds/build/04b2802f47f308fa6a646bc15a8fe881.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"1","level":2},{"slug":"lectures.openscience.openscienceandfair","title":"Open Science and the FAIR Principles","description":"","date":"","thumbnail":"/cubes-and-clouds/build/3c3f883a861697088c44018dfa0c01af.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"lectures.openscience.opendataopensource","title":"Open Data and Open Source Software","description":"","date":"","thumbnail":"/cubes-and-clouds/build/bff8617b237519f0cffd390773f82d2d.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"lectures.openscience.openscienceineo","title":"The Open Science Journey - Open Science in geospatial, EO and EO cloud platforms","description":"","date":"","thumbnail":"/cubes-and-clouds/build/d4d5badaaff454a73f72620f2ac36c2e.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"2","level":2},{"slug":"lectures.data-discovery.data-discovery","title":"Data Discovery","description":"","date":"","thumbnail":"/cubes-and-clouds/build/3f9ff18207bbea501aede31c88cde0e5.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"2","level":2},{"slug":"lectures.data-properties.data-properties","title":"Data Properties","description":"","date":"","thumbnail":"/cubes-and-clouds/build/stac_standartization-36ffec2caaffa99c4330cb1a15d936d7.jpg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-properties.exercises.data-properties","title":"2.2 Data Discovery \u0026 Properties","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"2","level":2},{"slug":"lectures.data-access.data-access","title":"Access EO Data from the Cloud","description":"","date":"","thumbnail":"/cubes-and-clouds/build/dc_filter-ccdc08cafd02cb0631dceef04c842847.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"title":"Openeo","level":4},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-aggregate","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-apply","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-filter","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-lazy-loading","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-reduce","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-resample","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"Pangeo","level":4},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-aggregate","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-apply","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-filter","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-lazy-loading","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-reduce","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-resample","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"2","level":2},{"slug":"lectures.formats-and-performance.formats-and-performance","title":"Data Formats and Performance","description":"","date":"","thumbnail":"/cubes-and-clouds/build/96fdc48bce5685dcda930053ff412281.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.formats-and-performance.exercises.chunking","title":"2.4 Data chunking with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.formats-and-performance.exercises.dask","title":"2.4 Scaling with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.formats-and-performance.exercises.energy-consumption","title":"2.4 Formats and Performance","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"3","level":2},{"slug":"lectures.data-processing.data-processing","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/fe97d8f264069b8e4340c6b6ddcdf54e.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-processing.exercises.data-processing-openeo","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.data-processing.exercises.data-processing-pangeo","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"Alternatives","level":4},{"slug":"lectures.data-processing.exercises.alternatives.data-processing-openeo-platform","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-processing.exercises.alternatives.data-processing-stac","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"3","level":2},{"slug":"lectures.validation.validation","title":"Validation","description":"","date":"","thumbnail":"/cubes-and-clouds/build/distribution_map-482056cc9f982d5d3021d360525ae993.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.validation.exercises.validation-openeo","title":"3.2 Validation of the results with openEO","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.validation.exercises.validation-pangeo","title":"3.2 Validation of the results with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"3","level":2},{"slug":"lectures.data-sharing.data-sharing","title":"3.3 Data Sharing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/4066423c8fb88d808f30ad74224294b4.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-sharing.exercises.data-sharing-openeo","title":"3.3 Data Sharing with openEO","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.data-sharing.exercises.data-sharing-pangeo","title":"3.3 Data Sharing with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"9","level":2},{"slug":"lectures.master-asi-conae.s2-sca","title":"Sentinel-2 snow cover area (SCA) time series","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Test","level":3},{"slug":"lectures.master-asi-conae.test.s1","title":"S1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s2-sca-sh","title":"S2 Sca Sh","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s2-snowcover-test","title":"Sentinel-2 snow cover","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s3-ndsi","title":"List all the available dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.test-s1-s3","title":"Sentinel-1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/cubes-and-clouds"},"routes/$":{"config":{"version":3,"myst":"1.8.0","options":{"hide_toc":true,"hide_footer_links":true,"folders":true},"nav":[],"actions":[],"projects":[{"subject":"Cubes and Clouds learning materials","title":"Cubes and Clouds Notebooks","description":"Collection of Cubes and Clouds learning notebooks","github":"https://github.com/EO-college/cubes-and-clouds","id":"7095e86f-a94c-4858-b97b-80694fdbcdf1","thumbnail":"/cubes-and-clouds/build/4e7b95cc5159f11ae65e2049a64650a6.svg","exports":[],"bibliography":[],"index":"readme","pages":[{"slug":"contributing","title":"How to contribute","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"contributors","title":"Contributors","description":"","date":"","thumbnail":"/cubes-and-clouds/build/bee0df1dcfe29799901d54c333adae56.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"title":"Lectures","level":1},{"slug":"lectures.readme","title":"Lectures","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"Introduction","level":2},{"slug":"lectures.introduction.introduction","title":"Introduction","description":"","date":"","thumbnail":"/cubes-and-clouds/build/864d3fc75ed1a08ac2d4c8f21d9d6a63.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.introduction.exercises.login","title":"0. Introduction","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"1","level":2},{"slug":"lectures.intro-platform.intro-platform","title":"Earth Observation cloud platforms","description":"","date":"","thumbnail":"/cubes-and-clouds/build/b334c40d1c998a2fb3e79e903892672d.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"1","level":2},{"slug":"lectures.data-cube.data-cube","title":"What is a data cube?","description":"","date":"","thumbnail":"/cubes-and-clouds/build/04b2802f47f308fa6a646bc15a8fe881.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"1","level":2},{"slug":"lectures.openscience.openscienceandfair","title":"Open Science and the FAIR Principles","description":"","date":"","thumbnail":"/cubes-and-clouds/build/3c3f883a861697088c44018dfa0c01af.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"lectures.openscience.opendataopensource","title":"Open Data and Open Source Software","description":"","date":"","thumbnail":"/cubes-and-clouds/build/bff8617b237519f0cffd390773f82d2d.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"lectures.openscience.openscienceineo","title":"The Open Science Journey - Open Science in geospatial, EO and EO cloud platforms","description":"","date":"","thumbnail":"/cubes-and-clouds/build/d4d5badaaff454a73f72620f2ac36c2e.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"2","level":2},{"slug":"lectures.data-discovery.data-discovery","title":"Data Discovery","description":"","date":"","thumbnail":"/cubes-and-clouds/build/3f9ff18207bbea501aede31c88cde0e5.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"2","level":2},{"slug":"lectures.data-properties.data-properties","title":"Data Properties","description":"","date":"","thumbnail":"/cubes-and-clouds/build/stac_standartization-36ffec2caaffa99c4330cb1a15d936d7.jpg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-properties.exercises.data-properties","title":"2.2 Data Discovery \u0026 Properties","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"2","level":2},{"slug":"lectures.data-access.data-access","title":"Access EO Data from the Cloud","description":"","date":"","thumbnail":"/cubes-and-clouds/build/dc_filter-ccdc08cafd02cb0631dceef04c842847.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"title":"Openeo","level":4},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-aggregate","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-apply","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-filter","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-lazy-loading","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-reduce","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-resample","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"Pangeo","level":4},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-aggregate","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-apply","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-filter","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-lazy-loading","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-reduce","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-resample","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"2","level":2},{"slug":"lectures.formats-and-performance.formats-and-performance","title":"Data Formats and Performance","description":"","date":"","thumbnail":"/cubes-and-clouds/build/96fdc48bce5685dcda930053ff412281.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.formats-and-performance.exercises.chunking","title":"2.4 Data chunking with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.formats-and-performance.exercises.dask","title":"2.4 Scaling with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.formats-and-performance.exercises.energy-consumption","title":"2.4 Formats and Performance","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"3","level":2},{"slug":"lectures.data-processing.data-processing","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/fe97d8f264069b8e4340c6b6ddcdf54e.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-processing.exercises.data-processing-openeo","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.data-processing.exercises.data-processing-pangeo","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"Alternatives","level":4},{"slug":"lectures.data-processing.exercises.alternatives.data-processing-openeo-platform","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-processing.exercises.alternatives.data-processing-stac","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"3","level":2},{"slug":"lectures.validation.validation","title":"Validation","description":"","date":"","thumbnail":"/cubes-and-clouds/build/distribution_map-482056cc9f982d5d3021d360525ae993.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.validation.exercises.validation-openeo","title":"3.2 Validation of the results with openEO","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.validation.exercises.validation-pangeo","title":"3.2 Validation of the results with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"3","level":2},{"slug":"lectures.data-sharing.data-sharing","title":"3.3 Data Sharing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/4066423c8fb88d808f30ad74224294b4.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-sharing.exercises.data-sharing-openeo","title":"3.3 Data Sharing with openEO","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.data-sharing.exercises.data-sharing-pangeo","title":"3.3 Data Sharing with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"9","level":2},{"slug":"lectures.master-asi-conae.s2-sca","title":"Sentinel-2 snow cover area (SCA) time series","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Test","level":3},{"slug":"lectures.master-asi-conae.test.s1","title":"S1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s2-sca-sh","title":"S2 Sca Sh","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s2-snowcover-test","title":"Sentinel-2 snow cover","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s3-ndsi","title":"List all the available dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.test-s1-s3","title":"Sentinel-1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4}]}]},"page":{"version":3,"kind":"Notebook","sha256":"2153c52643da113d0453e8d3a3df6eb4bafca716659247568d7b612d6e9c2bda","slug":"lectures.formats-and-performance.exercises.chunking","location":"/lectures/2.4_formats_and_performance/exercises/24_chunking.ipynb","dependencies":[],"frontmatter":{"title":"2.4 Data chunking with Pangeo","content_includes_title":true,"kernelspec":{"name":"conda-env-cubes-and-clouds-pangeo-py","display_name":"cubes-and-clouds-pangeo","language":"python"},"github":"https://github.com/EO-college/cubes-and-clouds","subject":"Cubes and Clouds learning materials","numbering":{"title":{"offset":3}},"source_url":"https://github.com/EO-college/cubes-and-clouds/blob/main/lectures/2.4_formats_and_performance/exercises/24_chunking.ipynb","edit_url":"https://github.com/EO-college/cubes-and-clouds/edit/main/lectures/2.4_formats_and_performance/exercises/24_chunking.ipynb","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","exports":[{"format":"ipynb","filename":"24_chunking.ipynb","url":"/cubes-and-clouds/build/24_chunking-9cfd4f8be1df7da0874e395cd95e9b04.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"image","style":{"float":"center","marginRight":"10px"},"url":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","alt":"Cubes \u0026 Clouds logo","key":"JSImMo9HAJ","urlSource":"https://raw.githubusercontent.com/EO-College/cubes-and-clouds/main/icons/cnc_3icons_process_circle.svg"}],"key":"zXNG8lAFtc"}],"visibility":"show","key":"M4APoJ1Ka9"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"image","style":{"float":"center","marginRight":"10px"},"url":"/cubes-and-clouds/build/0f8adf2e4ec0feb14584840545a0ae3a.png","alt":"Pangeo logo","key":"yUEUKzsi07","urlSource":"https://raw.githubusercontent.com/pangeo-data/pangeo.io/refs/heads/main/public/Pangeo-assets/pangeo_logo.png"}],"key":"WXlHzXdXEG"}],"key":"K6RaHxWht1"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.4 Data chunking with Pangeo","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dzmSsdD09C"}],"identifier":"id-2-4-data-chunking-with-pangeo","label":"2.4 Data chunking with Pangeo","html_id":"id-2-4-data-chunking-with-pangeo","implicit":true,"key":"hb8s5drKmJ"},{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Data chunking","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gUURC3XRDz"}],"identifier":"data-chunking","label":"Data chunking","html_id":"data-chunking","implicit":true,"key":"o2e7zCVdRE"}],"key":"uInv8DCrmn"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"alert alert-info","children":[{"type":"emphasis","children":[],"key":"r0TMNh2IKD"},{"type":"strong","children":[{"type":"text","value":"Overview","key":"ghrFQSCjA2"}],"key":"PPJwH7TVFh"},{"type":"text","value":" ","key":"fERrhWrXyU"},{"type":"break","key":"ht4DGWoMc7"},{"type":"break","key":"TxcDaHIInP"},{"type":"strong","children":[{"type":"text","value":"Questions","key":"L5Pd4AzJxp"}],"key":"XKtuyqMxtS"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"What is chunking and why does it matter?","key":"e6jGiLn1zF"}],"key":"YCBKj8Vsfp"}],"key":"ohgG5Am7NJ"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"How can we utilize chunking to make our processing more efficient?","key":"U6F6mABlr0"}],"key":"BhD2WcZJXo"}],"key":"lIxkl6oebK"}],"key":"yC2rjschKn"},{"type":"strong","children":[{"type":"text","value":"Objectives","key":"hJdrIr8E7u"}],"key":"xtITMbXUUi"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Explore chunking of data","key":"KKeNUBYOXW"}],"key":"fGV53PvJX6"}],"key":"ziO9jVZT89"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Learn about the Zarr file format","key":"lSwGQdnCn6"}],"key":"jkFdTsIvmn"}],"key":"JKq67AWxLL"}],"key":"XCzm1Wmdoq"}],"key":"xNatO8sBtE"}],"key":"rdFI8oSYqy"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Context","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Crq8HDD4gq"}],"identifier":"context","label":"Context","html_id":"context","implicit":true,"key":"V09gW8Ywc4"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"As explained in Section 2.4 - Formats and Performance, when working with large data files or collections, it is often impractical to load the entire dataset into the memory of a single computer at once. This is where the Pangeo ecosystem is particularly useful. In Section 2.3 - Data Access, we discussed the concept of lazy loading. Xarray enables lazy processing of data in ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"u2yUX1gVOv"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"chunks","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sVUqSPoPdZ"}],"key":"o4LHwftkFa"},{"type":"text","value":", meaning the dataset is divided into manageable pieces. By reading and processing the data in these chunks, we can efficiently handle large datasets on a single computer or scale the processing to a distributed computing cluster using Dask (e.g., on the cloud or high-performance computing environments).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RH7oVtTd2S"}],"key":"WhUZq5ZbdY"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"How we process these chunks in a parallel environment to scale our computation vertically is discussed in ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TGWVxiI1L3"},{"type":"link","url":"./dask.ipynb","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"2.4 dask","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"FlsGv7LVM7"}],"urlSource":"./dask.ipynb","key":"cipmQHUaM4"},{"type":"text","value":". In this notebook, you will explore the concept of chunks through various exercises.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"FwuJsyNHCA"}],"key":"RPas9kkTui"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Processing data piece by piece is more efficient when both our input and output data are also stored in chunks. As introduced in Section 2.4 - Formats and Performance, ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"hcc9bjF7ya"},{"type":"link","url":"https://zarr.readthedocs.io/en/stable/","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Zarr","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dVjpDzp2FY"}],"urlSource":"https://zarr.readthedocs.io/en/stable/","key":"Rkzkh6P96f"},{"type":"text","value":" is a cloud-native data format and serves as the reference library in the Pangeo ecosystem for storing Xarray multi-dimensional datasets in ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"woTnpfwlUC"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"chunks","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Lz5KmieTpw"}],"key":"gyfvlSRnY1"},{"type":"text","value":".","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"D6K666uoYZ"}],"key":"mD2FirNTlm"},{"type":"heading","depth":2,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Data","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"LbIE6DSJBG"}],"identifier":"data","label":"Data","html_id":"data","implicit":true,"key":"lWM1ySyuTK"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"We’ll begin with the same sample data retrieval method from the Sentinel-2 STAC collection, as described in Exercise 2.3 - Data Access: Lazy Loading with Pangeo.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"qoHYCPAZx0"}],"key":"YRMcVtbf07"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"The analysis will be similar to our previous exercises, but this time, we’ll use a larger spatial extent to demonstrate the scalability.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"wPWL4LNDOl"}],"key":"WUaBjn26vT"}],"key":"oCTtiuaCmk"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We start by copying the data files needed to complete the exercise using the following shell commands","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zf1fRFk1cg"}],"key":"WfHXve2ro5"}],"key":"UDi1XOzzhG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"!cp -r ${DATA_PATH%/*/*}/notebooks/cubes-and-clouds/lectures/2.4_formats_and_performance/exercises/assets $HOME/","key":"qSBiFjGXVu"},{"type":"outputs","id":"hG4SMixJJUqodbrP4dlT2","children":[],"key":"l2jPj7KXzj"}],"key":"lH3u1jqs6e"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load Libraries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BAxFSGmvHb"}],"identifier":"load-libraries","label":"Load Libraries","html_id":"load-libraries","implicit":true,"key":"Ricdwm8c1l"}],"key":"iEX76iBBVq"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import pystac_client\nimport geopandas as gpd\nfrom shapely.geometry import mapping\nimport stackstac\nimport warnings\nimport xarray as xr\nimport numpy as np\nimport rioxarray as rio\nwarnings.filterwarnings(\"ignore\")","visibility":"show","key":"mg8mBadFx2"},{"type":"outputs","id":"gjKpkUrRSgWr40lqfT2gk","children":[],"visibility":"show","key":"vr0aUreTPJ"}],"visibility":"show","key":"TFUu7qfNeC"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load Sentinel-2 data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HOnVoPYgWA"}],"identifier":"load-sentinel-2-data","label":"Load Sentinel-2 data","html_id":"load-sentinel-2-data","implicit":true,"key":"BgCtwM4Jug"}],"key":"BpIjcfJvTQ"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"aoi = gpd.read_file('./assets/catchment_outline.geojson', crs=\"EPGS:4326\")\naoi_geojson = mapping(aoi.iloc[0].geometry)\nURL = \"https://earth-search.aws.element84.com/v1\"\ncatalog = pystac_client.Client.open(URL)\nitems = catalog.search(\n    intersects=aoi_geojson,\n    collections=[\"sentinel-2-l2a\"],\n    datetime=\"2019-02-01/2019-04-28\",\n    query= {\"proj:epsg\": dict(eq=32632)}\n).item_collection()\nsentinel2_l2a = stackstac.stack(items,assets=[\"red\",\"nir\"])\nsentinel2_l2a","visibility":"show","key":"zOCpUNSMHj"},{"type":"outputs","id":"dsmIU_m9gZDUjXj7k3UaZ","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"8829f35713ef4c3e6d59b6a28e196371","path":"/cubes-and-clouds/build/8829f35713ef4c3e6d59b6a28e196371.html"},"text/plain":{"content":"\u003cxarray.DataArray 'stackstac-f894a3199a26ac192d38b34c9e3f8445' (time: 102,\n                                                                band: 2,\n                                                                y: 20982,\n                                                                x: 10980)\u003e Size: 376GB\ndask.array\u003cfetch_raster_window, shape=(102, 2, 20982, 10980), dtype=float64, chunksize=(1, 1, 1024, 1024), chunktype=numpy.ndarray\u003e\nCoordinates: (12/52)\n  * time                                     (time) datetime64[ns] 816B 2019-...\n    id                                       (time) \u003cU24 10kB 'S2B_32TPT_2019...\n  * band                                     (band) \u003cU3 24B 'red' 'nir'\n  * x                                        (x) float64 88kB 6e+05 ... 7.098...\n  * y                                        (y) float64 168kB 5.3e+06 ... 5....\n    s2:nodata_pixel_percentage               (time) object 816B 0.000103 ... ...\n    ...                                       ...\n    proj:centroid                            (time) object 816B None ... None\n    view:incidence_angle                     (time) object 816B None ... None\n    view:azimuth                             (time) object 816B None ... None\n    gsd                                      int64 8B 10\n    proj:shape                               object 8B {10980}\n    epsg                                     int64 8B 32632\nAttributes:\n    spec:        RasterSpec(epsg=32632, bounds=(600000.0, 5090220.0, 709800.0...\n    crs:         epsg:32632\n    transform:   | 10.00, 0.00, 600000.00|\\n| 0.00,-10.00, 5300040.00|\\n| 0.0...\n    resolution:  10.0","content_type":"text/plain"}}},"children":[],"key":"x6HIKDJrKw"}],"visibility":"show","key":"C7lYL7ZMJF"}],"visibility":"show","key":"vS1r7l9r7Z"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"What is a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CCKCmakrw6"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Chunk","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o7eYcgtGWo"}],"key":"VpLlWSyvxp"},{"type":"text","value":"?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KaAyVHrf5l"}],"identifier":"what-is-a-chunk","label":"What is a Chunk?","html_id":"what-is-a-chunk","implicit":true,"key":"tOWvzaKXVB"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"If you closely examine the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mjv7wYwHoV"},{"type":"inlineCode","value":"sentinel2_l2a","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tpmhE2MJZl"},{"type":"text","value":" dataset, you’ll notice that the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eZiaQ62ILB"},{"type":"inlineCode","value":"xarray.DataArray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Zh1ldOtAem"},{"type":"text","value":" is backed by a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lyqPaZ1ri3"},{"type":"inlineCode","value":"dask.array","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DgpCFtuaKp"},{"type":"text","value":" with a chunk size of ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zC4UtlEEY4"},{"type":"inlineCode","value":"(1, 1, 1024, 1024)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hvD72hRNYt"},{"type":"text","value":". The full dataset consists of arrays with dimensions ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jbluEbr30r"},{"type":"inlineCode","value":"(102, 2, 20982, 10980)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"T56SgsLUII"},{"type":"text","value":", totaling 47,124 chunks, which amounts to 350.16 GiB of data potentially loaded into the computer’s RAM.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"og7amz9DPM"}],"key":"iG2YAszhIX"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"You can view the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"SA1uOpR66f"},{"type":"inlineCode","value":"dask.array","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ZQz2qvCunI"},{"type":"text","value":" information by clicking the blue-circled icon in the image below.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"dgXwMH3fQS"}],"key":"RPVq62NTy8"},{"type":"image","url":"/cubes-and-clouds/build/4e7b4046c0507a2dc115bda61e72c2f0.png","alt":"Dask.array","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ezvep3a2YK","urlSource":"https://raw.githubusercontent.com/EO-College/cubes-and-clouds/refs/heads/main/lectures/2.4_formats_and_performance/exercises/assets/datasize.png"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"By clicking the red-circled triangle icon, you’ll see detailed information about the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"w7dlF6qBk0"},{"type":"inlineCode","value":"xarray.DataArray","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"BIt30OPANP"},{"type":"text","value":", including its Coordinates, Indexes, and Attributes.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"CMBvOSMfBe"}],"key":"g3gZ4FQ2nx"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"When creating an ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"i3vqysVqF6"},{"type":"inlineCode","value":"Xarray","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"wHr34lkfjY"},{"type":"text","value":" object using ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"LSarOGi7Xs"},{"type":"inlineCode","value":"stackstac","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"kD8DL9CTYS"},{"type":"text","value":", we can easily convert a STAC collection into a lazily-loaded, chunked ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"U2jeB0jsrI"},{"type":"inlineCode","value":"xarray.DataArray","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"hZazLCQNJq"},{"type":"text","value":" backed by Dask.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"PEKRHlAjEs"}],"key":"HhYmRoo9UL"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"The size and shape of the chunks determine the level of parallelization performed by Dask. Therefore, selecting an appropriate chunk size can significantly impact the performance of your computation.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"xiS2URzVQh"}],"key":"ldFHe3uHi7"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"This is where understanding and effectively using chunking becomes crucial.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"L2081XAhcl"}],"key":"eWc6CBRzOY"}],"visibility":"show","key":"rBvHvuc95X"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In our case, for the moment, we used ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RYGFONgYgQ"},{"type":"inlineCode","value":"stackstac","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zX2ZMpBC5X"},{"type":"text","value":" without specifying the ‘chunk’ explicitly. The dataset is composed of 8 MiB chunks, each containing 1 time step, 1 band, and a resolution of 1024 x 1024 in the x and y directions.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jzMkgQ3qDY"}],"key":"r82biVoirC"},{"type":"image","url":"/cubes-and-clouds/build/2ef91feac1ae68f3219ac81953a16827.png","alt":"chunk_original","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Eeb46EfP13","urlSource":"https://raw.githubusercontent.com/EO-College/cubes-and-clouds/refs/heads/main/lectures/2.4_formats_and_performance/exercises/assets/chunk_original.png"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"If the chunk size is too small, our workflow will be divided into too many tiny pieces, which can lead to excessive communication and increased distribution overhead.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jqedpnWS4j"}],"key":"cYgLsyn5nF"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"On the other hand, if the chunk size is too large, there may not be enough memory available to handle the workload, causing the workflow to fail.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"K7bcFsr90V"}],"key":"YIidiWxWUI"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The optimal chunk size depends on both your computation and the machine you’re using.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"OQD792LZiq"}],"key":"AAHWZJhFHh"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"For example, 8 MiB is relatively small compared to the typical RAM size available. Dask’s default array chunk size, for instance, is 128 MiB.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"C9AvMW3bcK"}],"key":"j9E2aBNayy"}],"key":"ugEJ8QMZBF"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import dask\ndask.config.get('array.chunk-size')","visibility":"show","key":"y7qnnj3Z4X"},{"type":"outputs","id":"AJY8XlAcm22cElQcAwqTs","children":[],"visibility":"show","key":"c3eIrMyCiw"}],"visibility":"show","key":"OxZZThoK36"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Modifying chunks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bvw1AJhawk"}],"identifier":"modifying-chunks","label":"Modifying chunks","html_id":"modifying-chunks","implicit":true,"key":"vFyl3oyT7C"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Let’s try to modify our chunk size.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"W68k9p7YzT"}],"key":"w5o00Im63l"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"To modify chunks on your existing ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"itCBgVRnvS"},{"type":"inlineCode","value":"xarray.DataArray","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Tyj8FVMJEs"},{"type":"text","value":" we can use the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Wl8b79o7Hr"},{"type":"inlineCode","value":"chunk","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"IwdvyQpZAj"},{"type":"text","value":" method.\nWe know that we only need 2 bands to compute the Normalized Difference Vegetation Index (NDVI) example, so we select only ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"akR7iW6J4j"},{"type":"inlineCode","value":"red","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jSSdtK6U0M"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"bIdt6QuqTq"},{"type":"inlineCode","value":"nir","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"mdPwT9nkF2"},{"type":"text","value":" to simplify our example.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"AUfb3w6zX7"}],"key":"NCEfBf1r0h"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"We would like to have each time series separated in each chunk, then keep all band information on one chunk, and let dask to compute x and y coordinate’s chunk size.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"MkCH54j2no"}],"key":"v478OnLqqR"}],"key":"Pu2OMJKU3H"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def NDVI(data):\n    red = data.sel(band=\"red\")\n    nir = data.sel(band=\"nir\")\n    ndvi = (nir - red)/(nir + red)\n    return ndvi\n\nndvi_xr = NDVI(sentinel2_l2a)\nndvi_xr","key":"RpQqozosWD"},{"type":"outputs","id":"UewqMnDfWtQr2nION5RJX","children":[],"key":"cHTKoRAL3O"}],"key":"wMC2TSpQzK"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"sentinel2_l2a = sentinel2_l2a.sel(\n    band=['red','nir']).chunk(\n    chunks={'time': 1, 'band':2, 'x':'auto','y':'auto'})\nsentinel2_l2a","visibility":"show","key":"PuN2Oig4Qq"},{"type":"outputs","id":"1Bc4CVfpU9orAroQjQsx9","children":[],"visibility":"show","key":"bGj2fjCqX2"}],"visibility":"show","key":"a6ZL1XBwka"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"If you look into the details of any variable in the representation above, you’ll see that each x and y coordinate’s chunk is bigger, and we have less chunks than the example before.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"igD1O91dwY"}],"key":"I1pwOHK8pK"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Note here from the chunk size, the auto option computed the optimal chunk size for y and x if we want to keep the chunk size of time and band as 1 and 2 respectively.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UBXtWeN8K3"}],"key":"rr2WwjSfOG"}],"key":"F2rMg9q26W"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"alert alert-warning","children":[{"type":"emphasis","children":[],"key":"hkMTgybf28"},{"type":"strong","children":[{"type":"text","value":"Go Further","key":"gTus8gY14h"}],"key":"TYn11AzKgk"},{"type":"text","value":" ","key":"PCu0p0DSa7"},{"type":"break","key":"dmah18jHVu"},{"type":"break","key":"TdlUpPrlFF"},{"type":"text","value":"You can try to apply different ways for specifying chunk.","key":"dNpyRfQzHY"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"chunks = -1 -\u003e the entire array will be used as a single chunk","key":"EDsQXphnE6"}],"key":"TESlaerypn"}],"key":"jyp4AxvZpo"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"chunks = {'x':-1, 'y': 1000} -\u003e chunks of entire _x_ dimension, but splitted every 1000 values on _y_ dimension","key":"PIheVAYBej"}],"key":"EH8xpUZgbF"}],"key":"jCf8EwUBeK"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"chunks = {'x':-1, 'y': 'auto'} -\u003e Xarray relies on Dask to use an ideal size according to the preferred chunk sizes for _y_ dimension","key":"jvvqePfxIw"}],"key":"P1DtugL5Ra"}],"key":"kmGzDOJTGL"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"chunks = { 'x':-1 ,'y':\"500MiB\" } -\u003e Xarray seeks the size according to a specific memory target expressed in MiB","key":"s5aMOIMj0x"}],"key":"XdgVJpsc2w"}],"key":"oSVN8ckknr"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"chunks = ( 1, 3, 12048,2048) -\u003e Specifying chunk size in the order of dimension.","key":"f7duEVH15A"}],"key":"i0sUtCgGmC"}],"key":"WX1dr2Rr4M"}],"key":"KDuexOtskh"}],"key":"q28rK5T6wM"}],"key":"TPrhA8QwZw"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Defining the chunk size at the creation with Xarray","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XAprQdGqN3"}],"identifier":"defining-the-chunk-size-at-the-creation-with-xarray","label":"Defining the chunk size at the creation with Xarray","html_id":"defining-the-chunk-size-at-the-creation-with-xarray","implicit":true,"key":"bDAyRdX1F5"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We can define the chunk size when we create the object.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MYET32vus8"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"t1EcB5pdIp"},{"type":"text","value":"This is usually done with Xarray using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bA3obOUpD2"},{"type":"inlineCode","value":"chunks","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IfvTLJfq5X"},{"type":"text","value":" kwarg when opening a file with ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wM4NqYEm1w"},{"type":"inlineCode","value":"xr.open_dataset","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NsGD8Zaqxg"},{"type":"text","value":" or with ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IK7PZtXzsx"},{"type":"inlineCode","value":"xr.open_mfdataset","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PzEqmNSviw"},{"type":"text","value":", if you create Xarray from your local file.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QjE8kO7DCk"}],"key":"ZIFvgNkhso"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"In our NDVI example, we create Xarray from ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Wgm9SvKHto"},{"type":"inlineCode","value":"stackstac","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"xKxzezxKTM"},{"type":"text","value":". As ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"MaUlCer7IP"},{"type":"inlineCode","value":"stackstac","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"UVHTzZeg58"},{"type":"text","value":"’s default ‘chunksize’ definition is 1024 for the x and y dimensions, we had that chunk size. We can pass the ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"whxnlq4QKo"},{"type":"inlineCode","value":"chunksize","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ClFLBqDmpp"},{"type":"text","value":" option to ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"jzRchTCvyC"},{"type":"inlineCode","value":"stackstac","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"hA4SC0oEm0"},{"type":"text","value":" and make it larger.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"EogrFS3gxO"}],"key":"QKBer4zmFZ"}],"key":"ARCaZmg9Ek"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"%%time\nsentinel2_l2a = stackstac.stack(items,\n                                assets=['red','nir'],\n                                chunksize=( 1, 2, 2048,2048)\n)\nsentinel2_l2a","visibility":"show","key":"aDw9KoA1OJ"},{"type":"outputs","id":"jyK34MI5cgKpP7sHd3pdl","children":[],"visibility":"show","key":"GzvueADExq"}],"visibility":"show","key":"nzbYdmZQfH"},{"type":"block","kind":"notebook-content","data":{"jp-MarkdownHeadingCollapsed":true,"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"So, why chunks?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ilc5osxpi9"}],"identifier":"so-why-chunks","label":"So, why chunks?","html_id":"so-why-chunks","implicit":true,"key":"wgZc3SpEG8"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"As explained in ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"s8QgnUFt6L"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Section 2.4 - Formats and Performance","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZyANQd1Gmm"}],"key":"dxdW1TX8ZR"},{"type":"text","value":", chunks are mandatory for accessing files or datasets that are larger than a single computer’s memory. If all the data has to be accessed, it can be done sequentially (i.e., chunks are processed one after the other).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zhm0MT2fs1"}],"key":"yh9uYBvfnq"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Moreover, chunks allow for distributed processing and increased speed for your data analysis, as seen in the next section.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QD4F0HYpeT"}],"key":"mVjgP4EIXr"},{"type":"heading","depth":3,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Chunks and files","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"l6xYIWLlPF"}],"identifier":"chunks-and-files","label":"Chunks and files","html_id":"chunks-and-files","implicit":true,"key":"GEUg5fONKm"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Xarray chunking capabilities also depend on the underlying input or output file format used. Most modern file formats allow datasets or single files to be stored using chunks. For example, ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"jGS8WjbkrB"},{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"NetCDF4","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"h6bu7d8UaO"}],"key":"Q15mfIJ4rJ"},{"type":"text","value":" uses chunks when storing a file on the disk via HDF5. Any read of data from a NetCDF4 file will load at least one chunk of that file. So when reading one of its chunks as defined in the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"zqfygSd3Yq"},{"type":"inlineCode","value":"open_dataset","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"rqWsvFV8F2"},{"type":"text","value":" call, Xarray will take advantage of native file chunking and won’t need to read the entire file.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"vh4KpO4V7P"}],"key":"nJC7uqUzBy"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"However, it is important to note that ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"iMXPpFCON9"},{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Xarray chunks and file chunks are not necessarily the same","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"TPR0memcgp"}],"key":"rBJxaGAGgM"},{"type":"text","value":". It is a good practice to configure Xarray chunks so that they align well with the input file format chunks (ideally, Xarray chunks should contain one or several input file chunks).","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ML8KUxFkd3"}],"key":"U6zNoPLfVO"}],"visibility":"show","key":"ap4aqyWPHH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Zarr storage format","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"s8i7CrXrMP"}],"identifier":"zarr-storage-format","label":"Zarr storage format","html_id":"zarr-storage-format","implicit":true,"key":"mtPgtFtJxu"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This brings us to our next subject: ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kTCgp7Hcbt"},{"type":"link","url":"https://zarr.readthedocs.io/en/stable/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Zarr","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mAcpADeP3B"}],"urlSource":"https://zarr.readthedocs.io/en/stable/","key":"e7lKWtXQsS"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xXheuRFqQI"}],"key":"XOAXYucHSt"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"If we can have our original dataset already ‘chunked’ and accessed in an optimized way according to its actual byte storage on disk, we won’t need to load the entire dataset every time. This can greatly optimize our data analysis, even when working with the entire dataset.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"zaiFYq0tOx"}],"key":"DLVsxUGjQc"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Let’s convert our intermediate data into Zarr format so that we can learn what it is. We can keep the data as a ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Ut379QeCIl"},{"type":"inlineCode","value":"DataArray","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"AqR69reG0N"},{"type":"text","value":" or convert it into a ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"PZ0R8Zz1P1"},{"type":"inlineCode","value":"Dataset","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"yULrEuBRPN"},{"type":"text","value":" before storing it.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"g0bJisSQ9B"}],"key":"IoTVNr9UwS"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"We start again by loading data using ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"n6tnalwIjU"},{"type":"inlineCode","value":"stackstac","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Xzr3mkNMPh"},{"type":"text","value":", but this time, we proceed to the next step: clipping the data and computing the NDVI. Then, let’s try to save those intermediate results in a Zarr file.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"y2HkypmTSk"}],"key":"banYyPd7CW"}],"key":"dCFmO6qTru"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Data Loading","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cwd3QwMJVY"}],"identifier":"data-loading","label":"Data Loading","html_id":"data-loading","implicit":true,"key":"otwLrJ0WL2"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Load data using stackstac (with specific chunk size)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"M091KhZ1Jn"}],"key":"PcbIXR7Lt3"}],"visibility":"show","key":"xYRtPIIGpY"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"aoi = gpd.read_file(\"./assets/catchment_outline.geojson\", crs=\"EPGS:4326\")\naoi_geojson = mapping(aoi.iloc[0].geometry)\nURL = \"https://earth-search.aws.element84.com/v1\"\ncatalog = pystac_client.Client.open(URL)\nitems = catalog.search(\n    intersects=aoi_geojson,\n    collections=[\"sentinel-2-l2a\"],\n    datetime=\"2019-02-01/2019-04-28\",\n    query= {\"proj:epsg\": dict(eq=32632)}\n).item_collection()\nds = stackstac.stack(items,\n                     assets=['red','nir'],\n                     chunksize=( 1, 2, 1024,1024)\n)","visibility":"show","key":"gxsoYlBU9U"},{"type":"outputs","id":"tR0KoSrA8Ea5zTVbhmEn4","children":[],"visibility":"show","key":"b2eKbJRHw4"}],"visibility":"show","key":"RbbnPiwRlH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"NDVI computation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"H0m7Y7WTLr"}],"identifier":"ndvi-computation","label":"NDVI computation","html_id":"ndvi-computation","implicit":true,"key":"L4k4C1DMSj"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Compute the NDVI as in 2.3 Data Access - Reduce","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ftnJUfhiKT"}],"key":"YeUdU4aKSo"}],"key":"UMsUUNoICD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def NDVI(data):\n    red = data.sel(band=\"red\")\n    nir = data.sel(band=\"nir\")\n    ndvi = (nir - red)/(nir + red)\n    return ndvi\n\nndvi_xr = NDVI(ds)","key":"QrxVKLnpSq"},{"type":"outputs","id":"IF6SBSRzIqNifNyut4VCt","children":[],"key":"enFzvr48sz"}],"key":"fjhd2Pe3z8"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Spatial clipping","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HBMb5BnQCT"}],"identifier":"spatial-clipping","label":"Spatial clipping","html_id":"spatial-clipping","implicit":true,"key":"dSMvN87YyY"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Restrict the data to the area of interest from the loaded polygon","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WXPVX7rSYm"}],"key":"OBg30RnhbF"}],"key":"YvQ3lxHiJR"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"aoi_utm32 = aoi.to_crs(epsg=32632)\ngeom_utm32 = aoi_utm32.iloc[0]['geometry']\nndvi_xr.rio.write_crs(\"EPSG:32632\", inplace=True)\nndvi_xr.rio.set_nodata(np.nan, inplace=True)\nndvi_xr = ndvi_xr.rio.clip([geom_utm32])","visibility":"show","key":"wcx3dvAdxU"},{"type":"outputs","id":"LZcm6aanDbgKTQWMZ3WB-","children":[],"visibility":"show","key":"ykCZsuUw0V"}],"visibility":"show","key":"aDUrHWBgLJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Save to Zarr","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fT32QE0VPL"}],"identifier":"save-to-zarr","label":"Save to Zarr","html_id":"save-to-zarr","implicit":true,"key":"VdPDmMgEln"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Select just a few days, to reduce the amount of data for this example","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"p0bP9Uy1nN"}],"key":"g1amTAjfVA"}],"key":"qLdEts5wrH"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ndvi_small = ndvi_xr.isel(time=slice(0,3))\nndvi_small","visibility":"show","key":"C5c22gRrZa"},{"type":"outputs","id":"epvEdIpCqMA5CoTtFr1WB","children":[],"visibility":"show","key":"WlXzF7gKSB"}],"visibility":"show","key":"H5xmvAcIwk"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Before saving, we can modify the chunk shape","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qHO7GIhgUT"}],"key":"e576Grduwx"}],"key":"L62cfBEAWl"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ndvi_small = ndvi_small.chunk(chunks = {'x':'auto', 'y': 'auto'}).to_dataset(name='data')\nndvi_small","visibility":"show","key":"tl31UfJh21"},{"type":"outputs","id":"Xbo_9_xQw_bPVTtb-42YN","children":[],"visibility":"show","key":"rEVU51Qriz"}],"visibility":"show","key":"man7TaUZGy"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Then clean attributes that might create issues while writing and save to Zarr","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wQI5GJjIYt"}],"key":"EYR6II5fd0"}],"key":"inwbhFwV6T"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n\ndef remove_attrs(obj, to_remove):\n    new = obj.copy()\n    new.attrs = {k: v for k, v in obj.attrs.items() if k not in to_remove}\n    return new\n\ndef encode(obj):\n    object_coords = [name for name, coord in obj.coords.items() if coord.dtype.kind == \"O\"]\n    return obj.drop_vars(object_coords).pipe(remove_attrs, [\"spec\", \"transform\"])\n\nndvi_small.pipe(encode).to_zarr('test.zarr',mode='w')","visibility":"show","key":"tm1cnQMlCP"},{"type":"outputs","id":"W05eCP_xYRLPSpD4cGchc","children":[],"visibility":"show","key":"iOVeD1ctcK"}],"visibility":"show","key":"PnYSuLphJz"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"alert alert-warning","children":[{"type":"emphasis","children":[],"key":"qlCMehBvCK"},{"type":"strong","children":[{"type":"text","value":"Exercise","key":"SB15Ihls7c"}],"key":"dN7ZRLAE17"},{"type":"break","key":"lQ0bkyRz8x"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"What about saving the data in Netcdf format? `ls -la test.zarr` and `ls -la test.zarr/nobs `","key":"Z0cM1QCvIE"}],"key":"Q2vw4xLkPR"}],"key":"ZYF638FcAF"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"You can try to explore the zarr file you just created using `ls -la test.zarr` and `ls -la test.zarr/nobs `","key":"TIqpqG5VYo"}],"key":"RewouLwMVi"}],"key":"RDXQHp15mM"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"You can explore zarr metadata file by `cat test.zarr/.zmetadata`","key":"an3RT9wqSO"}],"key":"l1J649WxE0"}],"key":"GqsslpXDI2"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Did you find the __chunks__ we defined previously in your zarr file?","key":"VAQkBjXbff"}],"key":"LEgPxXMrWH"}],"key":"Bmz4WYvvNg"}],"key":"ncfeZT74KM"}],"key":"ogYMIOqeYD"}],"key":"IagXwwNOzB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Compare Zarr and netCDF","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"voLQVdINEY"}],"identifier":"compare-zarr-and-netcdf","label":"Compare Zarr and netCDF","html_id":"compare-zarr-and-netcdf","implicit":true,"key":"dPhZpMdZWv"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Lets compare how the zarr and NetCDF files are stored.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"K2tB82ZzJq"},{"type":"break","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"rUyRN8ubGh"},{"type":"text","value":"We read our sample dataset from Zarr and store it as netCDF:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"R6EWotpnPC"}],"key":"Yaq9SkLIGG"}],"key":"kFatq8xCVp"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"xr.open_zarr('test.zarr').to_netcdf('test.nc')","visibility":"show","key":"RorFSSSRw8"},{"type":"outputs","id":"dQ-N188SOHpyZAJ76Xvvk","children":[],"visibility":"show","key":"B2PCrtP9B7"}],"visibility":"show","key":"z6FhYDWoKM"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Compare the disk space used by the two formats:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gE06t4nLrW"}],"key":"Qq1z4IgBGt"}],"key":"e6uruNbgQ8"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"!du -sh test.zarr/ test.nc","visibility":"show","key":"rpiHCcXrgN"},{"type":"outputs","id":"_G4wx61AXyUK0WW8e_nkT","children":[],"visibility":"show","key":"kQNuS5pgV4"}],"visibility":"show","key":"WhSp52t29G"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"List the content of the Zarr directory:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"f6n6ncoxhD"}],"key":"TSNFSz8zb1"}],"key":"jDd5loKynw"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"!ls  -la test.zarr/","visibility":"show","key":"H5OaSmwhfN"},{"type":"outputs","id":"_G0xSziqGqZUn2u85ob0c","children":[],"visibility":"show","key":"gIyJv1wFR2"}],"visibility":"show","key":"HNJYeLQwn1"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"List the content of the Zarr data directory:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GXy0MVQBne"}],"key":"ibutqudyc3"}],"key":"jQXJ9Nqsce"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"!ls  -la test.zarr/data","visibility":"show","key":"w3erHwupQu"},{"type":"outputs","id":"kmH0AOfEeibITVCGmF-VP","children":[],"visibility":"show","key":"Tkp4cpDRXV"}],"visibility":"show","key":"CEWXyTaYnC"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Print the content of the Zarr metadata file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"asynzBVZcC"}],"key":"pnz3SqGD3a"}],"key":"i85Fn90LMf"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"!cat test.zarr/.zmetadata | head -n 30","visibility":"show","key":"BkJJhmMidv"},{"type":"outputs","id":"F8gGviBgBS0cVB7fq9_V4","children":[],"visibility":"show","key":"rCNqUTjBf5"}],"visibility":"show","key":"G1hBwSFsUh"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Zarr format main characteristics","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Tik7qxUKaL"}],"identifier":"zarr-format-main-characteristics","label":"Zarr format main characteristics","html_id":"zarr-format-main-characteristics","implicit":true,"key":"VYXieoy4d1"}],"key":"AyyDvHWT40"},{"type":"block","kind":"notebook-content","children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Every chunk of a Zarr dataset is stored as a single file (see x.y files in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I75MCWpZRe"},{"type":"inlineCode","value":"ls -al test.zarr/data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WTXEV9JFQD"},{"type":"text","value":")","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HfANCvf05v"}],"key":"VtoukKl7GB"}],"key":"NKWb1f8adX"},{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Each Data array in a Zarr dataset has a two unique files containing metadata:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"vSLlixHfgP"}],"key":"zYiGW9Keq5"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":".zattrs for dataset or dataarray general metadatas","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lXwKaoQAtV"}],"key":"GXdtRTOf4z"}],"key":"AWpwL0UZSc"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":".zarray indicating how the dataarray is chunked, and where to find them on disk or other storage.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"omrI9TOAIa"}],"key":"m9HKtthaTe"}],"key":"DXmkZ4m3Lm"}],"key":"Vy7CwZoEP6"}],"key":"f3X1rFMHH2"}],"key":"zl7ZJNU16K"}],"key":"vuiMxoIe0l"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Conclusion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KufTbjcLr3"}],"identifier":"conclusion","label":"Conclusion","html_id":"conclusion","implicit":true,"key":"sVRX3wG1hT"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Understanding chunking is key to optimize your data analysis when dealing with large datasets. In this exercise, we learned how to optimize data access time and memory resources by using native file chunks loaded by stackstac and instructing Xarray to modify the chunk. Computing on large datasets can be very slow on a single machine, and to optimize your time we may need to parallelize your computations. This is what you will learn in the next exercise with Dask.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nh65UDfPcx"}],"key":"jdTxRD2OH8"}],"key":"bjFSRCSuB3"}],"key":"P9lWpl9KV5"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Data Formats and Performance","url":"/lectures/formats-and-performance/formats-and-performance","group":"2"},"next":{"title":"2.4 Scaling with Pangeo","url":"/lectures/formats-and-performance/exercises/dask","group":"Exercises"}}},"domain":"http://localhost:3000"},"project":{"subject":"Cubes and Clouds learning materials","title":"Cubes and Clouds Notebooks","description":"Collection of Cubes and Clouds learning notebooks","github":"https://github.com/EO-college/cubes-and-clouds","id":"7095e86f-a94c-4858-b97b-80694fdbcdf1","thumbnail":"/cubes-and-clouds/build/4e7b95cc5159f11ae65e2049a64650a6.svg","exports":[],"bibliography":[],"index":"readme","pages":[{"slug":"contributing","title":"How to contribute","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"contributors","title":"Contributors","description":"","date":"","thumbnail":"/cubes-and-clouds/build/bee0df1dcfe29799901d54c333adae56.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"title":"Lectures","level":1},{"slug":"lectures.readme","title":"Lectures","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"Introduction","level":2},{"slug":"lectures.introduction.introduction","title":"Introduction","description":"","date":"","thumbnail":"/cubes-and-clouds/build/864d3fc75ed1a08ac2d4c8f21d9d6a63.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.introduction.exercises.login","title":"0. Introduction","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"1","level":2},{"slug":"lectures.intro-platform.intro-platform","title":"Earth Observation cloud platforms","description":"","date":"","thumbnail":"/cubes-and-clouds/build/b334c40d1c998a2fb3e79e903892672d.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"1","level":2},{"slug":"lectures.data-cube.data-cube","title":"What is a data cube?","description":"","date":"","thumbnail":"/cubes-and-clouds/build/04b2802f47f308fa6a646bc15a8fe881.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"1","level":2},{"slug":"lectures.openscience.openscienceandfair","title":"Open Science and the FAIR Principles","description":"","date":"","thumbnail":"/cubes-and-clouds/build/3c3f883a861697088c44018dfa0c01af.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"lectures.openscience.opendataopensource","title":"Open Data and Open Source Software","description":"","date":"","thumbnail":"/cubes-and-clouds/build/bff8617b237519f0cffd390773f82d2d.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"lectures.openscience.openscienceineo","title":"The Open Science Journey - Open Science in geospatial, EO and EO cloud platforms","description":"","date":"","thumbnail":"/cubes-and-clouds/build/d4d5badaaff454a73f72620f2ac36c2e.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"2","level":2},{"slug":"lectures.data-discovery.data-discovery","title":"Data Discovery","description":"","date":"","thumbnail":"/cubes-and-clouds/build/3f9ff18207bbea501aede31c88cde0e5.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"2","level":2},{"slug":"lectures.data-properties.data-properties","title":"Data Properties","description":"","date":"","thumbnail":"/cubes-and-clouds/build/stac_standartization-36ffec2caaffa99c4330cb1a15d936d7.jpg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-properties.exercises.data-properties","title":"2.2 Data Discovery \u0026 Properties","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"2","level":2},{"slug":"lectures.data-access.data-access","title":"Access EO Data from the Cloud","description":"","date":"","thumbnail":"/cubes-and-clouds/build/dc_filter-ccdc08cafd02cb0631dceef04c842847.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"title":"Openeo","level":4},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-aggregate","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-apply","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-filter","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-lazy-loading","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-reduce","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-resample","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"Pangeo","level":4},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-aggregate","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-apply","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-filter","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-lazy-loading","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-reduce","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-resample","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"2","level":2},{"slug":"lectures.formats-and-performance.formats-and-performance","title":"Data Formats and Performance","description":"","date":"","thumbnail":"/cubes-and-clouds/build/96fdc48bce5685dcda930053ff412281.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.formats-and-performance.exercises.chunking","title":"2.4 Data chunking with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.formats-and-performance.exercises.dask","title":"2.4 Scaling with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.formats-and-performance.exercises.energy-consumption","title":"2.4 Formats and Performance","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"3","level":2},{"slug":"lectures.data-processing.data-processing","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/fe97d8f264069b8e4340c6b6ddcdf54e.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-processing.exercises.data-processing-openeo","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.data-processing.exercises.data-processing-pangeo","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"Alternatives","level":4},{"slug":"lectures.data-processing.exercises.alternatives.data-processing-openeo-platform","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-processing.exercises.alternatives.data-processing-stac","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"3","level":2},{"slug":"lectures.validation.validation","title":"Validation","description":"","date":"","thumbnail":"/cubes-and-clouds/build/distribution_map-482056cc9f982d5d3021d360525ae993.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.validation.exercises.validation-openeo","title":"3.2 Validation of the results with openEO","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.validation.exercises.validation-pangeo","title":"3.2 Validation of the results with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"3","level":2},{"slug":"lectures.data-sharing.data-sharing","title":"3.3 Data Sharing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/4066423c8fb88d808f30ad74224294b4.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-sharing.exercises.data-sharing-openeo","title":"3.3 Data Sharing with openEO","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.data-sharing.exercises.data-sharing-pangeo","title":"3.3 Data Sharing with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"9","level":2},{"slug":"lectures.master-asi-conae.s2-sca","title":"Sentinel-2 snow cover area (SCA) time series","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Test","level":3},{"slug":"lectures.master-asi-conae.test.s1","title":"S1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s2-sca-sh","title":"S2 Sca Sh","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s2-snowcover-test","title":"Sentinel-2 snow cover","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s3-ndsi","title":"List all the available dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.test-s1-s3","title":"Sentinel-1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/cubes-and-clouds/build/manifest-7B0967AD.js";
import * as route0 from "/cubes-and-clouds/build/root-EDJFWIEV.js";
import * as route1 from "/cubes-and-clouds/build/routes/$-AD65NCUT.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/cubes-and-clouds/build/entry.client-PCJPW7TK.js");</script></body></html>