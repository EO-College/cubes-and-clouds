<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>3.1 Data Processing - Cubes and Clouds Notebooks</title><meta property="og:title" content="3.1 Data Processing - Cubes and Clouds Notebooks"/><meta name="generator" content="mystmd"/><meta name="description" content="Collection of Cubes and Clouds learning notebooks"/><meta property="og:description" content="Collection of Cubes and Clouds learning notebooks"/><meta name="keywords" content=""/><meta name="image" content="/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg"/><meta property="og:image" content="/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg"/><link rel="stylesheet" href="/cubes-and-clouds/build/_assets/app-OIHP3NGU.css"/><link rel="stylesheet" href="/cubes-and-clouds/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/cubes-and-clouds/favicon.ico"/><link rel="stylesheet" href="/cubes-and-clouds/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block lg:hidden"><button class="myst-top-nav-menu-button flex items-center justify-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100 w-10 h-10"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/cubes-and-clouds/"><span class="text-md sm:text-xl tracking-tight sm:mr-5">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-10 h-10 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] lg:hidden hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="myst-fm-block-subject flex-none pr-2 smallcaps">Cubes and Clouds learning materials</div><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/EO-college/cubes-and-clouds" title="GitHub Repository: EO-college/cubes-and-clouds" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/EO-college/cubes-and-clouds/edit/main/lectures/3.1_data_processing/exercises/31_data_processing_pangeo.ipynb" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">3.1 Data Processing</h1></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="hpHvMRac4t" class="myst-jp-nb-block relative group/block"><img id="zzr9Enn8T0" style="margin-left:auto;margin-right:auto" src="/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg" alt="Cubes &amp; Clouds logo" data-canonical-url="https://raw.githubusercontent.com/EO-College/cubes-and-clouds/main/icons/cnc_3icons_process_circle.svg" class=""/></div><div id="gADpenfkXb" class="myst-jp-nb-block relative group/block"><h1 id="id-3-1-data-processing" class="relative group"><span class="heading-text">3.1 Data Processing</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-1-data-processing" title="Link to this Section" aria-label="Link to this Section">¶</a></h1><img id="veQ79zGFSo" style="margin-left:auto;margin-right:auto" src="/cubes-and-clouds/build/0f8adf2e4ec0feb14584840545a0ae3a.png" alt="Pangeo logo" data-canonical-url="https://raw.githubusercontent.com/pangeo-data/pangeo.io/refs/heads/main/public/Pangeo-assets/pangeo_logo.png" class=""/><h2 id="snow-cover-mapping-with-pangeo-ecosystem" class="relative group"><span class="heading-text">Snow Cover mapping with Pangeo ecosystem</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#snow-cover-mapping-with-pangeo-ecosystem" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In this exercise we will build a complete EO workflow using the Pangeo ecosystem on a cloud platform (EOxHub); from data access to obtaining the result. In this example we will analyse snow cover in the Alps.</p><p>We are going to follow these steps in our analysis:</p><ul><li><p>Load satellite collections</p></li><li><p>Specify the spatial, temporal extents and the features we are interested in</p></li><li><p>Process the satellite data to retrieve snow cover information</p></li><li><p>Aggregate information to get catchment statistics over time</p></li><li><p>Visualize and analyse the results</p></li></ul></div><div id="ZKrvXFWjLb" class="myst-jp-nb-block relative group/block"><h2 id="libraries" class="relative group"><span class="heading-text">Libraries</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#libraries" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="Ox4yzYLkWA" class="myst-jp-nb-block relative group/block"><p>We start by creating the shared folders and data files needed to complete the exercise using the following shell commands</p></div><div id="rTH6rimQXK" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">!cp -r ${DATA_PATH%/*/*}/notebooks/cubes-and-clouds/lectures/3.1_data_processing/exercises/31_results $HOME/
!cp -r ${DATA_PATH%/*/*}/notebooks/cubes-and-clouds/lectures/3.1_data_processing/exercises/31_data $HOME/</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="YUxW36743JwQYRGYTYW8r" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="NfyZ0NK1DP" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># platform libraries
# utility libraries
from datetime import date
import numpy as np
import xarray as xr
import rioxarray
import json
import pandas as pd
import matplotlib.pyplot as plt
import geopandas as gpd
from shapely.geometry import mapping
import pyproj

# STAC Catalogue Libraries
import pystac_client
import stackstac

# Data Visualization Libraries
import holoviews as hv
import hvplot.xarray
import hvplot.pandas
import folium

# Dask library
from dask.distributed import Client, progress, LocalCluster</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="9KBRmHlR6NhCRNXJmbaZr" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="etofuaPNxj" class="myst-jp-nb-block relative group/block"><h3 id="get-a-client-from-the-dask-cluster" class="relative group"><span class="heading-text">Get a client from the Dask  Cluster</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#get-a-client-from-the-dask-cluster" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Creating a Dask <code>Client</code> is mandatory in order to perform following Dask computations on your local Dask Cluster.</p></div><div id="HqqMSVmX8F" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">cluster = LocalCluster(n_workers=2)
client = Client(cluster)  # create a local dask cluster on the machine.
client</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="0za8KYRiJOEk3sQQK9ciK" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="qIE7l5B70m" class="myst-jp-nb-block relative group/block"><h2 id="region-of-interest" class="relative group"><span class="heading-text">Region of Interest</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#region-of-interest" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="oBUtMUCpOC" class="myst-jp-nb-block relative group/block"><p>We will use the catchment as our area of interest (AOI) for the analysis. Our region of interest is the Val Passiria Catchment in the South Tyrolian Alps (Italy). Let’s load the catchment area.
The catchment is defined by a polygon, which we will load from a GeoJSON file.
The GeoJSON file contains the geometry of the catchment in the WGS84 coordinate reference system (EPSG:4326) and that has to be defined.</p></div><div id="AWob8wN6Qv" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">catchment_outline = gpd.read_file(&#x27;./31_data/catchment_outline.geojson&#x27;, crs=&quot;EPGS:4326&quot;)
aoi_geojson = mapping(catchment_outline.iloc[0].geometry)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="ifDYWxnPUfAsH3U4O_zdd" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="zOTXegYHBx" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">center_loc = catchment_outline.to_crs(&#x27;+proj=cea&#x27;).centroid.to_crs(epsg=&quot;4326&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="2QzTE47VPbAM74qn9jQ2b" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Ki5TjYeigy" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># OpenStreetMap
map = folium.Map(location=[float(center_loc.y.iloc[0]), float(center_loc.x.iloc[0])], tiles=&quot;OpenStreetMap&quot;, zoom_start=9)
for _, r in catchment_outline.iterrows():
    sim_geo = gpd.GeoSeries(r[&quot;geometry&quot;]).simplify(tolerance=0.001)
    geo_j = sim_geo.to_json()
    geo_j = folium.GeoJson(data=geo_j, style_function=lambda x: {&quot;fillColor&quot;: &quot;orange&quot;})
    folium.Popup(r[&quot;HYBAS_ID&quot;]).add_to(geo_j)
    geo_j.add_to(map)
map</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="-FkmlRBQrkJN5p2oYVina" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="vH6OZx9zvh" class="myst-jp-nb-block relative group/block"><p><strong>Quiz hint: Look closely at the end of the displayed catchment area to identify the outlet</strong></p></div><div id="G0bLpWQLnB" class="myst-jp-nb-block relative group/block"><h3 id="satellite-collections" class="relative group"><span class="heading-text">Satellite collections</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#satellite-collections" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><h4 id="search-for-satellite-data-using-stac" class="relative group"><span class="heading-text">Search for satellite data using STAC</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#search-for-satellite-data-using-stac" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>We will utilize the <code>pystac_client</code> to search for satellite data in this exercise, specifically leveraging data provided by AWS/Element84. When querying the satellite data we can add various filters such as spatial range, time period, and other specific metadata. This API is constructed based on the STAC specification, a collaborative, community-driven standard aimed at enhancing the discoverability and usability of satellite data. Numerous data providers, including AWS, Google Earth Engine, and Microsoft Planetary Computer and Copernicus Data Space Ecosystem (CDSE), among others, have implemented the STAC API, exemplifying its widespread adoption and utility in accessing diverse satellite datasets.</p></div><div id="XWvBB4AHNw" class="myst-jp-nb-block relative group/block"><h5 id="set-query-filters" class="relative group"><span class="heading-text">Set query filters</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#set-query-filters" title="Link to this Section" aria-label="Link to this Section">¶</a></h5><p>We define all extents before querying satellite data. For the purposes of this exercise, we will limit the search to the Sentinel 2 L2A collection, which is a collection of Sentinel 2 data that has been processed to surface reflectance (Top Of Canopy).</p><p>We are only interested in the green and short wave infrared bands, corresponding to band 3 (B03) and 11 (B11). We directly remove time slices with a cloud cover &gt;= 90 %. We will also limit the search to the time period between 1st February 2018 and 10th June 2018 and to the extent of the catchment.</p></div><div id="E5Lf0GzGsM" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">bbox = catchment_outline.bounds.iloc[0]
bbox</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="iFBsPFmZ8ukp5ZRA1s_6e" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="zSpyRpqbnM" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#                  West,     South,     East,      North
spatial_extent = [bbox[&quot;minx&quot;], bbox[&quot;miny&quot;], bbox[&quot;maxx&quot;], bbox[&quot;maxy&quot;]]
temporal_extent = [&#x27;2018-02-01T00:00:00Z&#x27;,&#x27;2018-06-30T00:00:00Z&#x27;]

bands = [&#x27;green&#x27;, &#x27;swir16&#x27;, &#x27;scl&#x27;]
cloud_coverage = [&quot;eo:cloud_cover&lt;=90&quot;]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="qoE39YzANAtUoqlpnQcp8" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="BABjtomGPj" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">URL = &quot;https://earth-search.aws.element84.com/v1&quot;
catalog = pystac_client.Client.open(URL)
items = catalog.search(
    bbox=spatial_extent,
    datetime=temporal_extent,
    query=cloud_coverage,
    collections=[&quot;sentinel-2-l2a&quot;]
).item_collection()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="h79cKZ4aMwQjbcAYzBrRr" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="TIYrsNOjk9" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">len(items)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="MoDLUzYgFIHDB1cCi2Eac" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Dsuu7ve0qx" class="myst-jp-nb-block relative group/block"><h4 id="get-bands-information" class="relative group"><span class="heading-text">Get bands information</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#get-bands-information" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>As the original data provides bands with different names than the original Sentinel 2 bands, we need to get the information about the bands.</p></div><div id="MBJ7civQOA" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Get bands information
selected_item = items[1]
for key, asset in selected_item.assets.items():
    print(f&quot;{key}: {asset.title}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="2_pwYGnAjKCxDdaSuN6Ih" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="JcPgGbJjZZ" class="myst-jp-nb-block relative group/block"><h4 id="load-data" class="relative group"><span class="heading-text">Load data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#load-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>We will use the stackstac library to load the data. The stackstac library is a library that allows loading data from a STAC API into an xarray Dataset.
Here we will load the green and swir16 bands (on the original dataset named B03 and B11), which are the bands we will use to calculate the snow cover. We will also load the scl band, which is the scene classification layer, which we will use to mask out clouds.
Spatial resolution of 20m is selected for the analysis. The data is loaded in chunks of 2048x2048 pixels.</p><p><a target="_blank" rel="noreferrer" href="https://stackstac.readthedocs.io/en/latest/" class="link">Stackstac<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="external-link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a> is not the only way to create a xarray dataset from a STAC API. Other libraries can be used, such as <a target="_blank" rel="noreferrer" href="https://github.com/stac-utils/xpystac" class="link">xpystac<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="external-link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a> or <a target="_blank" rel="noreferrer" href="https://github.com/opendatacube/odc-stac" class="link">odc.stac<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="external-link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a>. The choice of the library depends on the use case and specific needs.</p></div><div id="eJUvg2fgo3" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">s2_cube = stackstac.stack(items,
                     bounds_latlon=spatial_extent,
                     resolution=20,
                     assets=bands
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="OFGIkyqE5kIl_Dpdeybo0" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="OwcfJvu4qS" class="myst-jp-nb-block relative group/block"><p>Extract the data CRS (Coordinate Reference System), we will need it later on</p></div><div id="l9nyb1n8li" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">s2_crs = s2_cube.rio.crs
s2_crs</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="aUCHA4yJP8k9lBlxMStXE" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="dsTE4sT3Q3" class="myst-jp-nb-block relative group/block"><h2 id="calculate-snow-cover" class="relative group"><span class="heading-text">Calculate snow cover</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#calculate-snow-cover" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We will calculate the Normalized Difference Snow Index (NDSI) to calculate the snow cover. The NDSI is calculated as the difference between the green and the swir16 bands divided by the sum of the green and the swir16 bands:</p><div id="fvhgaJdHaq" class="flex my-5 group"><div class="flex-grow overflow-x-auto overflow-y-hidden"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>N</mi><mi>D</mi><mi>S</mi><mi>I</mi><mo>=</mo><mfrac><mrow><mi>G</mi><mi>R</mi><mi>E</mi><mi>E</mi><mi>N</mi><mo>−</mo><mi>S</mi><mi>W</mi><mi>I</mi><mi>R</mi></mrow><mrow><mi>G</mi><mi>R</mi><mi>E</mi><mi>E</mi><mi>N</mi><mo>+</mo><mi>S</mi><mi>W</mi><mi>I</mi><mi>R</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">NDSI = \frac {GREEN - SWIR} {GREEN +SWIR}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1297em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">GREEN</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">GREEN</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div><div class="relative self-center flex-none pl-2 m-0 text-right select-none"><a class="no-underline text-inherit hover:text-inherit text-inherit hover:text-inherit select-none hover:underline" href="#fvhgaJdHaq" title="Link to this Equation" aria-label="Link to this Equation">(<!-- -->1<!-- -->)</a></div></div><p>For a matter of clarity we will define the green and the swir16 bands as variables. Other approaches can be used to manage the data, but this is the one we will use in this exercise.</p></div><div id="r6tX0u2MXa" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">green = s2_cube.sel(band=&#x27;green&#x27;)
swir = s2_cube.sel(band=&#x27;swir16&#x27;)
scl = s2_cube.sel(band=&#x27;scl&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="BAvIk2ihtoe32tT6eSTcm" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Ml1UJGZyqf" class="myst-jp-nb-block relative group/block"><p>Let’s compute the NDSI and mask out the clouds.</p></div><div id="a6Xxaf1O99" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">ndsi = (green - swir) / (green + swir).where((green + swir) != 0) 
ndsi</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="_qSjdLNS5oyaYVom3ZwP1" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="hIv0ArYCs7" class="myst-jp-nb-block relative group/block"><div class="alert alert-block alert-info">Dask Method Differences: `.compute()` vs `.persist()`<p>Dask provides two primary methods for executing computations: <code>.compute()</code> and <code>.persist()</code>. Below is an overview of each method and their typical use cases.</p><h4 id="id-compute" class="relative group"><span class="heading-text"><code>.compute()</code></span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-compute" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><ul><li><p><strong>Functionality</strong>: Executes the Dask computation and blocks until the result is available. It then collects and returns the final result to the local process.</p></li><li><p><strong>Use Case</strong>: Invoke <code>.compute()</code> when you need to bring the computed result into your local memory. It is typically used as the final step in a Dask workflow after all transformations and computations have been defined.</p></li><li><p><strong>Evaluation</strong>: Eager - runs immediately and provides results.</p></li></ul><h4 id="id-persist" class="relative group"><span class="heading-text"><code>.persist()</code></span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-persist" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><ul><li><p><strong>Functionality</strong>: Begins computing the result in the background while immediately returning a new Dask object that represents the ongoing computation.</p></li><li><p><strong>Use Case</strong>: Utilize <code>.persist()</code> in a distributed environment when working with large datasets or complex computations that have expensive intermediate steps. This will keep the intermediate results in the cluster’s distributed memory, improving performance for subsequent computations.</p></li><li><p><strong>Evaluation</strong>: Lazy - computations are started but the method returns a reference to the future result without waiting for the completion.</p></li></ul><p>Each method plays a crucial role in optimizing and managing the execution of large-scale computations using Dask, particularly when balancing memory usage and computational efficiency in a distributed setting.</p></div></div><div id="e1bOl3yKCL" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">ndsi = ndsi.persist()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="RuPTUsnb2mWsdP0K9lr1R" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="slHUiPi3kn" class="myst-jp-nb-block relative group/block"><h3 id="creating-the-snow-map" class="relative group"><span class="heading-text">Creating the Snow Map</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#creating-the-snow-map" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>So far we have a time series map of NDSI values. We are intereseted in the presence of snow though. Ideally in a binary classification: snow and no snow.
To achieve this we are setting a threshold of 0.4 on the NDSI. This gives us a binary snow map.</p></div><div id="QIph6QPwId" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">snow = xr.where((ndsi &gt; 0.4) &amp; ~np.isnan(ndsi), 1, ndsi)
snowmap = xr.where((snow &lt;= 0.4) &amp; ~np.isnan(snow), 0, snow)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="HJmKMNGrY7LVIImSwRdsE" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="mMnuVUf8UW" class="myst-jp-nb-block relative group/block"><h3 id="creating-a-cloud-mask" class="relative group"><span class="heading-text">Creating a cloud mask</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#creating-a-cloud-mask" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>We are going to use the Scene Classification layer of Sentinel-2 (SCL) to create a cloud mask and then applying it to the NDSI. We will mask out the clouds, which are identified by the values 8 (<em>cloud medium probability</em>), 9 (<em>cloud high probability</em>) and 3 (<em>cloud shadow</em>) in the SCL layer.</p><p>More detailed info can be found here: <a target="_blank" rel="noreferrer" href="https://sentiwiki.copernicus.eu/web/s2-processing#S2-Processing-Scene-Classification" class="link">https://<wbr/>sentiwiki<wbr/>.copernicus<wbr/>.eu<wbr/>/web<wbr/>/s2<wbr/>-processing<wbr/>#S2<wbr/>-Processing<wbr/>-Scene<wbr/>-Classification<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="external-link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a></p></div><div id="TKt377m6TO" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">cloud_mask = np.logical_not(scl.isin([8, 9, 3])) </code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="vbzyw3uLsa2PM8HMl05At" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="zco7U3pGTO" class="myst-jp-nb-block relative group/block"><h3 id="applying-the-cloud-mask-to-the-snowmap" class="relative group"><span class="heading-text">Applying the cloud mask to the snowmap</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#applying-the-cloud-mask-to-the-snowmap" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>We will mask out all pixels that are covered by clouds. This will result in: 0 = no_snow, 1 = snow, 2 = cloud</p></div><div id="LMaf0xzmPF" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">snowmap_cloudfree = xr.where(cloud_mask, snowmap, 2)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="n3_zsfMaojc7VdhnpS2wM" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="bZvH74prTC" class="myst-jp-nb-block relative group/block"><h2 id="process-snow-cover-data" class="relative group"><span class="heading-text">Process snow cover data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#process-snow-cover-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><h3 id="mask-data" class="relative group"><span class="heading-text">Mask data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#mask-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>As we are only interested to the snow cover in the catchment, we will mask out the data outside the catchment. To achieve it we need to convert the catchment geometry to the same coordinate reference system as the data. The data is in the UTM32N coordinate reference system (EPSG:32632), which is set in the <code>s2_crs</code> variable previously extracted from the datacube.</p></div><div id="tFVQSb6e82" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">aoi_utm32 = catchment_outline.to_crs(crs=s2_crs)
geom_utm32 = aoi_utm32.iloc[0][&#x27;geometry&#x27;]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="amtSk3jt0GaHIbtK-8AWi" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="vXpCDZGrbp" class="myst-jp-nb-block relative group/block"><p>As we are going to use the <code>rioXarray</code> library to mask out the data, we need to add some more information to the data. The rioXarray library is a library that allows to manipulate geospatial data in xarray datasets. Underneath it uses the rasterio library that is a library built on top of GDAL.</p><p>We need first to specify the coordinate reference system and the nodata value. Both information can be found in the metadata of the data but we need to reinforce it so that <code>rioXarray</code> can use it.</p></div><div id="CmFFbhV9rA" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">snowmap_cloudfree.rio.write_crs(s2_crs, inplace=True)
snowmap_cloudfree.rio.set_nodata(np.nan, inplace=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="kFG58ZAu2d3tQPo0yzzzh" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="DZ4GvJrsZl" class="myst-jp-nb-block relative group/block"><p>Let’s clip the snow_cloud object using the catchment geometry in the UTM32N coordinate reference system.</p></div><div id="pnjtpt5tw6" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">snowmap_clipped = snowmap_cloudfree.rio.clip([geom_utm32])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="UoP2zZqkbw-vLNr-o2QUW" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="r6o09y5So6" class="myst-jp-nb-block relative group/block"><h3 id="aggregate-data" class="relative group"><span class="heading-text">Aggregate data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#aggregate-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Data aggregation is a very important step in the analysis. It allows to reduce the amount of data and to make the analysis more efficient. Moreover, as in this case, we are going to aggregate the date to daily values, this will allow use to compute statistic on the data at the basin scale later on.</p><p>The <code>groupby</code> method allows to group the data by a specific dimension. We will group the data by the time dimension, aggregating to the date and removing the time information, once the group is obtained we will aggregate the data by taking the maximum value.</p></div><div id="QlHJKAyqDj" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">clipped_date = snowmap_clipped.groupby(snowmap_clipped.time.dt.floor(&#x27;D&#x27;)).max(skipna=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="GuZ7M9ZMxKVRHrzvEVLph" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="hlWal8snN3" class="myst-jp-nb-block relative group/block"><p>As the data has been aggregated to daily values, we need to rename the floor dimension to something more meaningful as date.</p></div><div id="Cyg3mHpN7k" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">clipped_date = clipped_date.rename({&#x27;floor&#x27;: &#x27;date&#x27;})
clipped_date</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="1Ze-nI3ZC3-EDGW-xtAGS" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="yycJcNLZmL" class="myst-jp-nb-block relative group/block"><h3 id="calculate-snow-cover-with-apply-ufunc" class="relative group"><span class="heading-text">Calculate snow cover with apply_ufunc</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#calculate-snow-cover-with-apply-ufunc" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><div class="alert alert-warning"><em></em><strong>Calculate snow cover using Xarray&#x27;s apply_ufunc</strong><br/><ul><li><p>The procedure for computing snow cover can also be summed up as following python function.</p></li><li><p>We first verify that Green, swir16 and scl are in the order of 0,1,2 the variable in band variable. Then we simply copy and past all the python codes in a function.</p></li></ul></div></div><div id="mWdZQa2IJc" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def calculate_ndsi_snow_cloud(data):
    green = data[0]
    swir = data[1]
    scl = data[2]
    ndsi = np.where((green + swir) == 0, np.nan, (green - swir) / (green + swir)) 
    ndsi_mask = ( ndsi &gt; 0.4 )&amp; ~np.isnan(ndsi)
    snow = np.where(ndsi_mask, 1, ndsi)
    snowmap = np.where((snow &lt;= 0.4) &amp; ~np.isnan(snow), 0, snow)
    mask = ~( (scl == 8) | (scl == 9) | (scl == 3) )
    snow_cloud = np.where(mask, snowmap, 2)
    return snow_cloud</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Gmtb_zU4mWc6Mlq8uuahM" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="BBoPuGEEEr" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%time
da = stackstac.stack(items,
                    bounds_latlon=catchment_outline.iloc[0].geometry.bounds,
                    resolution=20,
                    assets=bands)

#Mask data
geom_utm32 = catchment_outline.to_crs(s2_crs).iloc[0][&#x27;geometry&#x27;]
da.rio.write_crs(s2_crs, inplace=True)
da.rio.set_nodata(np.nan, inplace=True)
da = da.rio.clip([geom_utm32])

snow_cloud_clipped = xr.apply_ufunc(
    calculate_ndsi_snow_cloud
    ,da
    ,input_core_dims=[[&quot;band&quot;,&quot;y&quot;,&quot;x&quot;]]
    ,output_core_dims=[[&quot;y&quot;,&quot;x&quot;]]
    ,exclude_dims=set([&quot;band&quot;])
    ,vectorize=True
    ,output_dtypes=[da.dtype],
    dask=&quot;parallelized&quot;,
    dask_gufunc_kwargs={&quot;allow_rechunk&quot;:True}
    ).assign_attrs({&#x27;long_name&#x27;: &#x27;snow_cloud&#x27;}).to_dataset(name=&#x27;snow_cloud&#x27;)

clipped_date = snow_cloud_clipped.groupby(snow_cloud_clipped.time.dt.floor(&#x27;D&#x27;)).max(skipna=True)
clipped_date = clipped_date.rename({&#x27;floor&#x27;: &#x27;date&#x27;})

clipped_date</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="opYFXj878Ek8hPBPxp7o0" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="hWNYQnYlAb" class="myst-jp-nb-block relative group/block"><div class="alert alert-warning"><em></em><strong>Inspect the data dimentions!</strong><br/><ul><li><p>How did change from input (da) to output (snow_cloud_clipped)?</p></li><li><p>What is set as input_core_dims?</p></li><li><p>What is set as output_core_dims?</p></li><li><p>What is set as exclude_dims?</p></li><li><p>Did you see &#x27;time&#x27; dimension?</p></li></ul></div></div><div id="nj982iQEkB" class="myst-jp-nb-block relative group/block"><h3 id="visualize-data" class="relative group"><span class="heading-text">Visualize data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#visualize-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>We will use the <code>hvplot</code> library to visualize the data. The library allows to visualize data in <code>xarray</code> datasets. It is based on the holoviews library, which is a library that allows to visualize multidimensional data.
To visualize the data on a map, we need to specify the coordinate reference system of the data. The data is in the UTM32N coordinate reference system (EPSG:32632). This will allow the library to project the data on a map.
More info on the hvplot library can be found here: <a target="_blank" rel="noreferrer" href="https://hvplot.holoviz.org/" class="link">https://<wbr/>hvplot<wbr/>.holoviz<wbr/>.org/<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="external-link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a></p><p><strong>Please note: running the next cell might take a couple of minutes. When interacting with the date scrollbar, the map takes some time to be updated, be patient.</strong></p></div><div id="GmB5uwfPLJ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">clipped_date.hvplot.image(
    x=&#x27;x&#x27;,
    y=&#x27;y&#x27;,
    groupby=&#x27;date&#x27;,
    crs=str(s2_crs),
    cmap=&#x27;Pastel2&#x27;,
    clim=(-1, 2),
    frame_width=500,
    frame_height=500,
    title=&#x27;Snowmap&#x27;,
    geo=True, tiles=&#x27;OSM&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Lm8LmrjCNJK-j8brIpC5p" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="pR3qCXmhWN" class="myst-jp-nb-block relative group/block"><h2 id="calculate-catchment-statistics" class="relative group"><span class="heading-text">Calculate Catchment Statistics</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#calculate-catchment-statistics" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Our objective is to monitor a specific area over a period of time, ensuring the data quality meets our standards. To achieve this, we determine the proportion of clouds in the watershed at each interval. This cloud coverage data serves to refine our timeline: we exclude any interval where cloud cover exceeds 25%.</p><p>Our primary focus is on quantifying the <strong>Snow Covered Area (SCA)</strong> in the watershed. We tally the number of pixels depicting snow for each interval and calculate the SCA by multiplying the snowy pixels by the pixel’s area. To determine the extent of snow coverage, we calculate the percentage of snow-covered area by comparing the number of snowy pixels to the total pixel count within the watershed. This percentage is a key metric in our analysis.</p><p>We need to gather the total pixel counts for the entire watershed, as well as those specific to cloud and snow coverages.</p></div><div id="BUw1akEcOm" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># number of cloud pixels
cloud = xr.where(clipped_date == 2, 1, np.nan).count(dim=[&#x27;x&#x27;, &#x27;y&#x27;]).persist()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="JHkUi8Y30fneCz7Krs9me" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Q1inb1fH14" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># number of all pixels per each single date
aot_total = clipped_date.count(dim=[&#x27;x&#x27;, &#x27;y&#x27;]).persist()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="X4Toa9tVsU2a40HAhwiQt" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="SEOFpaEhLJ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Cloud fraction per each single date expressed in % 
cloud_fraction = (cloud / aot_total * 100).persist()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="ivujeJOmLgg2308c4FojQ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="MEKvHRze25" class="myst-jp-nb-block relative group/block"><p><strong>Running the next cell may require up to a couple of minutes.</strong></p></div><div id="vOseHLyMXK" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Visualize cloud fraction
cloud_fraction.hvplot.line(title=&#x27;Cloud cover %&#x27;, ylabel=&quot;&amp;&quot;) * hv.HLine(25).opts(
    color=&#x27;red&#x27;,
    line_dash=&#x27;dashed&#x27;,
    line_width=2.0,
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="uWQQxE1vipggBEoV4MxeW" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="aEnObwKcAm" class="myst-jp-nb-block relative group/block"><p>Compute the total number of cloudy pixels in the selected temporal period:</p></div><div id="BdL2eXD4Qk" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">cloud.snow_cloud.sum(dim=&quot;date&quot;).values</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="P-pS_3Nlb-zwK2ndZbIp_" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="sLyJbiulNZ" class="myst-jp-nb-block relative group/block"><p>We are going to get the same information for the snow cover.</p></div><div id="HOuRFsNPob" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">snow = xr.where(clipped_date == 1, 1, np.nan).count(dim=[&#x27;x&#x27;, &#x27;y&#x27;])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="HCPGKWer2K1AelQbJiUWz" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="mkkzm62Tlp" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">snow_fraction = (snow / aot_total * 100).persist()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="niejakxlhHctIHh1F1UJA" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="EsWigkbuY3" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># visualize snow fraction
snow_fraction.hvplot.line(title=&#x27;Snow cover area (%)&#x27;, ylabel=&quot;%&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Zo5lNw59-8cgrZuhSvZ02" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="U6QjBUaol9" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># mask out cloud fraction &gt; 25% 
masked_cloud_fraction = cloud_fraction.snow_cloud &lt; 25</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="v7PTJhFwqlwfw_iqBIKdT" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="jpMjvKYWIL" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">snow_selected = snow_fraction.sel(date=masked_cloud_fraction)
snow_selected</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="OAVyLbr2BgSqDrGg00axy" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="izjdnGEZXF" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">snow_selected = snow_selected.rename({&quot;snow_cloud&quot;:&quot;SCA&quot;})
snow_selected.hvplot.line(title=&quot;Snow fraction&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="njjBMmUnb8RIA9eeFfzPw" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="MquEslm8Kb" class="myst-jp-nb-block relative group/block"><p>Save the <strong>cloud filtered snow fraction</strong></p></div><div id="eYJWvnNFOJ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">snow_selected.to_dataframe().to_csv(&quot;31_results/filtered_snow_fraction_pangeo.csv&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="rXID04pG_KUNV8bSjIyfo" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="SHhmctHakl" class="myst-jp-nb-block relative group/block"><h2 id="shutdown-and-close-local-dask-cluster" class="relative group"><span class="heading-text">Shutdown and Close local Dask cluster</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#shutdown-and-close-local-dask-cluster" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="ttjFs1b3ue" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">client.shutdown()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="2JfcPPF2EiVzpDUN0Tgb1" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Ab67CBrjtx" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">client.close()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="E7PVzPaNzuP0NbMZfu043" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div class="myst-backmatter-parts"></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/cubes-and-clouds/build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-7UUHRSK3.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/root-EDJFWIEV.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/_shared/chunk-ECLX7DIY.js"/><link rel="modulepreload" href="/cubes-and-clouds/build/routes/$-AD65NCUT.js"/><script>window.__remixContext = {"url":"/lectures/data-processing/exercises/data-processing-pangeo","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.8.0","options":{"hide_toc":true,"hide_footer_links":true,"folders":true},"nav":[],"actions":[],"projects":[{"subject":"Cubes and Clouds learning materials","title":"Cubes and Clouds Notebooks","description":"Collection of Cubes and Clouds learning notebooks","github":"https://github.com/EO-college/cubes-and-clouds","id":"7095e86f-a94c-4858-b97b-80694fdbcdf1","thumbnail":"/cubes-and-clouds/build/4e7b95cc5159f11ae65e2049a64650a6.svg","exports":[],"bibliography":[],"index":"readme","pages":[{"slug":"contributing","title":"How to contribute","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"contributors","title":"Contributors","description":"","date":"","thumbnail":"/cubes-and-clouds/build/bee0df1dcfe29799901d54c333adae56.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"title":"Lectures","level":1},{"slug":"lectures.readme","title":"Lectures","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"Introduction","level":2},{"slug":"lectures.introduction.introduction","title":"Introduction","description":"","date":"","thumbnail":"/cubes-and-clouds/build/864d3fc75ed1a08ac2d4c8f21d9d6a63.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.introduction.exercises.login","title":"0. Introduction","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"1","level":2},{"slug":"lectures.intro-platform.intro-platform","title":"Earth Observation cloud platforms","description":"","date":"","thumbnail":"/cubes-and-clouds/build/b334c40d1c998a2fb3e79e903892672d.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"1","level":2},{"slug":"lectures.data-cube.data-cube","title":"What is a data cube?","description":"","date":"","thumbnail":"/cubes-and-clouds/build/04b2802f47f308fa6a646bc15a8fe881.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"1","level":2},{"slug":"lectures.openscience.openscienceandfair","title":"Open Science and the FAIR Principles","description":"","date":"","thumbnail":"/cubes-and-clouds/build/3c3f883a861697088c44018dfa0c01af.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"lectures.openscience.opendataopensource","title":"Open Data and Open Source Software","description":"","date":"","thumbnail":"/cubes-and-clouds/build/bff8617b237519f0cffd390773f82d2d.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"lectures.openscience.openscienceineo","title":"The Open Science Journey - Open Science in geospatial, EO and EO cloud platforms","description":"","date":"","thumbnail":"/cubes-and-clouds/build/d4d5badaaff454a73f72620f2ac36c2e.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"2","level":2},{"slug":"lectures.data-discovery.data-discovery","title":"Data Discovery","description":"","date":"","thumbnail":"/cubes-and-clouds/build/3f9ff18207bbea501aede31c88cde0e5.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"2","level":2},{"slug":"lectures.data-properties.data-properties","title":"Data Properties","description":"","date":"","thumbnail":"/cubes-and-clouds/build/stac_standartization-f3e84ce6c76a5d4e85f58b4818a4b7a8.jpg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-properties.exercises.data-properties","title":"2.2 Data Discovery \u0026 Properties","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"2","level":2},{"slug":"lectures.data-access.data-access","title":"Access EO Data from the Cloud","description":"","date":"","thumbnail":"/cubes-and-clouds/build/dc_filter-e119daea278b9b63b9d7af5db14c345e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"title":"Openeo","level":4},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-aggregate","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-apply","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-filter","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-lazy-loading","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-reduce","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-resample","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"Pangeo","level":4},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-aggregate","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-apply","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-filter","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-lazy-loading","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-reduce","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-resample","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"2","level":2},{"slug":"lectures.formats-and-performance.formats-and-performance","title":"Data Formats and Performance","description":"","date":"","thumbnail":"/cubes-and-clouds/build/96fdc48bce5685dcda930053ff412281.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.formats-and-performance.exercises.chunking","title":"2.4 Data chunking with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.formats-and-performance.exercises.dask","title":"2.4 Scaling with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.formats-and-performance.exercises.energy-consumption","title":"2.4 Formats and Performance","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"3","level":2},{"slug":"lectures.data-processing.data-processing","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/fe97d8f264069b8e4340c6b6ddcdf54e.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-processing.exercises.data-processing-openeo","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.data-processing.exercises.data-processing-pangeo","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"Alternatives","level":4},{"slug":"lectures.data-processing.exercises.alternatives.data-processing-openeo-platform","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-processing.exercises.alternatives.data-processing-stac","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"3","level":2},{"slug":"lectures.validation.validation","title":"Validation","description":"","date":"","thumbnail":"/cubes-and-clouds/build/distribution_map-bd933d46300c684cf574a30cbb88883b.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.validation.exercises.validation-openeo","title":"3.2 Validation of the results with openEO","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.validation.exercises.validation-pangeo","title":"3.2 Validation of the results with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"3","level":2},{"slug":"lectures.data-sharing.data-sharing","title":"3.3 Data Sharing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/4066423c8fb88d808f30ad74224294b4.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-sharing.exercises.data-sharing-openeo","title":"3.3 Data Sharing with openEO","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.data-sharing.exercises.data-sharing-pangeo","title":"3.3 Data Sharing with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"9","level":2},{"slug":"lectures.master-asi-conae.s2-sca","title":"Sentinel-2 snow cover area (SCA) time series","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Test","level":3},{"slug":"lectures.master-asi-conae.test.s1","title":"S1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s2-sca-sh","title":"S2 Sca Sh","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s2-snowcover-test","title":"Sentinel-2 snow cover","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s3-ndsi","title":"List all the available dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.test-s1-s3","title":"Sentinel-1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/cubes-and-clouds"},"routes/$":{"config":{"version":3,"myst":"1.8.0","options":{"hide_toc":true,"hide_footer_links":true,"folders":true},"nav":[],"actions":[],"projects":[{"subject":"Cubes and Clouds learning materials","title":"Cubes and Clouds Notebooks","description":"Collection of Cubes and Clouds learning notebooks","github":"https://github.com/EO-college/cubes-and-clouds","id":"7095e86f-a94c-4858-b97b-80694fdbcdf1","thumbnail":"/cubes-and-clouds/build/4e7b95cc5159f11ae65e2049a64650a6.svg","exports":[],"bibliography":[],"index":"readme","pages":[{"slug":"contributing","title":"How to contribute","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"contributors","title":"Contributors","description":"","date":"","thumbnail":"/cubes-and-clouds/build/bee0df1dcfe29799901d54c333adae56.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"title":"Lectures","level":1},{"slug":"lectures.readme","title":"Lectures","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"Introduction","level":2},{"slug":"lectures.introduction.introduction","title":"Introduction","description":"","date":"","thumbnail":"/cubes-and-clouds/build/864d3fc75ed1a08ac2d4c8f21d9d6a63.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.introduction.exercises.login","title":"0. Introduction","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"1","level":2},{"slug":"lectures.intro-platform.intro-platform","title":"Earth Observation cloud platforms","description":"","date":"","thumbnail":"/cubes-and-clouds/build/b334c40d1c998a2fb3e79e903892672d.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"1","level":2},{"slug":"lectures.data-cube.data-cube","title":"What is a data cube?","description":"","date":"","thumbnail":"/cubes-and-clouds/build/04b2802f47f308fa6a646bc15a8fe881.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"1","level":2},{"slug":"lectures.openscience.openscienceandfair","title":"Open Science and the FAIR Principles","description":"","date":"","thumbnail":"/cubes-and-clouds/build/3c3f883a861697088c44018dfa0c01af.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"lectures.openscience.opendataopensource","title":"Open Data and Open Source Software","description":"","date":"","thumbnail":"/cubes-and-clouds/build/bff8617b237519f0cffd390773f82d2d.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"lectures.openscience.openscienceineo","title":"The Open Science Journey - Open Science in geospatial, EO and EO cloud platforms","description":"","date":"","thumbnail":"/cubes-and-clouds/build/d4d5badaaff454a73f72620f2ac36c2e.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"2","level":2},{"slug":"lectures.data-discovery.data-discovery","title":"Data Discovery","description":"","date":"","thumbnail":"/cubes-and-clouds/build/3f9ff18207bbea501aede31c88cde0e5.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"2","level":2},{"slug":"lectures.data-properties.data-properties","title":"Data Properties","description":"","date":"","thumbnail":"/cubes-and-clouds/build/stac_standartization-f3e84ce6c76a5d4e85f58b4818a4b7a8.jpg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-properties.exercises.data-properties","title":"2.2 Data Discovery \u0026 Properties","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"2","level":2},{"slug":"lectures.data-access.data-access","title":"Access EO Data from the Cloud","description":"","date":"","thumbnail":"/cubes-and-clouds/build/dc_filter-e119daea278b9b63b9d7af5db14c345e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"title":"Openeo","level":4},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-aggregate","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-apply","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-filter","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-lazy-loading","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-reduce","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-resample","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"Pangeo","level":4},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-aggregate","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-apply","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-filter","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-lazy-loading","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-reduce","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-resample","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"2","level":2},{"slug":"lectures.formats-and-performance.formats-and-performance","title":"Data Formats and Performance","description":"","date":"","thumbnail":"/cubes-and-clouds/build/96fdc48bce5685dcda930053ff412281.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.formats-and-performance.exercises.chunking","title":"2.4 Data chunking with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.formats-and-performance.exercises.dask","title":"2.4 Scaling with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.formats-and-performance.exercises.energy-consumption","title":"2.4 Formats and Performance","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"3","level":2},{"slug":"lectures.data-processing.data-processing","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/fe97d8f264069b8e4340c6b6ddcdf54e.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-processing.exercises.data-processing-openeo","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.data-processing.exercises.data-processing-pangeo","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"Alternatives","level":4},{"slug":"lectures.data-processing.exercises.alternatives.data-processing-openeo-platform","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-processing.exercises.alternatives.data-processing-stac","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"3","level":2},{"slug":"lectures.validation.validation","title":"Validation","description":"","date":"","thumbnail":"/cubes-and-clouds/build/distribution_map-bd933d46300c684cf574a30cbb88883b.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.validation.exercises.validation-openeo","title":"3.2 Validation of the results with openEO","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.validation.exercises.validation-pangeo","title":"3.2 Validation of the results with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"3","level":2},{"slug":"lectures.data-sharing.data-sharing","title":"3.3 Data Sharing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/4066423c8fb88d808f30ad74224294b4.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-sharing.exercises.data-sharing-openeo","title":"3.3 Data Sharing with openEO","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.data-sharing.exercises.data-sharing-pangeo","title":"3.3 Data Sharing with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"9","level":2},{"slug":"lectures.master-asi-conae.s2-sca","title":"Sentinel-2 snow cover area (SCA) time series","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Test","level":3},{"slug":"lectures.master-asi-conae.test.s1","title":"S1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s2-sca-sh","title":"S2 Sca Sh","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s2-snowcover-test","title":"Sentinel-2 snow cover","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s3-ndsi","title":"List all the available dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.test-s1-s3","title":"Sentinel-1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4}]}]},"page":{"version":3,"kind":"Notebook","sha256":"8f225b7c362df201969f6873877f94b6d6c64e9a87f498c21adefd09e8ce35f6","slug":"lectures.data-processing.exercises.data-processing-pangeo","location":"/lectures/3.1_data_processing/exercises/31_data_processing_pangeo.ipynb","dependencies":[],"frontmatter":{"title":"3.1 Data Processing","content_includes_title":true,"kernelspec":{"name":"conda-env-cubes-and-clouds-pangeo-py","display_name":"cubes-and-clouds-pangeo","language":"python"},"github":"https://github.com/EO-college/cubes-and-clouds","subject":"Cubes and Clouds learning materials","numbering":{"title":{"offset":3}},"source_url":"https://github.com/EO-college/cubes-and-clouds/blob/main/lectures/3.1_data_processing/exercises/31_data_processing_pangeo.ipynb","edit_url":"https://github.com/EO-college/cubes-and-clouds/edit/main/lectures/3.1_data_processing/exercises/31_data_processing_pangeo.ipynb","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","exports":[{"format":"ipynb","filename":"31_data_processing_pangeo.ipynb","url":"/cubes-and-clouds/build/31_data_processing_p-739258dd421d08d6e054ce499a534841.ipynb"}]},"widgets":{"application/vnd.jupyter.widget-state+json":{"state":{"1e85ce72ba894ef683e1cc95b248db05":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{}},"82d131f02e124db0a68c4988a87f3ae2":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"VBoxModel","state":{"layout":"IPY_MODEL_1e85ce72ba894ef683e1cc95b248db05"}}},"version_major":2,"version_minor":0}},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","children":[{"type":"image","style":{"float":"center","marginRight":"10px","marginLeft":"10px","maxHeight":"250px"},"url":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","alt":"Cubes \u0026 Clouds logo","key":"zzr9Enn8T0","urlSource":"https://raw.githubusercontent.com/EO-College/cubes-and-clouds/main/icons/cnc_3icons_process_circle.svg"}],"key":"u4SDU1Xdqn"}],"key":"hpHvMRac4t"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.1 Data Processing","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E7XN0Jagub"}],"identifier":"id-3-1-data-processing","label":"3.1 Data Processing","html_id":"id-3-1-data-processing","implicit":true,"key":"wOpbbrAWpE"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"image","style":{"float":"center","marginRight":"10px","maxHeight":"80px"},"url":"/cubes-and-clouds/build/0f8adf2e4ec0feb14584840545a0ae3a.png","alt":"Pangeo logo","key":"veQ79zGFSo","urlSource":"https://raw.githubusercontent.com/pangeo-data/pangeo.io/refs/heads/main/public/Pangeo-assets/pangeo_logo.png"}],"key":"UsPhP2ObUS"},{"type":"heading","depth":2,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Snow Cover mapping with Pangeo ecosystem","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"IzE1IGyMuR"}],"identifier":"snow-cover-mapping-with-pangeo-ecosystem","label":"Snow Cover mapping with Pangeo ecosystem","html_id":"snow-cover-mapping-with-pangeo-ecosystem","implicit":true,"key":"T9rbZQsJ3l"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"In this exercise we will build a complete EO workflow using the Pangeo ecosystem on a cloud platform (EOxHub); from data access to obtaining the result. In this example we will analyse snow cover in the Alps.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"D8tInCYACQ"}],"key":"P8aOm8ezAS"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"We are going to follow these steps in our analysis:","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"E9nXXomPJs"}],"key":"LTNkTCtJbU"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":13,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Load satellite collections","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"jdauS2a9jj"}],"key":"Dd8O7F8TAK"}],"key":"SI2XejKqJN"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Specify the spatial, temporal extents and the features we are interested in","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"o60ZU3tHkg"}],"key":"gjrdd5uwrZ"}],"key":"VodY486Jl1"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Process the satellite data to retrieve snow cover information","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"pG7osx1pcw"}],"key":"wE4Ee8QKoF"}],"key":"FpHNkCert5"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Aggregate information to get catchment statistics over time","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"rj5naxoehm"}],"key":"rqAzQWI9gO"}],"key":"KTZIHO1T7d"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Visualize and analyse the results","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"kr1xML88VK"}],"key":"KmbnJ6HpTu"}],"key":"sQnBSaQTiJ"}],"key":"wMMBq71DCO"}],"key":"gADpenfkXb"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Libraries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"a0Y8N308dt"}],"identifier":"libraries","label":"Libraries","html_id":"libraries","implicit":true,"key":"IlFhFgu6a4"}],"key":"ZKrvXFWjLb"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We start by creating the shared folders and data files needed to complete the exercise using the following shell commands","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aLY53x7nPe"}],"key":"MdXmnnzKMX"}],"key":"Ox4yzYLkWA"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"!cp -r ${DATA_PATH%/*/*}/notebooks/cubes-and-clouds/lectures/3.1_data_processing/exercises/31_results $HOME/\n!cp -r ${DATA_PATH%/*/*}/notebooks/cubes-and-clouds/lectures/3.1_data_processing/exercises/31_data $HOME/","visibility":"show","key":"tmIj0ScgP0"},{"type":"outputs","id":"YUxW36743JwQYRGYTYW8r","children":[],"visibility":"show","key":"eGfY6hPMpd"}],"visibility":"show","key":"rTH6rimQXK"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# platform libraries\n# utility libraries\nfrom datetime import date\nimport numpy as np\nimport xarray as xr\nimport rioxarray\nimport json\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport geopandas as gpd\nfrom shapely.geometry import mapping\nimport pyproj\n\n# STAC Catalogue Libraries\nimport pystac_client\nimport stackstac\n\n# Data Visualization Libraries\nimport holoviews as hv\nimport hvplot.xarray\nimport hvplot.pandas\nimport folium\n\n# Dask library\nfrom dask.distributed import Client, progress, LocalCluster","visibility":"show","key":"i7wFQbZ5jy"},{"type":"outputs","id":"9KBRmHlR6NhCRNXJmbaZr","children":[],"visibility":"show","key":"k1agPx9pcz"}],"visibility":"show","key":"NfyZ0NK1DP"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Get a client from the Dask  Cluster","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Y6qpX1q8CN"}],"identifier":"get-a-client-from-the-dask-cluster","label":"Get a client from the Dask  Cluster","html_id":"get-a-client-from-the-dask-cluster","implicit":true,"key":"hBdY3UPXlQ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Creating a Dask ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LFrFW4H8ZP"},{"type":"inlineCode","value":"Client","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rmWFpShsch"},{"type":"text","value":" is mandatory in order to perform following Dask computations on your local Dask Cluster.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"T4DYDGhu16"}],"key":"IrbMsgEMOu"}],"key":"etofuaPNxj"},{"type":"block","kind":"notebook-code","data":{"scrolled":true,"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cluster = LocalCluster(n_workers=2)\nclient = Client(cluster)  # create a local dask cluster on the machine.\nclient","visibility":"show","key":"lOXGM917KJ"},{"type":"outputs","id":"0za8KYRiJOEk3sQQK9ciK","children":[],"visibility":"show","key":"AyI1cJ5d46"}],"visibility":"show","key":"HqqMSVmX8F"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Region of Interest","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KtNtgm4o3M"}],"identifier":"region-of-interest","label":"Region of Interest","html_id":"region-of-interest","implicit":true,"key":"Jc88RxNfNa"}],"key":"qIE7l5B70m"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We will use the catchment as our area of interest (AOI) for the analysis. Our region of interest is the Val Passiria Catchment in the South Tyrolian Alps (Italy). Let’s load the catchment area.\nThe catchment is defined by a polygon, which we will load from a GeoJSON file.\nThe GeoJSON file contains the geometry of the catchment in the WGS84 coordinate reference system (EPSG:4326) and that has to be defined.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qUG08bkywj"}],"key":"bRq5mApCJB"}],"key":"oBUtMUCpOC"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"catchment_outline = gpd.read_file('./31_data/catchment_outline.geojson', crs=\"EPGS:4326\")\naoi_geojson = mapping(catchment_outline.iloc[0].geometry)","visibility":"show","key":"bsRG8Cioju"},{"type":"outputs","id":"ifDYWxnPUfAsH3U4O_zdd","children":[],"visibility":"show","key":"r5msjp7wqQ"}],"visibility":"show","key":"AWob8wN6Qv"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"center_loc = catchment_outline.to_crs('+proj=cea').centroid.to_crs(epsg=\"4326\")","visibility":"show","key":"Z7F6oTNw6A"},{"type":"outputs","id":"2QzTE47VPbAM74qn9jQ2b","children":[],"visibility":"show","key":"Pq9ZQotHGD"}],"visibility":"show","key":"zOTXegYHBx"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# OpenStreetMap\nmap = folium.Map(location=[float(center_loc.y.iloc[0]), float(center_loc.x.iloc[0])], tiles=\"OpenStreetMap\", zoom_start=9)\nfor _, r in catchment_outline.iterrows():\n    sim_geo = gpd.GeoSeries(r[\"geometry\"]).simplify(tolerance=0.001)\n    geo_j = sim_geo.to_json()\n    geo_j = folium.GeoJson(data=geo_j, style_function=lambda x: {\"fillColor\": \"orange\"})\n    folium.Popup(r[\"HYBAS_ID\"]).add_to(geo_j)\n    geo_j.add_to(map)\nmap","visibility":"show","key":"pTkNKE3stl"},{"type":"outputs","id":"-FkmlRBQrkJN5p2oYVina","children":[],"visibility":"show","key":"m6nr955ecL"}],"visibility":"show","key":"Ki5TjYeigy"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Quiz hint: Look closely at the end of the displayed catchment area to identify the outlet","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fO9KbVm5ep"}],"key":"bDBvzUskqE"}],"key":"MIEAHbW2eL"}],"key":"vH6OZx9zvh"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Satellite collections","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"B095Zkro95"}],"identifier":"satellite-collections","label":"Satellite collections","html_id":"satellite-collections","implicit":true,"key":"SXbKL4X9fs"},{"type":"heading","depth":4,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Search for satellite data using STAC","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EFmwBJjT8L"}],"identifier":"search-for-satellite-data-using-stac","label":"Search for satellite data using STAC","html_id":"search-for-satellite-data-using-stac","implicit":true,"key":"ZExoBlGSbC"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We will utilize the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fcRRwlB2xH"},{"type":"inlineCode","value":"pystac_client","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"dQQ2bjFoRT"},{"type":"text","value":" to search for satellite data in this exercise, specifically leveraging data provided by AWS/Element84. When querying the satellite data we can add various filters such as spatial range, time period, and other specific metadata. This API is constructed based on the STAC specification, a collaborative, community-driven standard aimed at enhancing the discoverability and usability of satellite data. Numerous data providers, including AWS, Google Earth Engine, and Microsoft Planetary Computer and Copernicus Data Space Ecosystem (CDSE), among others, have implemented the STAC API, exemplifying its widespread adoption and utility in accessing diverse satellite datasets.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"eVseeXzMUw"}],"key":"bYSKdJr6bB"}],"key":"G0bLpWQLnB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":5,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Set query filters","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CCN3fDCWut"}],"identifier":"set-query-filters","label":"Set query filters","html_id":"set-query-filters","implicit":true,"key":"sNh7i9DFAe"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We define all extents before querying satellite data. For the purposes of this exercise, we will limit the search to the Sentinel 2 L2A collection, which is a collection of Sentinel 2 data that has been processed to surface reflectance (Top Of Canopy).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"swolZghbOy"}],"key":"hHhNlapbLn"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We are only interested in the green and short wave infrared bands, corresponding to band 3 (B03) and 11 (B11). We directly remove time slices with a cloud cover \u003e= 90 %. We will also limit the search to the time period between 1st February 2018 and 10th June 2018 and to the extent of the catchment.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jKgeIqfoJG"}],"key":"azwXBMt3U2"}],"key":"XWvBB4AHNw"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"bbox = catchment_outline.bounds.iloc[0]\nbbox","visibility":"show","key":"L5b9YhfgDM"},{"type":"outputs","id":"iFBsPFmZ8ukp5ZRA1s_6e","children":[],"visibility":"show","key":"QAs5r99z8w"}],"visibility":"show","key":"E5Lf0GzGsM"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#                  West,     South,     East,      North\nspatial_extent = [bbox[\"minx\"], bbox[\"miny\"], bbox[\"maxx\"], bbox[\"maxy\"]]\ntemporal_extent = ['2018-02-01T00:00:00Z','2018-06-30T00:00:00Z']\n\nbands = ['green', 'swir16', 'scl']\ncloud_coverage = [\"eo:cloud_cover\u003c=90\"]","visibility":"show","key":"YtP8MVaFPZ"},{"type":"outputs","id":"qoE39YzANAtUoqlpnQcp8","children":[],"visibility":"show","key":"AeGDEMZpJ9"}],"visibility":"show","key":"zSpyRpqbnM"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"URL = \"https://earth-search.aws.element84.com/v1\"\ncatalog = pystac_client.Client.open(URL)\nitems = catalog.search(\n    bbox=spatial_extent,\n    datetime=temporal_extent,\n    query=cloud_coverage,\n    collections=[\"sentinel-2-l2a\"]\n).item_collection()","visibility":"show","key":"cwXrL3GBuj"},{"type":"outputs","id":"h79cKZ4aMwQjbcAYzBrRr","children":[],"visibility":"show","key":"bU2rsI9xq4"}],"visibility":"show","key":"BABjtomGPj"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"len(items)","visibility":"show","key":"c6mX7Zjve5"},{"type":"outputs","id":"MoDLUzYgFIHDB1cCi2Eac","children":[],"visibility":"show","key":"Q0OLw3YkA5"}],"visibility":"show","key":"TIYrsNOjk9"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Get bands information","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dVQfFHd0mi"}],"identifier":"get-bands-information","label":"Get bands information","html_id":"get-bands-information","implicit":true,"key":"RP7IZZ8lJK"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"As the original data provides bands with different names than the original Sentinel 2 bands, we need to get the information about the bands.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"FzrwhcSzwL"}],"key":"rXLjmOM409"}],"key":"Dsuu7ve0qx"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Get bands information\nselected_item = items[1]\nfor key, asset in selected_item.assets.items():\n    print(f\"{key}: {asset.title}\")","visibility":"show","key":"Z651F4dil0"},{"type":"outputs","id":"2_pwYGnAjKCxDdaSuN6Ih","children":[],"visibility":"show","key":"cVuJpKu9DR"}],"visibility":"show","key":"MBJ7civQOA"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RUTjggOiJ0"}],"identifier":"load-data","label":"Load data","html_id":"load-data","implicit":true,"key":"wCZHgDzWgx"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We will use the stackstac library to load the data. The stackstac library is a library that allows loading data from a STAC API into an xarray Dataset.\nHere we will load the green and swir16 bands (on the original dataset named B03 and B11), which are the bands we will use to calculate the snow cover. We will also load the scl band, which is the scene classification layer, which we will use to mask out clouds.\nSpatial resolution of 20m is selected for the analysis. The data is loaded in chunks of 2048x2048 pixels.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Kuj5zU5MzE"}],"key":"vRbBz9FiLO"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"link","url":"https://stackstac.readthedocs.io/en/latest/","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Stackstac","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"p4GuqKk0Re"}],"urlSource":"https://stackstac.readthedocs.io/en/latest/","key":"sMVtuw5KVo"},{"type":"text","value":" is not the only way to create a xarray dataset from a STAC API. Other libraries can be used, such as ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"pzfnsMtWB7"},{"type":"link","url":"https://github.com/stac-utils/xpystac","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"xpystac","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"MPJy84CW9A"}],"urlSource":"https://github.com/stac-utils/xpystac","error":true,"key":"N5AfMXluAr"},{"type":"text","value":" or ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"DeLFqa4GoY"},{"type":"link","url":"https://github.com/opendatacube/odc-stac","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"odc.stac","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"nYyj7UJI1x"}],"urlSource":"https://github.com/opendatacube/odc-stac","error":true,"key":"mWVeVAVshe"},{"type":"text","value":". The choice of the library depends on the use case and specific needs.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"nF78RQ1Q0e"}],"key":"FDuQBjoljm"}],"key":"JcPgGbJjZZ"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"s2_cube = stackstac.stack(items,\n                     bounds_latlon=spatial_extent,\n                     resolution=20,\n                     assets=bands\n)","visibility":"show","key":"dhYO5His1s"},{"type":"outputs","id":"OFGIkyqE5kIl_Dpdeybo0","children":[],"visibility":"show","key":"i77Fkk53Ms"}],"visibility":"show","key":"eJUvg2fgo3"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Extract the data CRS (Coordinate Reference System), we will need it later on","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"x8tTxhYGJb"}],"key":"El15p3FmOz"}],"key":"OwcfJvu4qS"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"s2_crs = s2_cube.rio.crs\ns2_crs","visibility":"show","key":"Pw7UUjxS4M"},{"type":"outputs","id":"aUCHA4yJP8k9lBlxMStXE","children":[],"visibility":"show","key":"qilDJ0Ekge"}],"visibility":"show","key":"l9nyb1n8li"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Calculate snow cover","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wDYm2KhHgZ"}],"identifier":"calculate-snow-cover","label":"Calculate snow cover","html_id":"calculate-snow-cover","implicit":true,"key":"oKq5hZ7BT5"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We will calculate the Normalized Difference Snow Index (NDSI) to calculate the snow cover. The NDSI is calculated as the difference between the green and the swir16 bands divided by the sum of the green and the swir16 bands:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"n9hXMeAQ0m"}],"key":"yfFCe3KSVp"},{"type":"math","value":"NDSI = \\frac {GREEN - SWIR} {GREEN +SWIR}","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eN\u003c/mi\u003e\u003cmi\u003eD\u003c/mi\u003e\u003cmi\u003eS\u003c/mi\u003e\u003cmi\u003eI\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmfrac\u003e\u003cmrow\u003e\u003cmi\u003eG\u003c/mi\u003e\u003cmi\u003eR\u003c/mi\u003e\u003cmi\u003eE\u003c/mi\u003e\u003cmi\u003eE\u003c/mi\u003e\u003cmi\u003eN\u003c/mi\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmi\u003eS\u003c/mi\u003e\u003cmi\u003eW\u003c/mi\u003e\u003cmi\u003eI\u003c/mi\u003e\u003cmi\u003eR\u003c/mi\u003e\u003c/mrow\u003e\u003cmrow\u003e\u003cmi\u003eG\u003c/mi\u003e\u003cmi\u003eR\u003c/mi\u003e\u003cmi\u003eE\u003c/mi\u003e\u003cmi\u003eE\u003c/mi\u003e\u003cmi\u003eN\u003c/mi\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmi\u003eS\u003c/mi\u003e\u003cmi\u003eW\u003c/mi\u003e\u003cmi\u003eI\u003c/mi\u003e\u003cmi\u003eR\u003c/mi\u003e\u003c/mrow\u003e\u003c/mfrac\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eNDSI = \\frac {GREEN - SWIR} {GREEN +SWIR}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10903em;\"\u003eN\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003eD\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05764em;\"\u003eS\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07847em;\"\u003eI\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:2.1297em;vertical-align:-0.7693em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mopen nulldelimiter\"\u003e\u003c/span\u003e\u003cspan class=\"mfrac\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.3603em;\"\u003e\u003cspan style=\"top:-2.314em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10903em;\"\u003eGREEN\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05764em;\"\u003eS\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.13889em;\"\u003eW\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07847em;\"\u003eI\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.00773em;\"\u003eR\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.23em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"frac-line\" style=\"border-bottom-width:0.04em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.677em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10903em;\"\u003eGREEN\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05764em;\"\u003eS\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.13889em;\"\u003eW\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07847em;\"\u003eI\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.00773em;\"\u003eR\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.7693em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose nulldelimiter\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","enumerator":"1","key":"fvhgaJdHaq"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"For a matter of clarity we will define the green and the swir16 bands as variables. Other approaches can be used to manage the data, but this is the one we will use in this exercise.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"x9L0YgmMAA"}],"key":"eSMjd1Jkqa"}],"key":"dsTE4sT3Q3"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"green = s2_cube.sel(band='green')\nswir = s2_cube.sel(band='swir16')\nscl = s2_cube.sel(band='scl')","visibility":"show","key":"vYpAym1cal"},{"type":"outputs","id":"BAvIk2ihtoe32tT6eSTcm","children":[],"visibility":"show","key":"svm4KxQByW"}],"visibility":"show","key":"r6tX0u2MXa"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s compute the NDSI and mask out the clouds.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zOnpWo6vpj"}],"key":"sqgTjH6aFb"}],"key":"Ml1UJGZyqf"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ndsi = (green - swir) / (green + swir).where((green + swir) != 0) \nndsi","visibility":"show","key":"Je1BeP161w"},{"type":"outputs","id":"_qSjdLNS5oyaYVom3ZwP1","children":[],"visibility":"show","key":"J20AiEF3sO"}],"visibility":"show","key":"a6Xxaf1O99"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"alert alert-block alert-info","children":[{"type":"text","value":"Dask Method Differences: `.compute()` vs `.persist()`","key":"OrjVs5IczU"},{"type":"paragraph","children":[{"type":"text","value":"Dask provides two primary methods for executing computations: ","key":"S3pZhKP0Eh"},{"type":"inlineCode","value":".compute()","key":"Q2XibpVb48"},{"type":"text","value":" and ","key":"hSI9qE4K2y"},{"type":"inlineCode","value":".persist()","key":"SdhWF03L9m"},{"type":"text","value":". Below is an overview of each method and their typical use cases.","key":"NHtYUwKRfc"}],"key":"lCSsFAyqKK"},{"type":"heading","depth":4,"children":[{"type":"inlineCode","value":".compute()","key":"MGKkP1vXtN"}],"identifier":"id-compute","label":".compute()","html_id":"id-compute","implicit":true,"key":"eMt7ne79E7"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Functionality","key":"H0zktsVJW9"}],"key":"HrMXzwiHE8"},{"type":"text","value":": Executes the Dask computation and blocks until the result is available. It then collects and returns the final result to the local process.","key":"agjJHoKzsf"}],"key":"HNlvvrND67"}],"key":"qt5FukZuLT"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Use Case","key":"FmNoGCQ8z2"}],"key":"vbkY7kQ9et"},{"type":"text","value":": Invoke ","key":"Mry86yDNYt"},{"type":"inlineCode","value":".compute()","key":"RwKMEQPPw2"},{"type":"text","value":" when you need to bring the computed result into your local memory. It is typically used as the final step in a Dask workflow after all transformations and computations have been defined.","key":"r5Ej5yFxLc"}],"key":"bUF8YiNohy"}],"key":"DpQUnkbmMU"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Evaluation","key":"xZPJX1t0Ek"}],"key":"xxemJAapim"},{"type":"text","value":": Eager - runs immediately and provides results.","key":"ym61B4MC2R"}],"key":"MSbCg8JoWq"}],"key":"Ql8hnV5g7c"}],"key":"ArOF6ZuadT"},{"type":"heading","depth":4,"children":[{"type":"inlineCode","value":".persist()","key":"kxKfzJ1Ikm"}],"identifier":"id-persist","label":".persist()","html_id":"id-persist","implicit":true,"key":"OjHguILSLT"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Functionality","key":"m2mYjfPkeO"}],"key":"NMBqSRbfLi"},{"type":"text","value":": Begins computing the result in the background while immediately returning a new Dask object that represents the ongoing computation.","key":"fmIgDBySfc"}],"key":"e1Znkxntuf"}],"key":"Nh6Hq6aC3x"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Use Case","key":"RfMtwSeEru"}],"key":"waOfBOILbI"},{"type":"text","value":": Utilize ","key":"o4FVlllkfm"},{"type":"inlineCode","value":".persist()","key":"nURf4tutPv"},{"type":"text","value":" in a distributed environment when working with large datasets or complex computations that have expensive intermediate steps. This will keep the intermediate results in the cluster’s distributed memory, improving performance for subsequent computations.","key":"fK9Owk4UdE"}],"key":"g7l08TlGlo"}],"key":"gcCQCmj8v3"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Evaluation","key":"ihHqUvOOEo"}],"key":"SUFMKLCXdf"},{"type":"text","value":": Lazy - computations are started but the method returns a reference to the future result without waiting for the completion.","key":"Q2ZhEViYYf"}],"key":"XXIbRdKI8q"}],"key":"tDFlAUDUZ7"}],"key":"Kf04byxuB3"},{"type":"paragraph","children":[{"type":"text","value":"Each method plays a crucial role in optimizing and managing the execution of large-scale computations using Dask, particularly when balancing memory usage and computational efficiency in a distributed setting.","key":"iB2Kocvb9n"}],"key":"KR7ZHtdpXh"}],"key":"g7nlGXTv1n"}],"key":"hIv0ArYCs7"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ndsi = ndsi.persist()","visibility":"show","key":"D2ThZZ4mr7"},{"type":"outputs","id":"RuPTUsnb2mWsdP0K9lr1R","children":[],"visibility":"show","key":"UlQbIGd9rH"}],"visibility":"show","key":"e1bOl3yKCL"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Creating the Snow Map","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NS81HeOzwC"}],"identifier":"creating-the-snow-map","label":"Creating the Snow Map","html_id":"creating-the-snow-map","implicit":true,"key":"CbHal8a7og"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"So far we have a time series map of NDSI values. We are intereseted in the presence of snow though. Ideally in a binary classification: snow and no snow.\nTo achieve this we are setting a threshold of 0.4 on the NDSI. This gives us a binary snow map.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"kF4KH5KbST"}],"key":"Es25fT1Til"}],"key":"slHUiPi3kn"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"snow = xr.where((ndsi \u003e 0.4) \u0026 ~np.isnan(ndsi), 1, ndsi)\nsnowmap = xr.where((snow \u003c= 0.4) \u0026 ~np.isnan(snow), 0, snow)","visibility":"show","key":"BMxKG6P7Sm"},{"type":"outputs","id":"HJmKMNGrY7LVIImSwRdsE","children":[],"visibility":"show","key":"kk5wpl3TvM"}],"visibility":"show","key":"QIph6QPwId"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Creating a cloud mask","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qbIzqRQqEJ"}],"identifier":"creating-a-cloud-mask","label":"Creating a cloud mask","html_id":"creating-a-cloud-mask","implicit":true,"key":"kaWlySqGb4"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We are going to use the Scene Classification layer of Sentinel-2 (SCL) to create a cloud mask and then applying it to the NDSI. We will mask out the clouds, which are identified by the values 8 (","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"UywQ8CkOgM"},{"type":"emphasis","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"cloud medium probability","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"tNAFjgYEyc"}],"key":"O451Seo79u"},{"type":"text","value":"), 9 (","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"DYpWCAmfk8"},{"type":"emphasis","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"cloud high probability","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Hq0ctVIveo"}],"key":"Eid3KcSzKh"},{"type":"text","value":") and 3 (","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ODCDRtlOUl"},{"type":"emphasis","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"cloud shadow","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"uoC7Ho87x0"}],"key":"RGJ7hDxL3d"},{"type":"text","value":") in the SCL layer.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"prWHiNcvQH"}],"key":"M8jM8jBwrs"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"More detailed info can be found here: ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Fuge2GhJXz"},{"type":"link","url":"https://sentiwiki.copernicus.eu/web/s2-processing#S2-Processing-Scene-Classification","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"https://​sentiwiki​.copernicus​.eu​/web​/s2​-processing​#S2​-Processing​-Scene​-Classification","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ER4aP7nDrA"}],"urlSource":"https://sentiwiki.copernicus.eu/web/s2-processing#S2-Processing-Scene-Classification","key":"VsSgEQLhgE"}],"key":"v7eeTaKZRN"}],"key":"mMnuVUf8UW"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cloud_mask = np.logical_not(scl.isin([8, 9, 3])) ","visibility":"show","key":"m1wMGywxKg"},{"type":"outputs","id":"vbzyw3uLsa2PM8HMl05At","children":[],"visibility":"show","key":"W3ROvQK8Mr"}],"visibility":"show","key":"TKt377m6TO"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Applying the cloud mask to the snowmap","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PcfXm9K1xl"}],"identifier":"applying-the-cloud-mask-to-the-snowmap","label":"Applying the cloud mask to the snowmap","html_id":"applying-the-cloud-mask-to-the-snowmap","implicit":true,"key":"po2Nmjdm3l"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We will mask out all pixels that are covered by clouds. This will result in: 0 = no_snow, 1 = snow, 2 = cloud","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"JqOt2fXZ9j"}],"key":"S25YBOccFV"}],"key":"zco7U3pGTO"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"snowmap_cloudfree = xr.where(cloud_mask, snowmap, 2)","visibility":"show","key":"xjuChVEewD"},{"type":"outputs","id":"n3_zsfMaojc7VdhnpS2wM","children":[],"visibility":"show","key":"BMqhomyLjv"}],"visibility":"show","key":"LMaf0xzmPF"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Process snow cover data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YXrJ1NHZgq"}],"identifier":"process-snow-cover-data","label":"Process snow cover data","html_id":"process-snow-cover-data","implicit":true,"key":"IYQ9ISiqsu"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Mask data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SWbta2rrmp"}],"identifier":"mask-data","label":"Mask data","html_id":"mask-data","implicit":true,"key":"QlgWzUSRpk"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"As we are only interested to the snow cover in the catchment, we will mask out the data outside the catchment. To achieve it we need to convert the catchment geometry to the same coordinate reference system as the data. The data is in the UTM32N coordinate reference system (EPSG:32632), which is set in the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fh94o6N5cy"},{"type":"inlineCode","value":"s2_crs","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CFT1a6ijAw"},{"type":"text","value":" variable previously extracted from the datacube.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ejRi7Kdc9n"}],"key":"jB2jMIfjxU"}],"key":"bZvH74prTC"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"aoi_utm32 = catchment_outline.to_crs(crs=s2_crs)\ngeom_utm32 = aoi_utm32.iloc[0]['geometry']","visibility":"show","key":"BKhYMumwwb"},{"type":"outputs","id":"amtSk3jt0GaHIbtK-8AWi","children":[],"visibility":"show","key":"KCiBFnWCFf"}],"visibility":"show","key":"tFVQSb6e82"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"As we are going to use the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vGq9AZAWBW"},{"type":"inlineCode","value":"rioXarray","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Q0tO80TBYc"},{"type":"text","value":" library to mask out the data, we need to add some more information to the data. The rioXarray library is a library that allows to manipulate geospatial data in xarray datasets. Underneath it uses the rasterio library that is a library built on top of GDAL.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AvqcnwSBQa"}],"key":"ZLLVi39bMm"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We need first to specify the coordinate reference system and the nodata value. Both information can be found in the metadata of the data but we need to reinforce it so that ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CvWkoOyu22"},{"type":"inlineCode","value":"rioXarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dhHH0mOZAG"},{"type":"text","value":" can use it.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GU6lEr2o7f"}],"key":"Lkjrw34bRd"}],"key":"vXpCDZGrbp"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"snowmap_cloudfree.rio.write_crs(s2_crs, inplace=True)\nsnowmap_cloudfree.rio.set_nodata(np.nan, inplace=True)","visibility":"show","key":"Gng1Pqi2RB"},{"type":"outputs","id":"kFG58ZAu2d3tQPo0yzzzh","children":[],"visibility":"show","key":"S7rMymx4t8"}],"visibility":"show","key":"CmFFbhV9rA"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s clip the snow_cloud object using the catchment geometry in the UTM32N coordinate reference system.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"B6ouoYA8hu"}],"key":"xzqWIqIlC7"}],"key":"DZ4GvJrsZl"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"snowmap_clipped = snowmap_cloudfree.rio.clip([geom_utm32])","visibility":"show","key":"c3yY3VcB3X"},{"type":"outputs","id":"UoP2zZqkbw-vLNr-o2QUW","children":[],"visibility":"show","key":"JsGETfYtEL"}],"visibility":"show","key":"pnjtpt5tw6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Aggregate data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ngundic3PP"}],"identifier":"aggregate-data","label":"Aggregate data","html_id":"aggregate-data","implicit":true,"key":"ChjOUCgZNn"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Data aggregation is a very important step in the analysis. It allows to reduce the amount of data and to make the analysis more efficient. Moreover, as in this case, we are going to aggregate the date to daily values, this will allow use to compute statistic on the data at the basin scale later on.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MGX42uRXjU"}],"key":"qCIVGhRAgg"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"kPOGDNPRZY"},{"type":"inlineCode","value":"groupby","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"z46lQMZzPM"},{"type":"text","value":" method allows to group the data by a specific dimension. We will group the data by the time dimension, aggregating to the date and removing the time information, once the group is obtained we will aggregate the data by taking the maximum value.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TiuVaNKU50"}],"key":"veox7n6NOd"}],"key":"r6o09y5So6"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"clipped_date = snowmap_clipped.groupby(snowmap_clipped.time.dt.floor('D')).max(skipna=True)","visibility":"show","key":"dk4nNO2IF5"},{"type":"outputs","id":"GuZ7M9ZMxKVRHrzvEVLph","children":[],"visibility":"show","key":"VY6ElxWU0r"}],"visibility":"show","key":"QlHJKAyqDj"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"As the data has been aggregated to daily values, we need to rename the floor dimension to something more meaningful as date.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eJThw9I6ZT"}],"key":"CMGxfbcNtF"}],"key":"hlWal8snN3"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"clipped_date = clipped_date.rename({'floor': 'date'})\nclipped_date","visibility":"show","key":"X0nf7GrJAB"},{"type":"outputs","id":"1Ze-nI3ZC3-EDGW-xtAGS","children":[],"visibility":"show","key":"b9rE6YNbWL"}],"visibility":"show","key":"Cyg3mHpN7k"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Calculate snow cover with apply_ufunc","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QYvr3z9gt4"}],"identifier":"calculate-snow-cover-with-apply-ufunc","label":"Calculate snow cover with apply_ufunc","html_id":"calculate-snow-cover-with-apply-ufunc","implicit":true,"key":"QOMb6LR4z5"},{"type":"div","class":"alert alert-warning","children":[{"type":"emphasis","children":[],"key":"fbnUEd8wN4"},{"type":"strong","children":[{"type":"text","value":"Calculate snow cover using Xarray's apply_ufunc","key":"rAfWXpkdhX"}],"key":"u0q3I2sESz"},{"type":"break","key":"t0o1JBuMGE"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The procedure for computing snow cover can also be summed up as following python function.","key":"WzQ9FmGu6X"}],"key":"hmAtUA7ATL"}],"key":"pnivJXRFsF"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"We first verify that Green, swir16 and scl are in the order of 0,1,2 the variable in band variable. Then we simply copy and past all the python codes in a function.","key":"X4jkGFS1MG"}],"key":"fQEcEbjor5"}],"key":"UDILIfrdgR"}],"key":"xgkSyY8grR"}],"key":"I4kyg0bR7d"}],"key":"yycJcNLZmL"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"def calculate_ndsi_snow_cloud(data):\n    green = data[0]\n    swir = data[1]\n    scl = data[2]\n    ndsi = np.where((green + swir) == 0, np.nan, (green - swir) / (green + swir)) \n    ndsi_mask = ( ndsi \u003e 0.4 )\u0026 ~np.isnan(ndsi)\n    snow = np.where(ndsi_mask, 1, ndsi)\n    snowmap = np.where((snow \u003c= 0.4) \u0026 ~np.isnan(snow), 0, snow)\n    mask = ~( (scl == 8) | (scl == 9) | (scl == 3) )\n    snow_cloud = np.where(mask, snowmap, 2)\n    return snow_cloud","visibility":"show","key":"iQawDUiF75"},{"type":"outputs","id":"Gmtb_zU4mWc6Mlq8uuahM","children":[],"visibility":"show","key":"wzWrfwoPJL"}],"visibility":"show","key":"mWdZQa2IJc"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"%%time\nda = stackstac.stack(items,\n                    bounds_latlon=catchment_outline.iloc[0].geometry.bounds,\n                    resolution=20,\n                    assets=bands)\n\n#Mask data\ngeom_utm32 = catchment_outline.to_crs(s2_crs).iloc[0]['geometry']\nda.rio.write_crs(s2_crs, inplace=True)\nda.rio.set_nodata(np.nan, inplace=True)\nda = da.rio.clip([geom_utm32])\n\nsnow_cloud_clipped = xr.apply_ufunc(\n    calculate_ndsi_snow_cloud\n    ,da\n    ,input_core_dims=[[\"band\",\"y\",\"x\"]]\n    ,output_core_dims=[[\"y\",\"x\"]]\n    ,exclude_dims=set([\"band\"])\n    ,vectorize=True\n    ,output_dtypes=[da.dtype],\n    dask=\"parallelized\",\n    dask_gufunc_kwargs={\"allow_rechunk\":True}\n    ).assign_attrs({'long_name': 'snow_cloud'}).to_dataset(name='snow_cloud')\n\nclipped_date = snow_cloud_clipped.groupby(snow_cloud_clipped.time.dt.floor('D')).max(skipna=True)\nclipped_date = clipped_date.rename({'floor': 'date'})\n\nclipped_date","visibility":"show","key":"XvQ94fHI37"},{"type":"outputs","id":"opYFXj878Ek8hPBPxp7o0","children":[],"visibility":"show","key":"cGML8nDryy"}],"visibility":"show","key":"BBoPuGEEEr"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"alert alert-warning","children":[{"type":"emphasis","children":[],"key":"wvZTVS4ftA"},{"type":"strong","children":[{"type":"text","value":"Inspect the data dimentions!","key":"RPhoF0YZL2"}],"key":"uq3jkCT1Y7"},{"type":"break","key":"I95GoL05Q9"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"How did change from input (da) to output (snow_cloud_clipped)?","key":"fSGLN1AJtI"}],"key":"IdjEvyE7qh"}],"key":"AMWIGjyfKg"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"What is set as input_core_dims?","key":"yrXliwrCDZ"}],"key":"cIXXbqAiBl"}],"key":"YM69V4s7bu"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"What is set as output_core_dims?","key":"HvJ7FClsYN"}],"key":"EqJ1fH0pbw"}],"key":"U1bpS18WkM"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"What is set as exclude_dims?","key":"MVe489o6m6"}],"key":"FJgYuEMFBL"}],"key":"ZC9ohz8G8G"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Did you see 'time' dimension?","key":"leaPkSNE8l"}],"key":"oHiPd2ihDJ"}],"key":"e8ZMG1zKvp"}],"key":"aH0OjAtodq"}],"key":"YPl592xRKy"}],"key":"hWNYQnYlAb"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aXc2MAuWON"}],"identifier":"visualize-data","label":"Visualize data","html_id":"visualize-data","implicit":true,"key":"sneQGIGnoL"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We will use the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"SZjLYuTbmJ"},{"type":"inlineCode","value":"hvplot","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"JSUybAAOaj"},{"type":"text","value":" library to visualize the data. The library allows to visualize data in ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"fDAv17iuEv"},{"type":"inlineCode","value":"xarray","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"reax4aJwBR"},{"type":"text","value":" datasets. It is based on the holoviews library, which is a library that allows to visualize multidimensional data.\nTo visualize the data on a map, we need to specify the coordinate reference system of the data. The data is in the UTM32N coordinate reference system (EPSG:32632). This will allow the library to project the data on a map.\nMore info on the hvplot library can be found here: ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ax4UbT3Eyn"},{"type":"link","url":"https://hvplot.holoviz.org/","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"https://​hvplot​.holoviz​.org/","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"VgBrhqdaMV"}],"urlSource":"https://hvplot.holoviz.org/","key":"CjJmBSZfy8"}],"key":"Ux52qzlrVM"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Please note: running the next cell might take a couple of minutes. When interacting with the date scrollbar, the map takes some time to be updated, be patient.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"bJefcbFIXA"}],"key":"Mrh3GajVVF"}],"key":"M964x3Yuvc"}],"key":"nj982iQEkB"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"clipped_date.hvplot.image(\n    x='x',\n    y='y',\n    groupby='date',\n    crs=str(s2_crs),\n    cmap='Pastel2',\n    clim=(-1, 2),\n    frame_width=500,\n    frame_height=500,\n    title='Snowmap',\n    geo=True, tiles='OSM')","visibility":"show","key":"LxPuMErxIL"},{"type":"outputs","id":"Lm8LmrjCNJK-j8brIpC5p","children":[],"visibility":"show","key":"ThpXWenfnK"}],"visibility":"show","key":"GmB5uwfPLJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Calculate Catchment Statistics","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oGy7s9Dvqx"}],"identifier":"calculate-catchment-statistics","label":"Calculate Catchment Statistics","html_id":"calculate-catchment-statistics","implicit":true,"key":"Vjp4nvTTO6"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Our objective is to monitor a specific area over a period of time, ensuring the data quality meets our standards. To achieve this, we determine the proportion of clouds in the watershed at each interval. This cloud coverage data serves to refine our timeline: we exclude any interval where cloud cover exceeds 25%.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hfS9BHHDIG"}],"key":"vBlfUlSIBW"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Our primary focus is on quantifying the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"W7D2vTb5Ls"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Snow Covered Area (SCA)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"pL87frqwQ5"}],"key":"UmfUhb3iXQ"},{"type":"text","value":" in the watershed. We tally the number of pixels depicting snow for each interval and calculate the SCA by multiplying the snowy pixels by the pixel’s area. To determine the extent of snow coverage, we calculate the percentage of snow-covered area by comparing the number of snowy pixels to the total pixel count within the watershed. This percentage is a key metric in our analysis.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"htrVB2rKM3"}],"key":"vjdLZbwA73"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"We need to gather the total pixel counts for the entire watershed, as well as those specific to cloud and snow coverages.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"iEDfaGeCVI"}],"key":"wM2Hn9YoDg"}],"key":"pR3qCXmhWN"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# number of cloud pixels\ncloud = xr.where(clipped_date == 2, 1, np.nan).count(dim=['x', 'y']).persist()","visibility":"show","key":"otEIyxuoY2"},{"type":"outputs","id":"JHkUi8Y30fneCz7Krs9me","children":[],"visibility":"show","key":"IQllTcUiWz"}],"visibility":"show","key":"BUw1akEcOm"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# number of all pixels per each single date\naot_total = clipped_date.count(dim=['x', 'y']).persist()","visibility":"show","key":"b3HZqkmact"},{"type":"outputs","id":"X4Toa9tVsU2a40HAhwiQt","children":[],"visibility":"show","key":"izeglTLjSJ"}],"visibility":"show","key":"Q1inb1fH14"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Cloud fraction per each single date expressed in % \ncloud_fraction = (cloud / aot_total * 100).persist()","visibility":"show","key":"suSVFTCOOY"},{"type":"outputs","id":"ivujeJOmLgg2308c4FojQ","children":[],"visibility":"show","key":"FZ1bSJqtPV"}],"visibility":"show","key":"SEOFpaEhLJ"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Running the next cell may require up to a couple of minutes.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nYcLnIL8nW"}],"key":"ZuLp3YjGZi"}],"key":"zwRagpHrH2"}],"visibility":"show","key":"MEKvHRze25"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Visualize cloud fraction\ncloud_fraction.hvplot.line(title='Cloud cover %', ylabel=\"\u0026\") * hv.HLine(25).opts(\n    color='red',\n    line_dash='dashed',\n    line_width=2.0,\n)","visibility":"show","key":"waa6fCX2HD"},{"type":"outputs","id":"uWQQxE1vipggBEoV4MxeW","children":[],"visibility":"show","key":"wE1e7xATRT"}],"visibility":"show","key":"vOseHLyMXK"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Compute the total number of cloudy pixels in the selected temporal period:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NY9eBzzhjg"}],"key":"xv9msKeqdc"}],"key":"aEnObwKcAm"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cloud.snow_cloud.sum(dim=\"date\").values","visibility":"show","key":"DjLK26isTl"},{"type":"outputs","id":"P-pS_3Nlb-zwK2ndZbIp_","children":[],"visibility":"show","key":"nkBTqQGthQ"}],"visibility":"show","key":"BdL2eXD4Qk"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We are going to get the same information for the snow cover.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PFjOynjzPu"}],"key":"STxx20FWSU"}],"key":"sLyJbiulNZ"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"snow = xr.where(clipped_date == 1, 1, np.nan).count(dim=['x', 'y'])","visibility":"show","key":"tG0j00dFQK"},{"type":"outputs","id":"HCPGKWer2K1AelQbJiUWz","children":[],"visibility":"show","key":"ueFmFHp0B6"}],"visibility":"show","key":"HOuRFsNPob"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"snow_fraction = (snow / aot_total * 100).persist()","visibility":"show","key":"xNCaiK1wPb"},{"type":"outputs","id":"niejakxlhHctIHh1F1UJA","children":[],"visibility":"show","key":"JVPaNbauRr"}],"visibility":"show","key":"mkkzm62Tlp"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# visualize snow fraction\nsnow_fraction.hvplot.line(title='Snow cover area (%)', ylabel=\"%\")","visibility":"show","key":"nCzpbiAl2h"},{"type":"outputs","id":"Zo5lNw59-8cgrZuhSvZ02","children":[],"visibility":"show","key":"M1aSQuJssJ"}],"visibility":"show","key":"EsWigkbuY3"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# mask out cloud fraction \u003e 25% \nmasked_cloud_fraction = cloud_fraction.snow_cloud \u003c 25","visibility":"show","key":"y8m6W9RVMt"},{"type":"outputs","id":"v7PTJhFwqlwfw_iqBIKdT","children":[],"visibility":"show","key":"sOgCxZ8TrZ"}],"visibility":"show","key":"U6QjBUaol9"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"snow_selected = snow_fraction.sel(date=masked_cloud_fraction)\nsnow_selected","visibility":"show","key":"obkerQdqOq"},{"type":"outputs","id":"OAVyLbr2BgSqDrGg00axy","children":[],"visibility":"show","key":"os1DISNKap"}],"visibility":"show","key":"jpMjvKYWIL"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"snow_selected = snow_selected.rename({\"snow_cloud\":\"SCA\"})\nsnow_selected.hvplot.line(title=\"Snow fraction\")","visibility":"show","key":"uRo0EAh1xr"},{"type":"outputs","id":"njjBMmUnb8RIA9eeFfzPw","children":[],"visibility":"show","key":"x1E7lh7vMf"}],"visibility":"show","key":"izjdnGEZXF"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Save the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uBVBKlgzZ9"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"cloud filtered snow fraction","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aJYZ2e23WU"}],"key":"mErygHREGc"}],"key":"X18NfOC4fA"}],"key":"MquEslm8Kb"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"snow_selected.to_dataframe().to_csv(\"31_results/filtered_snow_fraction_pangeo.csv\")","visibility":"show","key":"r91sg9rtnM"},{"type":"outputs","id":"rXID04pG_KUNV8bSjIyfo","children":[],"visibility":"show","key":"ZlkTTmffun"}],"visibility":"show","key":"eYJWvnNFOJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Shutdown and Close local Dask cluster","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HdDi96AJTj"}],"identifier":"shutdown-and-close-local-dask-cluster","label":"Shutdown and Close local Dask cluster","html_id":"shutdown-and-close-local-dask-cluster","implicit":true,"key":"SGtfHaBjsN"}],"key":"SHhmctHakl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"client.shutdown()","key":"I3sS3Sx41r"},{"type":"outputs","id":"2JfcPPF2EiVzpDUN0Tgb1","children":[],"key":"Aysf3YMms8"}],"key":"ttjFs1b3ue"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"client.close()","key":"bAfRND4eli"},{"type":"outputs","id":"E7PVzPaNzuP0NbMZfu043","children":[],"key":"YhZNXCj4Mt"}],"key":"Ab67CBrjtx"}],"key":"H28Z1gLheV"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"3.1 Data Processing","url":"/lectures/data-processing/exercises/data-processing-openeo","group":"Exercises"},"next":{"title":"3.1 Data Processing","url":"/lectures/data-processing/exercises/alternatives/data-processing-openeo-platform","group":"Alternatives"}}},"domain":"http://localhost:3000"},"project":{"subject":"Cubes and Clouds learning materials","title":"Cubes and Clouds Notebooks","description":"Collection of Cubes and Clouds learning notebooks","github":"https://github.com/EO-college/cubes-and-clouds","id":"7095e86f-a94c-4858-b97b-80694fdbcdf1","thumbnail":"/cubes-and-clouds/build/4e7b95cc5159f11ae65e2049a64650a6.svg","exports":[],"bibliography":[],"index":"readme","pages":[{"slug":"contributing","title":"How to contribute","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"contributors","title":"Contributors","description":"","date":"","thumbnail":"/cubes-and-clouds/build/bee0df1dcfe29799901d54c333adae56.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"title":"Lectures","level":1},{"slug":"lectures.readme","title":"Lectures","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"Introduction","level":2},{"slug":"lectures.introduction.introduction","title":"Introduction","description":"","date":"","thumbnail":"/cubes-and-clouds/build/864d3fc75ed1a08ac2d4c8f21d9d6a63.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.introduction.exercises.login","title":"0. Introduction","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"1","level":2},{"slug":"lectures.intro-platform.intro-platform","title":"Earth Observation cloud platforms","description":"","date":"","thumbnail":"/cubes-and-clouds/build/b334c40d1c998a2fb3e79e903892672d.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"1","level":2},{"slug":"lectures.data-cube.data-cube","title":"What is a data cube?","description":"","date":"","thumbnail":"/cubes-and-clouds/build/04b2802f47f308fa6a646bc15a8fe881.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"1","level":2},{"slug":"lectures.openscience.openscienceandfair","title":"Open Science and the FAIR Principles","description":"","date":"","thumbnail":"/cubes-and-clouds/build/3c3f883a861697088c44018dfa0c01af.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"lectures.openscience.opendataopensource","title":"Open Data and Open Source Software","description":"","date":"","thumbnail":"/cubes-and-clouds/build/bff8617b237519f0cffd390773f82d2d.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"lectures.openscience.openscienceineo","title":"The Open Science Journey - Open Science in geospatial, EO and EO cloud platforms","description":"","date":"","thumbnail":"/cubes-and-clouds/build/d4d5badaaff454a73f72620f2ac36c2e.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"2","level":2},{"slug":"lectures.data-discovery.data-discovery","title":"Data Discovery","description":"","date":"","thumbnail":"/cubes-and-clouds/build/3f9ff18207bbea501aede31c88cde0e5.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"2","level":2},{"slug":"lectures.data-properties.data-properties","title":"Data Properties","description":"","date":"","thumbnail":"/cubes-and-clouds/build/stac_standartization-f3e84ce6c76a5d4e85f58b4818a4b7a8.jpg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-properties.exercises.data-properties","title":"2.2 Data Discovery \u0026 Properties","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"2","level":2},{"slug":"lectures.data-access.data-access","title":"Access EO Data from the Cloud","description":"","date":"","thumbnail":"/cubes-and-clouds/build/dc_filter-e119daea278b9b63b9d7af5db14c345e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"title":"Openeo","level":4},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-aggregate","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-apply","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-filter","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-lazy-loading","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-reduce","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.openeo.openeo-data-access-resample","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"Pangeo","level":4},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-aggregate","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-apply","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-filter","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-lazy-loading","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-reduce","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-access.exercises.pangeo.pangeo-data-access-resample","title":"2.3 Data Access and Basic Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"2","level":2},{"slug":"lectures.formats-and-performance.formats-and-performance","title":"Data Formats and Performance","description":"","date":"","thumbnail":"/cubes-and-clouds/build/96fdc48bce5685dcda930053ff412281.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.formats-and-performance.exercises.chunking","title":"2.4 Data chunking with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.formats-and-performance.exercises.dask","title":"2.4 Scaling with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.formats-and-performance.exercises.energy-consumption","title":"2.4 Formats and Performance","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"3","level":2},{"slug":"lectures.data-processing.data-processing","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/fe97d8f264069b8e4340c6b6ddcdf54e.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-processing.exercises.data-processing-openeo","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.data-processing.exercises.data-processing-pangeo","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"Alternatives","level":4},{"slug":"lectures.data-processing.exercises.alternatives.data-processing-openeo-platform","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"slug":"lectures.data-processing.exercises.alternatives.data-processing-stac","title":"3.1 Data Processing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"3","level":2},{"slug":"lectures.validation.validation","title":"Validation","description":"","date":"","thumbnail":"/cubes-and-clouds/build/distribution_map-bd933d46300c684cf574a30cbb88883b.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.validation.exercises.validation-openeo","title":"3.2 Validation of the results with openEO","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.validation.exercises.validation-pangeo","title":"3.2 Validation of the results with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"3","level":2},{"slug":"lectures.data-sharing.data-sharing","title":"3.3 Data Sharing","description":"","date":"","thumbnail":"/cubes-and-clouds/build/4066423c8fb88d808f30ad74224294b4.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Exercises","level":3},{"slug":"lectures.data-sharing.exercises.data-sharing-openeo","title":"3.3 Data Sharing with openEO","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.data-sharing.exercises.data-sharing-pangeo","title":"3.3 Data Sharing with Pangeo","description":"","date":"","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"9","level":2},{"slug":"lectures.master-asi-conae.s2-sca","title":"Sentinel-2 snow cover area (SCA) time series","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Test","level":3},{"slug":"lectures.master-asi-conae.test.s1","title":"S1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s2-sca-sh","title":"S2 Sca Sh","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s2-snowcover-test","title":"Sentinel-2 snow cover","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.s3-ndsi","title":"List all the available dataset","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"slug":"lectures.master-asi-conae.test.test-s1-s3","title":"Sentinel-1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/cubes-and-clouds/build/manifest-7B0967AD.js";
import * as route0 from "/cubes-and-clouds/build/root-EDJFWIEV.js";
import * as route1 from "/cubes-and-clouds/build/routes/$-AD65NCUT.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/cubes-and-clouds/build/entry.client-PCJPW7TK.js");</script></body></html>