{"version":3,"kind":"Notebook","sha256":"2cc15f1a169d86b2db64910d3d8b873140068015b7b41d12e7c5f5f3ce1d9056","slug":"lectures.data-properties.exercises.data-properties","location":"/lectures/2.2_data_properties/exercises/22_data_properties.ipynb","dependencies":[],"frontmatter":{"title":"2.2 Data Discovery & Properties","content_includes_title":true,"kernelspec":{"name":"conda-env-cubes-and-clouds-cubes-and-clouds-pangeo-py","display_name":"cubes-and-clouds-cubes-and-clouds-pangeo","language":"python"},"github":"https://github.com/EO-college/cubes-and-clouds","subject":"Cubes and Clouds learning materials","numbering":{"title":{"offset":2}},"source_url":"https://github.com/EO-college/cubes-and-clouds/blob/main/lectures/2.2_data_properties/exercises/22_data_properties.ipynb","edit_url":"https://github.com/EO-college/cubes-and-clouds/edit/main/lectures/2.2_data_properties/exercises/22_data_properties.ipynb","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","exports":[{"format":"ipynb","filename":"22_data_properties.ipynb","url":"/cubes-and-clouds/build/22_data_properties-20f791fb4e10f6ede26b29e1b75d24b8.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","children":[{"type":"image","style":{"float":"center","marginRight":"10px","marginLeft":"10px","maxHeight":"250px"},"url":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","alt":"Cubes & Clouds logo","key":"XMlLQsQibA","urlSource":"https://raw.githubusercontent.com/EO-College/cubes-and-clouds/main/icons/cnc_3icons_process_circle.svg"}],"key":"IyfQQoAN1M"}],"visibility":"show","key":"uUaxkHZwDP"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.2 Data Discovery & Properties","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T7akB1YOIh"}],"identifier":"id-2-2-data-discovery-properties","label":"2.2 Data Discovery & Properties","html_id":"id-2-2-data-discovery-properties","implicit":true,"key":"EYfCfbPjEE"}],"key":"Ky7KEMdVyL"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GDAL, STAC and Data Properties","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VzhQSaCmZB"}],"identifier":"gdal-stac-and-data-properties","label":"GDAL, STAC and Data Properties","html_id":"gdal-stac-and-data-properties","implicit":true,"key":"EHT8JXwZ8t"}],"key":"RFZurSekWs"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In this exercise we interact with a SpatioTemporal Asset Catalog (STAC) and explore the metadata using GDAL.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gutD11Wu60"}],"key":"UdgRKf1TEx"}],"key":"qsK1iRzPtr"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Start importing the necessary libraries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mqhsOOEN3F"}],"key":"OHS2ulQyXr"}],"key":"Tpgb7hvpZG"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from osgeo import gdal\nfrom pystac_client import Client\n\nimport rasterio\nimport numpy as np\nimport matplotlib.pyplot as plt","visibility":"show","key":"gu6cm03m0o"},{"type":"outputs","id":"ih8lTDzWxCEf7lr4LNtiY","children":[],"visibility":"show","key":"aM26gDHWZy"}],"visibility":"show","key":"VD9SfTPCXM"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Exploring STAC Collections","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zsTJGb3Kjp"}],"identifier":"exploring-stac-collections","label":"Exploring STAC Collections","html_id":"exploring-stac-collections","implicit":true,"key":"UC0bQgePZg"}],"key":"XkRO2jDh6a"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Connect to a STAC API and explore available data collections.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AO5SKwqr1p"}],"key":"OT8WKg7thI"}],"key":"NDAhYMFNxI"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from pystac_client import Client\n\n# Connect to a STAC API\ncatalog = Client.open(\"https://earth-search.aws.element84.com/v1\")\n\n# List available collections\ncollections = catalog.get_collections()\nprint(\"Available STAC Collections:\")\nfor collection in collections:\n    print(collection.id)","visibility":"show","key":"gLYo4YsIjx"},{"type":"outputs","id":"4FuzkkDFsvUeFfJlu0rq-","children":[],"visibility":"show","key":"cofgU8cRPL"}],"visibility":"show","key":"ro21IjRMfZ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Querying Sentinel-2 data from a STAC API","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QTElXdhR4p"}],"identifier":"querying-sentinel-2-data-from-a-stac-api","label":"Querying Sentinel-2 data from a STAC API","html_id":"querying-sentinel-2-data-from-a-stac-api","implicit":true,"key":"TvAZMWzLzU"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Connect to the same public STAC API and search for Sentinel-2 Level-2A products over a specific area (Sardinia) and time range (September 2023).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WKY6GmiX9S"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aCrS705ctt"},{"type":"text","value":"We will filter the results to include only those items with less than or equal to 20% cloud cover.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LsauKUitxt"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"o9NjBRpuyZ"},{"type":"text","value":"The code retrieves all matching items and prints the number of results, as well as the unique IDs of the returned items.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NofxElBXJN"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eLW6ulMQwa"},{"type":"text","value":"This demonstrates how to query a geospatial data catalog programmatically using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PtnPV1yU4h"},{"type":"inlineCode","value":"pystac-client","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CeWx0TSXbt"},{"type":"text","value":" library- ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NywwtgW0Ma"},{"type":"link","url":"https://pystac-client.readthedocs.io/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"which documentation can be found here","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"H5t4G2YUgr"}],"urlSource":"https://pystac-client.readthedocs.io/","key":"KxYAuvoxfQ"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LqgIlSQTUv"}],"key":"OM9csaGxlt"}],"key":"mb4g5jGirg"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Connect to a public STAC API (e.g., Sentinel-2)\ncatalog = Client.open(\"https://earth-search.aws.element84.com/v1\")\n\n# Search for Sentinel-2 items over a specific area and date range\nitems = catalog.search(\n    collections=[\"sentinel-2-l2a\"],\n    datetime=\"2023-09-01/2023-09-30\",\n    bbox=[8.0, 40.0, 9.0, 41.0],  # Example bounding box for Sardinia\n    query={\"eo:cloud_cover\": {\"lte\": 20}}\n).item_collection()\n\n# Print the number of items found\nprint(f\"Number of items found: {len(items)}\\n\")\n\n# Display the IDs of the found items\nprint(\"List of Sentinel-2 ids:\")\nfor item in items:\n    print(item.id)","visibility":"show","key":"AUY4nFBbaP"},{"type":"outputs","id":"3ExTK2CJFUmslNp1Cl3He","children":[],"visibility":"show","key":"AvZx3h5f0x"}],"visibility":"show","key":"eArCmGD3ID"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Metadata exploration","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EvlrX0e8fC"}],"identifier":"metadata-exploration","label":"Metadata exploration","html_id":"metadata-exploration","implicit":true,"key":"wpiNGgglsc"}],"key":"pNFpHQPNNO"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Display some metadata of the first STAC Item returned by our previous query:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fgyI4c84ng"}],"key":"LIfSZUoIZT"}],"key":"hFUUeufM6q"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Display metadata for the found items\nprint(f\"ID: {items[0].id}\")\nprint(f\"Date: {items[0].datetime}\")\nprint(f\"Cloud Cover: {items[0].properties['eo:cloud_cover']}%\")\nprint(f\"Geometry: {items[0].geometry}\")\nprint(f\"Projection as EPSG Code: {items[0].properties['proj:epsg']}\")","key":"W9n3Qzn5Ty"},{"type":"outputs","id":"85ovbG41ECLiP4XP0AhXo","children":[],"key":"RuoDbrbBs3"}],"key":"SixqJH4lgC"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Accessing and inspecting a Sentinel-2 red band raster","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rLfnFI3dMR"}],"identifier":"accessing-and-inspecting-a-sentinel-2-red-band-raster","label":"Accessing and inspecting a Sentinel-2 red band raster","html_id":"accessing-and-inspecting-a-sentinel-2-red-band-raster","implicit":true,"key":"Id0B8zRGZH"}],"key":"KfrKfzXr7C"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Access the first Sentinel-2 item from a previously retrieved STAC search result and extract the URL for the red band.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Gke8B6Iy1h"},{"type":"break","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dBj8I9Xer1"},{"type":"text","value":"Using GDAL, we will open the raster file from this URL and inspect its metadata, including the raster size, coordinate reference system (CRS), and geotransform parameters.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BY0c3QWaOM"},{"type":"break","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZdH0o6KlrK"},{"type":"text","value":"This demonstrates how to programmatically access specific assets within a STAC item and retrieve relevant geospatial metadata.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j1JfbWJbbG"}],"key":"i4tYEpCj1P"}],"key":"nEx2mx5hYg"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Inspect the structure of items, available assets and properties","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QW7Dcz3SME"}],"key":"Qo4eXyX8KU"}],"key":"ElSBaTeAKv"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"items[0]","visibility":"show","key":"b9KPbkFw8N"},{"type":"outputs","id":"rT017jB-yXKxPByyRFHmg","children":[],"visibility":"show","key":"zst3VmZcwf"}],"visibility":"show","key":"uLsQIGX2NK"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Print the metadata using GDAL Python","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MjCPAbCZZW"}],"key":"bz8QHY7KA3"}],"key":"U87EvPBSIo"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"first_item = items[0]\n\nasset_red_href = first_item.assets['red'].href  # Assuming B04 (red band) is available\n\n# Open and inspect the raster file\ndataset = gdal.Open(asset_red_href)\nprint(f\"Raster Size: {dataset.RasterXSize} x {dataset.RasterYSize}\")\nprint(f\"Projection: {dataset.GetProjection()}\")\ngeotransform = dataset.GetGeoTransform()\nprint(f\"GeoTransform: {dataset.GetGeoTransform()}\")\n\n# Get spatial resolution\npixel_width = geotransform[1]\npixel_height = geotransform[5]\nprint(f\"Pixel Size: {pixel_width} x {pixel_height}\")\n\n# Get the number of bands\nbands = dataset.RasterCount\nprint(f\"Number of Bands: {bands}\")","visibility":"show","key":"Qxv54Zmn4o"},{"type":"outputs","id":"ww_LXDWEI0VX1mTqXO11m","children":[],"visibility":"show","key":"SXHOw9rWre"}],"visibility":"show","key":"LvYPQ4dwCS"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Print the metadata using GDAL from command line","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dET0Fz0hem"}],"key":"yIAhLmjX1O"}],"key":"YJUnYmfgpo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nos.system(f\"gdalinfo {first_item.assets['red'].href}\")","key":"QMVvnyv3vi"},{"type":"outputs","id":"KjwoXjoVbdpVaONdMUO8A","children":[],"key":"Stcvf8SVMF"}],"key":"BYpcPuKHjL"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Simple band visualization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aIn3DNTcNf"}],"identifier":"simple-band-visualization","label":"Simple band visualization","html_id":"simple-band-visualization","implicit":true,"key":"i5blAjiham"}],"key":"gZnr24utCz"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Read the red band data as a NumPy array:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iRixjZkuBe"}],"key":"fYvoQzokKW"}],"key":"rAcRVS4g39"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"red_band = dataset.GetRasterBand(1).ReadAsArray()","key":"gNtIMdNtbg"},{"type":"outputs","id":"Z6hdqdz-MvJKWA_DNMJju","children":[],"key":"sXxtf2HkvO"}],"key":"sU0QSnBEa4"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Finally, visualize the content","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"z2WJPbMMzr"}],"key":"wM1iZvhD2e"}],"key":"MXX9MMnMyS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.imshow(red_band/1800,vmin=0,vmax=1)","key":"U7EVzvo2ke"},{"type":"outputs","id":"vx9leudLn9jFSSrIGLiys","children":[],"key":"CqrCbLh2Qi"}],"key":"bMVrvlMmOx"}],"key":"J791D7XgmL"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Data Properties","url":"/lectures/data-properties/data-properties","group":"Discovery and metadata"},"next":{"title":"Access EO Data from the Cloud","url":"/lectures/data-access/data-access","group":"Data access with OpenEO"}}},"domain":"http://localhost:3000"}