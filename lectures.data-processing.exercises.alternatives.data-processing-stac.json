{"version":3,"kind":"Notebook","sha256":"2bf6288d0c13dc3a723703e6dd89ffbccb2fdfcb395a1fba4573f600a81619da","slug":"lectures.data-processing.exercises.alternatives.data-processing-stac","location":"/lectures/3.1_data_processing/exercises/_alternatives/31_data_processing_stac.ipynb","dependencies":[],"frontmatter":{"title":"3.1 Data Processing","content_includes_title":true,"kernelspec":{"name":"openeo","display_name":"OpenEO","language":"python"},"github":"https://github.com/EO-college/cubes-and-clouds","subject":"Cubes and Clouds learning materials","numbering":{"title":{"offset":3}},"source_url":"https://github.com/EO-college/cubes-and-clouds/blob/main/lectures/3.1_data_processing/exercises/_alternatives/31_data_processing_stac.ipynb","edit_url":"https://github.com/EO-college/cubes-and-clouds/edit/main/lectures/3.1_data_processing/exercises/_alternatives/31_data_processing_stac.ipynb","thumbnail":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","exports":[{"format":"ipynb","filename":"31_data_processing_stac.ipynb","url":"/cubes-and-clouds/build/31_data_processing_s-0d60ac6ecc2a08dd451dfa609f2b2313.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","children":[{"type":"image","style":{"float":"center","marginRight":"10px","marginLeft":"10px","maxHeight":"250px"},"url":"/cubes-and-clouds/build/56b77b9fff7f39fece234cf0910cdb55.svg","alt":"Cubes & Clouds logo","key":"fydSbkayvf","urlSource":"https://raw.githubusercontent.com/EO-College/cubes-and-clouds/main/icons/cnc_3icons_process_circle.svg"}],"key":"ipC5fhVE1Z"}],"key":"hCSd5Ko3hA"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.1 Data Processing","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JNIRE1P2ET"}],"identifier":"id-3-1-data-processing","label":"3.1 Data Processing","html_id":"id-3-1-data-processing","implicit":true,"key":"w3S7P5pQcJ"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"In this exercise we will build a complete EO workflow using cloud provided data (STAC Catalogue), processing it locally; from data access to obtaining the result. In this example we will analyse snow cover in the Alps.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"HTUJPQT5Hh"}],"key":"luMNcFU7ET"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We are going to follow these steps in our analysis:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"fjoiKzVedH"}],"key":"PgJFQSYZyz"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Load satellite collections","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"yoGS7YduIZ"}],"key":"CMZtGFw8qH"}],"key":"Gi429SprYQ"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Specify the spatial, temporal extents and the features we are interested in","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"guF7OcCZOM"}],"key":"cTLLK6WxB8"}],"key":"gQwbtmqfsA"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Process the satellite data to retrieve snow cover information","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"sEzZCnNXvz"}],"key":"n1fxojbZeL"}],"key":"OAaRObPykw"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"aggregate information in data cubes","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"lWLAzGFZy3"}],"key":"a4u7K4Wb4F"}],"key":"PRsVkA8gS5"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Visualize and analyse the results","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ldKSxJBU80"}],"key":"Z2S8c7iBqu"}],"key":"B6vLJbO539"}],"key":"N86T01qaa4"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"More information on the openEO Python Client: ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"a9JptvoniK"},{"type":"link","url":"https://open-eo.github.io/openeo-python-client/index.html","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"https://​open​-eo​.github​.io​/openeo​-python​-client​/index​.html","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"egFu9hk7tN"}],"urlSource":"https://open-eo.github.io/openeo-python-client/index.html","key":"VkPt5W8R7u"}],"key":"X0TWCZofNq"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"More information on the Client Side Processing and ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"EN2NkdzEOf"},{"type":"inlineCode","value":"load_stac","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"YUu6cY9x8w"},{"type":"text","value":" functionalities: ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"fSyN4k9llX"},{"type":"link","url":"https://open-eo.github.io/openeo-python-client/cookbook/localprocessing.html","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"https://​open​-eo​.github​.io​/openeo​-python​-client​/cookbook​/localprocessing​.html","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"xzkfD56J6G"}],"urlSource":"https://open-eo.github.io/openeo-python-client/cookbook/localprocessing.html","key":"T2qHbsSQtU"}],"key":"ItJBwEQxdX"}],"key":"wkKCc1aPsu"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Install missing and update packages:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WUwllEMjzz"}],"identifier":"install-missing-and-update-packages","label":"Install missing and update packages:","html_id":"install-missing-and-update-packages","implicit":true,"key":"vXw8lmNMxJ"}],"key":"eByx3tnZS3"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"%%capture\npip install rioxarray geopandas leafmap","key":"Ley8AUDNOx"},{"type":"outputs","id":"i7wEOqaF17JAA58I2Erha","children":[],"key":"kQYhjt27Sv"}],"key":"X6Y6WWydgn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%capture\npip install openeo[localprocessing] --upgrade","key":"hDOxooCKbB"},{"type":"outputs","id":"0-oM-v8SgbV4Exbuxqj6Z","children":[],"key":"LPhRmwBwbg"}],"key":"xhS5YVgPm1"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Libraries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"syfinmPQon"}],"identifier":"libraries","label":"Libraries","html_id":"libraries","implicit":true,"key":"Z3zvHVJuVQ"}],"key":"lzOCilTubo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# platform libraries\nfrom openeo.local import LocalConnection\n\n# utility libraries\nfrom datetime import date\nimport numpy as np\nimport xarray as xr\nimport rioxarray\nimport json\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport geopandas as gpd\nimport leafmap.foliumap as leafmap","key":"YQrBBkSR9s"},{"type":"outputs","id":"cxrm9QDDGZxL9pqYBoZ6K","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"Did not load machine learning processes due to missing dependencies: Install them like this: `pip install openeo-processes-dask[implementations, ml]`\n"},"children":[],"key":"OlgwfFdklV"}],"key":"vwOK752jOk"}],"key":"CSr34Kou7o"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Region of Interest","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NJcJ5hF1VU"}],"identifier":"region-of-interest","label":"Region of Interest","html_id":"region-of-interest","implicit":true,"key":"VVLak3PvVP"}],"key":"PPRUlM6kKS"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load the catchment area.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kUlAjQr33q"}],"key":"VFKIxKVniX"}],"key":"joVakyXQuY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"catchment_outline = gpd.read_file('../31_data/catchment_outline.geojson')","key":"pCmkWQcu70"},{"type":"outputs","id":"qztIgxiVPL7EmODdkk9Ss","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"libpoppler.so.140: cannot open shared object file: No such file or directory\nlibpoppler.so.140: cannot open shared object file: No such file or directory\nlibpoppler.so.140: cannot open shared object file: No such file or directory\nlibpoppler.so.140: cannot open shared object file: No such file or directory\n"},"children":[],"key":"qTZEd3U4MT"}],"key":"OSQKprfUAJ"}],"key":"IrROREIlwQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"center = (float(catchment_outline.centroid.y), float(catchment_outline.centroid.x))\nm = leafmap.Map(center=center, zoom=10)\nm.add_vector('../31_data/catchment_outline.geojson', layer_name=\"catchment\")\nm","key":"mkYsloaSm8"},{"type":"outputs","id":"mVVjlFNnxAhL5N6FZaN3R","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/html":{"content":"<iframe srcdoc=\"&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    \n    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;\n    \n            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,\n                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;\n            &lt;style&gt;\n                #map_22711e66c4d6e30464e2f629107c2008 {\n                    position: relative;\n                    width: 100.0%;\n                    height: 100.0%;\n                    left: 0.0%;\n                    top: 0.0%;\n                }\n                .leaflet-container { font-size: 1rem; }\n            &lt;/style&gt;\n\n            &lt;style&gt;html, body {\n                width: 100%;\n                height: 100%;\n                margin: 0;\n                padding: 0;\n            }\n            &lt;/style&gt;\n\n            &lt;style&gt;#map {\n                position:absolute;\n                top:0;\n                bottom:0;\n                right:0;\n                left:0;\n                }\n            &lt;/style&gt;\n\n            &lt;script&gt;\n                L_NO_TOUCH = false;\n                L_DISABLE_3D = false;\n            &lt;/script&gt;\n\n        \n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet.fullscreen@3.0.0/Control.FullScreen.min.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet.fullscreen@3.0.0/Control.FullScreen.css&quot;/&gt;\n    &lt;script src=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css&quot;/&gt;\n    \n                    &lt;style&gt;\n                        .foliumtooltip {\n                            \n                        }\n                       .foliumtooltip table{\n                            margin: auto;\n                        }\n                        .foliumtooltip tr{\n                            text-align: left;\n                        }\n                        .foliumtooltip th{\n                            padding: 2px; padding-right: 8px;\n                        }\n                    &lt;/style&gt;\n            \n&lt;/head&gt;\n&lt;body&gt;\n    \n    \n            &lt;div class=&quot;folium-map&quot; id=&quot;map_22711e66c4d6e30464e2f629107c2008&quot; &gt;&lt;/div&gt;\n        \n&lt;/body&gt;\n&lt;script&gt;\n    \n    \n            var map_22711e66c4d6e30464e2f629107c2008 = L.map(\n                &quot;map_22711e66c4d6e30464e2f629107c2008&quot;,\n                {\n                    center: [46.79856263096177, 11.177346530561929],\n                    crs: L.CRS.EPSG3857,\n                    ...{\n  &quot;zoom&quot;: 10,\n  &quot;zoomControl&quot;: true,\n  &quot;preferCanvas&quot;: false,\n  &quot;drawExport&quot;: false,\n  &quot;layersControl&quot;: true,\n}\n\n                }\n            );\n            L.control.scale().addTo(map_22711e66c4d6e30464e2f629107c2008);\n\n            \n\n        \n    \n            var tile_layer_9ca7d22162e5e4c46ce6100f5b2d3b71 = L.tileLayer(\n                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,\n                {\n  &quot;minZoom&quot;: 0,\n  &quot;maxZoom&quot;: 24,\n  &quot;maxNativeZoom&quot;: 24,\n  &quot;noWrap&quot;: false,\n  &quot;attribution&quot;: &quot;\\u0026copy; \\u003ca href=\\&quot;https://www.openstreetmap.org/copyright\\&quot;\\u003eOpenStreetMap\\u003c/a\\u003e contributors&quot;,\n  &quot;subdomains&quot;: &quot;abc&quot;,\n  &quot;detectRetina&quot;: false,\n  &quot;tms&quot;: false,\n  &quot;opacity&quot;: 1,\n}\n\n            );\n        \n    \n            tile_layer_9ca7d22162e5e4c46ce6100f5b2d3b71.addTo(map_22711e66c4d6e30464e2f629107c2008);\n        \n    \n            L.control.fullscreen(\n                {\n  &quot;position&quot;: &quot;topleft&quot;,\n  &quot;title&quot;: &quot;Full Screen&quot;,\n  &quot;titleCancel&quot;: &quot;Exit Full Screen&quot;,\n  &quot;forceSeparateButton&quot;: false,\n}\n            ).addTo(map_22711e66c4d6e30464e2f629107c2008);\n        \n    \n\n            var geocoderOpts_geocoder_ee9596993d6371810db100ab4b55bab6 = {\n  &quot;collapsed&quot;: true,\n  &quot;position&quot;: &quot;topleft&quot;,\n  &quot;defaultMarkGeocode&quot;: true,\n  &quot;zoom&quot;: 11,\n  &quot;provider&quot;: &quot;nominatim&quot;,\n  &quot;providerOptions&quot;: {\n},\n};\n\n            // note: geocoder name should start with lowercase\n            var geocoderName_geocoder_ee9596993d6371810db100ab4b55bab6 = geocoderOpts_geocoder_ee9596993d6371810db100ab4b55bab6[&quot;provider&quot;];\n\n            var customGeocoder_geocoder_ee9596993d6371810db100ab4b55bab6 = L.Control.Geocoder[ geocoderName_geocoder_ee9596993d6371810db100ab4b55bab6 ](\n                geocoderOpts_geocoder_ee9596993d6371810db100ab4b55bab6[&#x27;providerOptions&#x27;]\n            );\n            geocoderOpts_geocoder_ee9596993d6371810db100ab4b55bab6[&quot;geocoder&quot;] = customGeocoder_geocoder_ee9596993d6371810db100ab4b55bab6;\n\n            L.Control.geocoder(\n                geocoderOpts_geocoder_ee9596993d6371810db100ab4b55bab6\n            ).on(&#x27;markgeocode&#x27;, function(e) {\n                var zoom = geocoderOpts_geocoder_ee9596993d6371810db100ab4b55bab6[&#x27;zoom&#x27;] || map_22711e66c4d6e30464e2f629107c2008.getZoom();\n                map_22711e66c4d6e30464e2f629107c2008.setView(e.geocode.center, zoom);\n            }).addTo(map_22711e66c4d6e30464e2f629107c2008);\n\n        \n    \n            map_22711e66c4d6e30464e2f629107c2008.fitBounds(\n                [[46.79856263096177, 11.177346530561929], [46.79856263096177, 11.177346530561929]],\n                {&quot;maxZoom&quot;: 10}\n            );\n        \n    \n        function geo_json_3cbf934c4886d75cc7079ee8cee718f3_styler(feature) {\n            switch(feature.id) {\n                default:\n                    return {&quot;color&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0, &quot;opacity&quot;: 1, &quot;weight&quot;: 2};\n            }\n        }\n        function geo_json_3cbf934c4886d75cc7079ee8cee718f3_highlighter(feature) {\n            switch(feature.id) {\n                default:\n                    return {&quot;fillOpacity&quot;: 0, &quot;weight&quot;: 4};\n            }\n        }\n\n        function geo_json_3cbf934c4886d75cc7079ee8cee718f3_onEachFeature(feature, layer) {\n\n            layer.on({\n                mouseout: function(e) {\n                    if(typeof e.target.setStyle === &quot;function&quot;){\n                            geo_json_3cbf934c4886d75cc7079ee8cee718f3.resetStyle(e.target);\n                    }\n                },\n                mouseover: function(e) {\n                    if(typeof e.target.setStyle === &quot;function&quot;){\n                        const highlightStyle = geo_json_3cbf934c4886d75cc7079ee8cee718f3_highlighter(e.target.feature)\n                        e.target.setStyle(highlightStyle);\n                    }\n                },\n            });\n        };\n        var geo_json_3cbf934c4886d75cc7079ee8cee718f3 = L.geoJson(null, {\n                onEachFeature: geo_json_3cbf934c4886d75cc7079ee8cee718f3_onEachFeature,\n            \n                style: geo_json_3cbf934c4886d75cc7079ee8cee718f3_styler,\n            ...{\n}\n        });\n\n        function geo_json_3cbf934c4886d75cc7079ee8cee718f3_add (data) {\n            geo_json_3cbf934c4886d75cc7079ee8cee718f3\n                .addData(data);\n        }\n            geo_json_3cbf934c4886d75cc7079ee8cee718f3_add({&quot;bbox&quot;: [11.020833333333357, 46.653599378797765, 11.366666666666694, 46.954166666666694], &quot;features&quot;: [{&quot;bbox&quot;: [11.020833333333357, 46.653599378797765, 11.366666666666694, 46.954166666666694], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[11.075, 46.72916666666669], [11.072575547960094, 46.728813340928845], [11.069091118706622, 46.72535332573787], [11.048285590277802, 46.724646674262175], [11.042024739583358, 46.73087632921009], [11.041666666666691, 46.733333333333356], [11.038123575846377, 46.73424241807728], [11.0375, 46.74583333333336], [11.03664923773874, 46.74914923773874], [11.030017428927975, 46.75085076226131], [11.028599378797768, 46.756377156575546], [11.025567287868947, 46.76028951009117], [11.0244327121311, 46.76471048990888], [11.02140062120228, 46.7686228434245], [11.020833333333357, 46.77083333333336], [11.024291653103322, 46.77172071668839], [11.025567287868947, 46.781377156575545], [11.032766045464435, 46.78945617675784], [11.033900621202282, 46.79387715657555], [11.036932712131101, 46.79778951009117], [11.038067287868948, 46.80221048990888], [11.042586263020858, 46.80762905544707], [11.052210489908878, 46.808900621202284], [11.06028951009117, 46.816099378797766], [11.06471048990888, 46.81723395453562], [11.068622843424503, 46.820266045464436], [11.073043823242212, 46.82140062120228], [11.077974107530407, 46.82522176106773], [11.079733954535614, 46.83010389539933], [11.071295166015648, 46.83957451714412], [11.0744327121311, 46.843622843424505], [11.075567287868948, 46.846579996744815], [11.071400621202281, 46.85195617675784], [11.070266045464434, 46.859321424696205], [11.082766045464435, 46.872789510091174], [11.084041680230058, 46.882445949978326], [11.089710489908878, 46.88390062120228], [11.09995964898006, 46.89319695366756], [11.096400621202282, 46.89778951009117], [11.095266045464435, 46.91343722873266], [11.103599378797767, 46.92278951009117], [11.104166666666691, 46.929166666666696], [11.114924452039954, 46.92951999240454], [11.11875, 46.9333187527127], [11.12328694661461, 46.92881334092885], [11.139924452039956, 46.92951999240454], [11.143408881293428, 46.93298000759551], [11.148288302951414, 46.933691067165825], [11.157980007595512, 46.94340888129343], [11.158691406250025, 46.948290337456626], [11.16424221462676, 46.953813340928846], [11.166666666666693, 46.954166666666694], [11.167024739583358, 46.95170966254343], [11.172575547960095, 46.94618665907121], [11.177424452039956, 46.94548000759551], [11.180908881293428, 46.94201999240454], [11.185757785373289, 46.94131334092884], [11.189242214626761, 46.937853325737876], [11.194123670789956, 46.93714192708336], [11.199646674262178, 46.93159111870662], [11.200353325737872, 46.9100755479601], [11.204519992404538, 46.90587972005211], [11.203813340928845, 46.901742214626765], [11.199646674262178, 46.89754638671877], [11.200353325737872, 46.89340888129343], [11.203813340928845, 46.889924452039956], [11.204519992404538, 46.8850755479601], [11.21248609754777, 46.877084011501765], [11.208686659071207, 46.87325778537329], [11.208333333333359, 46.85833333333336], [11.210543823242213, 46.85776604546444], [11.214456176757839, 46.85473395453562], [11.231377156575547, 46.85359937879777], [11.239456176757837, 46.846400621202285], [11.260543823242212, 46.845266045464435], [11.26458333333336, 46.84213528103301], [11.26875, 46.84536471896704], [11.272789510091172, 46.842233954535615], [11.323043823242214, 46.84109937879777], [11.331122843424506, 46.83390062120228], [11.343877156575548, 46.83276604546444], [11.347789510091172, 46.82973395453561], [11.35331590440541, 46.82831590440541], [11.354733954535616, 46.82278951009117], [11.357766045464437, 46.818877156575546], [11.358900621202284, 46.81445617675784], [11.36609937879777, 46.80637715657554], [11.366666666666694, 46.80416666666669], [11.365779283311658, 46.80070834689673], [11.356122843424506, 46.7994327121311], [11.35208333333336, 46.796301947699675], [11.347916666666693, 46.799531385633706], [11.343877156575548, 46.79640062120228], [11.339456176757839, 46.79526604546444], [11.335543823242213, 46.79223395453562], [11.321806165907145, 46.79101189507381], [11.31306728786895, 46.781377156575545], [11.311932712131103, 46.776956176757835], [11.304733954535617, 46.76887715657555], [11.30359937879777, 46.76445617675784], [11.30056728786895, 46.760543823242216], [11.299149237738742, 46.75501742892798], [11.293622843424505, 46.753599378797766], [11.289710489908881, 46.75056728786895], [11.279166666666693, 46.75], [11.278813340928846, 46.73924221462676], [11.27464667426218, 46.73504638671878], [11.275353325737873, 46.73090888129343], [11.283319430881102, 46.722917344835096], [11.27951999240454, 46.71909111870662], [11.278813340928846, 46.705908881293425], [11.275353325737873, 46.702424452039956], [11.275, 46.7], [11.274032253689262, 46.69622938368058], [11.267413330078151, 46.691099378797766], [11.260289510091171, 46.69223395453562], [11.25491333007815, 46.69640062120228], [11.251956176757838, 46.695266045464436], [11.248043823242213, 46.69223395453562], [11.239456176757837, 46.691099378797766], [11.235543823242214, 46.68806728786895], [11.218622843424505, 46.6869327121311], [11.21471048990888, 46.683900621202284], [11.197789510091171, 46.68276604546443], [11.193877156575546, 46.679733954535614], [11.184220716688394, 46.67845831976999], [11.182413736979193, 46.671416219075546], [11.173043823242214, 46.66306728786895], [11.168622843424505, 46.6619327121311], [11.159270562065997, 46.653599378797765], [11.154985215928845, 46.655143907335095], [11.154166666666692, 46.65833333333336], [11.15085076226131, 46.65918409559464], [11.15, 46.6625], [11.150353325737871, 46.66909111870662], [11.155876329210095, 46.67464192708336], [11.160757785373288, 46.67535332573787], [11.166668023003497, 46.68123406304256], [11.162853325737872, 46.685075547960096], [11.162146674262178, 46.68992445203995], [11.15451999240454, 46.69757554796009], [11.153813340928846, 46.702424452039956], [11.148290337456622, 46.70797526041669], [11.143408881293428, 46.708686659071205], [11.139924452039956, 46.71214667426218], [11.122575547960095, 46.712853325737875], [11.119091118706622, 46.71631334092884], [11.11424221462676, 46.71701999240454], [11.110757785373288, 46.72048000759551], [11.10174221462676, 46.72118665907121], [11.098257785373288, 46.724646674262175], [11.085075547960095, 46.72535332573787], [11.081591118706623, 46.728813340928845], [11.075, 46.72916666666669]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;COAST&quot;: 0, &quot;DIST_MAIN&quot;: 334.5, &quot;DIST_SINK&quot;: 334.5, &quot;ENDO&quot;: 0, &quot;HYBAS_ID&quot;: 2090516090, &quot;MAIN_BAS&quot;: 2090012980, &quot;NEXT_DOWN&quot;: 2090516950, &quot;NEXT_SINK&quot;: 2090012980, &quot;ORDER&quot;: 3, &quot;PFAF_ID&quot;: 214040804, &quot;SORT&quot;: 10988, &quot;SUB_AREA&quot;: 419.1, &quot;UP_AREA&quot;: 419.2}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});\n\n        \n    \n    geo_json_3cbf934c4886d75cc7079ee8cee718f3.bindTooltip(\n    function(layer){\n    let div = L.DomUtil.create(&#x27;div&#x27;);\n    \n    let handleObject = feature =&gt; {\n        if (feature === null) {\n            return &#x27;&#x27;;\n        } else if (typeof(feature)==&#x27;object&#x27;) {\n            return JSON.stringify(feature);\n        } else {\n            return feature;\n        }\n    }\n    let fields = [&quot;HYBAS_ID&quot;, &quot;NEXT_DOWN&quot;, &quot;NEXT_SINK&quot;, &quot;MAIN_BAS&quot;, &quot;DIST_SINK&quot;, &quot;DIST_MAIN&quot;, &quot;SUB_AREA&quot;, &quot;UP_AREA&quot;, &quot;PFAF_ID&quot;, &quot;ENDO&quot;, &quot;COAST&quot;, &quot;ORDER&quot;, &quot;SORT&quot;];\n    let aliases = [&quot;HYBAS_ID&quot;, &quot;NEXT_DOWN&quot;, &quot;NEXT_SINK&quot;, &quot;MAIN_BAS&quot;, &quot;DIST_SINK&quot;, &quot;DIST_MAIN&quot;, &quot;SUB_AREA&quot;, &quot;UP_AREA&quot;, &quot;PFAF_ID&quot;, &quot;ENDO&quot;, &quot;COAST&quot;, &quot;ORDER&quot;, &quot;SORT&quot;];\n    let table = &#x27;&lt;table&gt;&#x27; +\n        String(\n        fields.map(\n        (v,i)=&gt;\n        `&lt;tr&gt;\n            &lt;th&gt;${aliases[i]}&lt;/th&gt;\n            \n            &lt;td&gt;${handleObject(layer.feature.properties[v])}&lt;/td&gt;\n        &lt;/tr&gt;`).join(&#x27;&#x27;))\n    +&#x27;&lt;/table&gt;&#x27;;\n    div.innerHTML=table;\n    \n    return div\n    }\n    ,{\n  &quot;sticky&quot;: true,\n  &quot;className&quot;: &quot;foliumtooltip&quot;,\n});\n                     \n    \n            geo_json_3cbf934c4886d75cc7079ee8cee718f3.addTo(map_22711e66c4d6e30464e2f629107c2008);\n        \n    \n            map_22711e66c4d6e30464e2f629107c2008.fitBounds(\n                [[46.653599378797765, 11.020833333333357], [46.954166666666694, 11.366666666666694]],\n                {}\n            );\n        \n    \n            var layer_control_c60550e936a1236d1748fa39ff9ad097_layers = {\n                base_layers : {\n                    &quot;openstreetmap&quot; : tile_layer_9ca7d22162e5e4c46ce6100f5b2d3b71,\n                },\n                overlays :  {\n                    &quot;catchment&quot; : geo_json_3cbf934c4886d75cc7079ee8cee718f3,\n                },\n            };\n            let layer_control_c60550e936a1236d1748fa39ff9ad097 = L.control.layers(\n                layer_control_c60550e936a1236d1748fa39ff9ad097_layers.base_layers,\n                layer_control_c60550e936a1236d1748fa39ff9ad097_layers.overlays,\n                {\n  &quot;position&quot;: &quot;topright&quot;,\n  &quot;collapsed&quot;: true,\n  &quot;autoZIndex&quot;: true,\n}\n            ).addTo(map_22711e66c4d6e30464e2f629107c2008);\n\n        \n&lt;/script&gt;\n&lt;/html&gt;\" width=\"100%\" height=\"600\"style=\"border:none !important;\" \"allowfullscreen\" \"webkitallowfullscreen\" \"mozallowfullscreen\"></iframe>","content_type":"text/html"},"text/plain":{"content":"<leafmap.foliumap.Map at 0x7f7f9eabac50>","content_type":"text/plain"}}},"children":[],"key":"VxjEs3dKCm"}],"key":"HgtZ4cbL9J"}],"key":"vqbuQq11iu"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Inspect STAC Metadata","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NLeKK3jME3"}],"identifier":"inspect-stac-metadata","label":"Inspect STAC Metadata","html_id":"inspect-stac-metadata","implicit":true,"key":"JY93vj3pz6"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We need to set the following configurations to define the content of the data cube we want to access:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"kZvtbnAGKk"}],"key":"ZlOQWGFZ96"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"STAC Collection URL","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JCBUVzRELt"}],"key":"IAZqcgK4uY"}],"key":"pGmtewH35n"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"band names","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"PsWlEJ2yr3"}],"key":"kPTHnzyCF8"}],"key":"lb5j2SIF1O"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"time range","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lJtLvNT7tY"}],"key":"YJDJuC7r5x"}],"key":"Pf4DvtLS53"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"the area of interest specifed via bounding box coordinates","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"SK3kAjKf03"}],"key":"TZvcQgFEaB"}],"key":"pkExpBXGUy"}],"key":"kTC51xDEBi"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"We use the Sentinel-2 L2A Collection from Microsoft: ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"wRxaHeaaWq"},{"type":"link","url":"https://planetarycomputer.microsoft.com/api/stac/v1/collections/sentinel-2-l2a","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"https://​planetarycomputer​.microsoft​.com​/api​/stac​/v1​/collections​/sentinel​-2​-l2a","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"hEEqm1ggWU"}],"urlSource":"https://planetarycomputer.microsoft.com/api/stac/v1/collections/sentinel-2-l2a","key":"cjsd3qbTFd"}],"key":"BDKKA2lgIh"}],"key":"qoaiE2qLQ5"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define a workflow","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"v5SJphe13W"}],"identifier":"define-a-workflow","label":"Define a workflow","html_id":"define-a-workflow","implicit":true,"key":"HShKRCGEc2"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We will define our workflow now. And chain all the processes together we need for analyzing the snow cover in the catchment.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ZxCzRbO04H"}],"key":"SsQpYtumnR"}],"key":"vj54U6leRc"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the data cube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PusaNaiXRL"}],"identifier":"define-the-data-cube","label":"Define the data cube","html_id":"define-the-data-cube","implicit":true,"key":"Fuhy8pYrEb"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We define all extents of our data cube. We use the catchment as spatial extent. As a time range we will focus on the snow melting season 2018, in particular from Febraury to June 2018.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"QJtoPPTQU4"}],"key":"hI2WzCMmyE"}],"key":"cClKckGgWe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bbox = catchment_outline.bounds.iloc[0]\nbbox","key":"uFDQ08APzB"},{"type":"outputs","id":"bMUWfNKxkHfxtvQ5pOmk-","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"minx    11.020833\nminy    46.653599\nmaxx    11.366667\nmaxy    46.954167\nName: 0, dtype: float64","content_type":"text/plain"}}},"children":[],"key":"Yvlg157J0s"}],"key":"VlWDguIYlR"}],"key":"ouezmmSAB7"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We know that the catchment area is almost fully covered by the Sentinel-2 32TPS tile and therefore we use this information in the properties filter, along with a first filter on the cloud coverage.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ldoRMI7OAQ"}],"key":"uFZ5ZsbGw6"}],"key":"G8yOagoKUR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"local_conn = LocalConnection(\"./\")\n\nurl = \"https://planetarycomputer.microsoft.com/api/stac/v1/collections/sentinel-2-l2a\"\nspatial_extent  = {\"west\":bbox[0],\"east\":bbox[2],\"south\":bbox[1],\"north\":bbox[3]}\ntemporal_extent = [\"2018-02-01\", \"2018-06-30\"]\n\nbands_11_scl    = [\"B11\", \"SCL\"]\nband_03        = [\"B03\"]\n\nproperties = {\"eo:cloud_cover\": dict(lt=75),\n              \"s2:mgrs_tile\": dict(eq=\"32TPS\")}","key":"FGYkRv9KGL"},{"type":"outputs","id":"vA2wAEj8Vm_zYoY6J257r","children":[],"key":"vRcAOvQXVQ"}],"key":"sFgEfDQ6d2"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load the data cube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"st1uTVlGMF"}],"identifier":"load-the-data-cube","label":"Load the data cube","html_id":"load-the-data-cube","implicit":true,"key":"E3Y4XPBsS5"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We have defined the extents we are interested in. Now we use these definitions to load the data cube.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"pcKDACIbzT"}],"key":"dNf8ax3qDe"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Since the B03 band have resolution of 10m and B11 and SCL 20m, we load them separately and then align in a second step using openEO.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"qgXBPDDcQi"}],"key":"rZX0LjIEyp"}],"visibility":"show","key":"R4tzdNvsf2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"s2_B11_SCL = local_conn.load_stac(\n    url=url,\n    spatial_extent=spatial_extent,\n    temporal_extent=temporal_extent,\n    bands=bands_11_scl,\n    properties=properties,\n)","key":"tayc1bnGbD"},{"type":"outputs","id":"oW3WtkK3H15z_t29uJLX1","children":[],"key":"sXATWYNgBm"}],"key":"a6jI7xebz5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"s2_B03 = local_conn.load_stac(\n    url=url,\n    spatial_extent=spatial_extent,\n    temporal_extent=temporal_extent,\n    bands=band_03,\n    properties=properties,\n)","key":"an7AK9dOHS"},{"type":"outputs","id":"GQ8gcxFvWXIpS4JPLNRiw","children":[],"key":"XVg9OnyWlU"}],"key":"HEEKUs5IU7"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Uncomment the content of the next three cells if you would like to download the data first and then use the netCDFs to proceed.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EXcshsrJG7"}],"key":"UBY4hrYXBL"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"It will download ~3 GB of data, make sure to have enough free space.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ghLLk7yMDg"}],"key":"VXh7rxc0Bq"}],"key":"oeiF0BmuSa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# %%time\n# s2_11_scl_xr = s2_B11_SCL.execute()\n# # Remove problematic attributes and coordinates, which prevent to write a valid netCDF file\n# for at in s2_11_scl_xr.attrs:\n#     # allowed types: str, Number, ndarray, number, list, tuple\n#     if not isinstance(s2_11_scl_xr.attrs[at], (int, float, str, np.ndarray, list, tuple)):\n#         s2_11_scl_xr.attrs[at] = str(s2_11_scl_xr.attrs[at])\n\n# for c in s2_11_scl_xr.coords:\n#     if s2_11_scl_xr[c].dtype==\"object\":\n#         s2_11_scl_xr = s2_11_scl_xr.drop_vars(c)\n\n# s2_11_scl_xr.to_dataset(dim=\"band\").to_netcdf(\"s2_11_scl_xr.nc\")","key":"zfo9ZvfQ5b"},{"type":"outputs","id":"XkfabCB7XoET02AIDh9nI","children":[],"key":"DcGbTBNi7h"}],"key":"rcm078kuXk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# %%time\n# s2_03_xr = s2_B03.execute()\n# # Remove problematic attributes and coordinates, which prevent to write a valid netCDF file\n# for at in s2_03_xr.attrs:\n#     # allowed types: str, Number, ndarray, number, list, tuple\n#     if not isinstance(s2_03_xr.attrs[at], (int, float, str, np.ndarray, list, tuple)):\n#         s2_03_xr.attrs[at] = str(s2_03_xr.attrs[at])\n\n# for c in s2_03_xr.coords:\n#     if s2_03_xr[c].dtype==\"object\":\n#         s2_03_xr = s2_03_xr.drop_vars(c)\n\n# s2_03_xr.to_dataset(dim=\"band\").to_netcdf(\"s2_03_xr.nc\")","key":"Bjovpt0eSB"},{"type":"outputs","id":"sg_A3DjQ3TBywhdNOWgKU","children":[],"key":"HGKiFiY28N"}],"key":"wnlNOIUmBz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# s2_B03 = local_conn.load_collection(\"s2_03_xr.nc\")\n# s2_B11_SCL = local_conn.load_collection(\"s2_11_scl_xr.nc\")","key":"fDPSk1Qw8T"},{"type":"outputs","id":"PTu3ID7OuhJz8vtitQqRD","children":[],"key":"ToYArvvQsM"}],"key":"jcLsPSm99a"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"s2_20m = s2_B03.resample_cube_spatial(target=s2_B11_SCL,method=\"average\").merge_cubes(s2_B11_SCL)","key":"RT9n6D3DdQ"},{"type":"outputs","id":"Mb2TPyZ9wkwdbEmKSyHH5","children":[],"key":"sN1MLJHfSt"}],"key":"BCU7yoQxP2"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"NDSI - Normalized Difference Snow Index","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DZKEPCcGt0"}],"identifier":"ndsi-normalized-difference-snow-index","label":"NDSI - Normalized Difference Snow Index","html_id":"ndsi-normalized-difference-snow-index","implicit":true,"key":"K2V16coI2U"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The Normalized Difference Snow Index (NDSI) is computed as:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"rzqXvQWcQ9"}],"key":"wSjLrPWmut"},{"type":"math","value":"NDSI = \\frac {GREEN - SWIR} {GREEN +SWIR}","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>N</mi><mi>D</mi><mi>S</mi><mi>I</mi><mo>=</mo><mfrac><mrow><mi>G</mi><mi>R</mi><mi>E</mi><mi>E</mi><mi>N</mi><mo>−</mo><mi>S</mi><mi>W</mi><mi>I</mi><mi>R</mi></mrow><mrow><mi>G</mi><mi>R</mi><mi>E</mi><mi>E</mi><mi>N</mi><mo>+</mo><mi>S</mi><mi>W</mi><mi>I</mi><mi>R</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">NDSI = \\frac {GREEN - SWIR} {GREEN +SWIR}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.1297em;vertical-align:-0.7693em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">GREEN</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">GREEN</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>","enumerator":"1","key":"wgFg9Nongm"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"We have created a Sentinel-2 data cube with bands B03 (green), B11 (SWIR) and the scene classification mask (SCL). We will use the green and SWIR band to calculate a the NDSI. This process is reducing the band dimension of the data cube to generate new information, the NDSI.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"QgSUbgKKWO"}],"key":"xINYH3eiEm"}],"key":"zkFGJ4iCkF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"green = s2_20m.band(\"B03\")\nswir = s2_20m.band(\"B11\")\nndsi = (green - swir) / (green + swir)\nndsi","key":"hVPIy4hlQd"},{"type":"outputs","id":"8Mxrxt34-l8ZIraDucUos","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/html":{"content":"\n    <script>\n    if (!window.customElements || !window.customElements.get('openeo-model-builder')) {\n        var el = document.createElement('script');\n        el.src = \"https://cdn.jsdelivr.net/npm/@openeo/vue-components@2/assets/openeo.min.js\";\n        document.head.appendChild(el);\n\n        var font = document.createElement('font');\n        font.as = \"font\";\n        font.type = \"font/woff2\";\n        font.crossOrigin = true;\n        font.href = \"https://use.fontawesome.com/releases/v5.13.0/webfonts/fa-solid-900.woff2\"\n        document.head.appendChild(font);\n    }\n    </script>\n    <openeo-model-builder>\n        <script type=\"application/json\">{\"id\": \"215e38f05edc4f33aa10d8bdb9eec541\", \"explicit-zoom\": true, \"height\": \"400px\", \"value\": {\"process_graph\": {\"loadstac1\": {\"process_id\": \"load_stac\", \"arguments\": {\"bands\": [\"B03\"], \"properties\": {\"eo:cloud_cover\": {\"lt\": 75}, \"s2:mgrs_tile\": {\"eq\": \"32TPS\"}}, \"spatial_extent\": {\"west\": 11.020833333333357, \"east\": 11.366666666666694, \"south\": 46.653599378797765, \"north\": 46.954166666666694}, \"temporal_extent\": [\"2018-02-01\", \"2018-06-30\"], \"url\": \"https://planetarycomputer.microsoft.com/api/stac/v1/collections/sentinel-2-l2a\"}}, \"loadstac2\": {\"process_id\": \"load_stac\", \"arguments\": {\"bands\": [\"B11\", \"SCL\"], \"properties\": {\"eo:cloud_cover\": {\"lt\": 75}, \"s2:mgrs_tile\": {\"eq\": \"32TPS\"}}, \"spatial_extent\": {\"west\": 11.020833333333357, \"east\": 11.366666666666694, \"south\": 46.653599378797765, \"north\": 46.954166666666694}, \"temporal_extent\": [\"2018-02-01\", \"2018-06-30\"], \"url\": \"https://planetarycomputer.microsoft.com/api/stac/v1/collections/sentinel-2-l2a\"}}, \"resamplecubespatial1\": {\"process_id\": \"resample_cube_spatial\", \"arguments\": {\"data\": {\"from_node\": \"loadstac1\"}, \"method\": \"average\", \"target\": {\"from_node\": \"loadstac2\"}}}, \"mergecubes1\": {\"process_id\": \"merge_cubes\", \"arguments\": {\"cube1\": {\"from_node\": \"resamplecubespatial1\"}, \"cube2\": {\"from_node\": \"loadstac2\"}}}, \"reducedimension1\": {\"process_id\": \"reduce_dimension\", \"arguments\": {\"data\": {\"from_node\": \"mergecubes1\"}, \"dimension\": \"band\", \"reducer\": {\"process_graph\": {\"arrayelement1\": {\"process_id\": \"array_element\", \"arguments\": {\"data\": {\"from_parameter\": \"data\"}, \"index\": 0}}, \"arrayelement2\": {\"process_id\": \"array_element\", \"arguments\": {\"data\": {\"from_parameter\": \"data\"}, \"index\": 1}}, \"subtract1\": {\"process_id\": \"subtract\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement1\"}, \"y\": {\"from_node\": \"arrayelement2\"}}}, \"add1\": {\"process_id\": \"add\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement1\"}, \"y\": {\"from_node\": \"arrayelement2\"}}}, \"divide1\": {\"process_id\": \"divide\", \"arguments\": {\"x\": {\"from_node\": \"subtract1\"}, \"y\": {\"from_node\": \"add1\"}}, \"result\": true}}}}, \"result\": true}}}}</script>\n    </openeo-model-builder>\n    ","content_type":"text/html"},"text/plain":{"content":"<openeo.rest.datacube.DataCube at 0x7f7f9348c150>","content_type":"text/plain"}}},"children":[],"key":"b4UvPkDNgl"}],"key":"CA7H6N3ANI"}],"key":"LqmfosHr65"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Creating the Snow Map","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FUGUVlnH6z"}],"identifier":"creating-the-snow-map","label":"Creating the Snow Map","html_id":"creating-the-snow-map","implicit":true,"key":"EW0ALhXcHi"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"So far we have a timeseries of NDSI values. We are intereseted in the presence of snow though. Ideally in a binary classification: snow and no snow.\nTo achieve this we are setting a threshold of 0.42 on the NDSI. This gives us a binary snow map.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"vsacCZkIHp"}],"key":"HXoeai31kQ"}],"key":"khv3vWAGSK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ndsi_mask = ( ndsi > 0.42 )\nsnowmap = ndsi_mask.add_dimension(name=\"band\",label=\"snow_map\",type=\"bands\")\nsnowmap","key":"CN9coM77Fk"},{"type":"outputs","id":"zpp0jY91zIq5--_HDamSX","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":15,"metadata":{},"data":{"text/html":{"content":"\n    <script>\n    if (!window.customElements || !window.customElements.get('openeo-model-builder')) {\n        var el = document.createElement('script');\n        el.src = \"https://cdn.jsdelivr.net/npm/@openeo/vue-components@2/assets/openeo.min.js\";\n        document.head.appendChild(el);\n\n        var font = document.createElement('font');\n        font.as = \"font\";\n        font.type = \"font/woff2\";\n        font.crossOrigin = true;\n        font.href = \"https://use.fontawesome.com/releases/v5.13.0/webfonts/fa-solid-900.woff2\"\n        document.head.appendChild(font);\n    }\n    </script>\n    <openeo-model-builder>\n        <script type=\"application/json\">{\"id\": \"ad3d7db7b9eb40d38703b0d5f5bfd068\", \"explicit-zoom\": true, \"height\": \"400px\", \"value\": {\"process_graph\": {\"loadstac1\": {\"process_id\": \"load_stac\", \"arguments\": {\"bands\": [\"B03\"], \"properties\": {\"eo:cloud_cover\": {\"lt\": 75}, \"s2:mgrs_tile\": {\"eq\": \"32TPS\"}}, \"spatial_extent\": {\"west\": 11.020833333333357, \"east\": 11.366666666666694, \"south\": 46.653599378797765, \"north\": 46.954166666666694}, \"temporal_extent\": [\"2018-02-01\", \"2018-06-30\"], \"url\": \"https://planetarycomputer.microsoft.com/api/stac/v1/collections/sentinel-2-l2a\"}}, \"loadstac2\": {\"process_id\": \"load_stac\", \"arguments\": {\"bands\": [\"B11\", \"SCL\"], \"properties\": {\"eo:cloud_cover\": {\"lt\": 75}, \"s2:mgrs_tile\": {\"eq\": \"32TPS\"}}, \"spatial_extent\": {\"west\": 11.020833333333357, \"east\": 11.366666666666694, \"south\": 46.653599378797765, \"north\": 46.954166666666694}, \"temporal_extent\": [\"2018-02-01\", \"2018-06-30\"], \"url\": \"https://planetarycomputer.microsoft.com/api/stac/v1/collections/sentinel-2-l2a\"}}, \"resamplecubespatial1\": {\"process_id\": \"resample_cube_spatial\", \"arguments\": {\"data\": {\"from_node\": \"loadstac1\"}, \"method\": \"average\", \"target\": {\"from_node\": \"loadstac2\"}}}, \"mergecubes1\": {\"process_id\": \"merge_cubes\", \"arguments\": {\"cube1\": {\"from_node\": \"resamplecubespatial1\"}, \"cube2\": {\"from_node\": \"loadstac2\"}}}, \"reducedimension1\": {\"process_id\": \"reduce_dimension\", \"arguments\": {\"data\": {\"from_node\": \"mergecubes1\"}, \"dimension\": \"band\", \"reducer\": {\"process_graph\": {\"arrayelement1\": {\"process_id\": \"array_element\", \"arguments\": {\"data\": {\"from_parameter\": \"data\"}, \"index\": 0}}, \"arrayelement2\": {\"process_id\": \"array_element\", \"arguments\": {\"data\": {\"from_parameter\": \"data\"}, \"index\": 1}}, \"subtract1\": {\"process_id\": \"subtract\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement1\"}, \"y\": {\"from_node\": \"arrayelement2\"}}}, \"add1\": {\"process_id\": \"add\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement1\"}, \"y\": {\"from_node\": \"arrayelement2\"}}}, \"divide1\": {\"process_id\": \"divide\", \"arguments\": {\"x\": {\"from_node\": \"subtract1\"}, \"y\": {\"from_node\": \"add1\"}}}, \"gt1\": {\"process_id\": \"gt\", \"arguments\": {\"x\": {\"from_node\": \"divide1\"}, \"y\": 0.42}, \"result\": true}}}}}, \"adddimension1\": {\"process_id\": \"add_dimension\", \"arguments\": {\"data\": {\"from_node\": \"reducedimension1\"}, \"label\": \"snow_map\", \"name\": \"band\", \"type\": \"bands\"}, \"result\": true}}}}</script>\n    </openeo-model-builder>\n    ","content_type":"text/html"},"text/plain":{"content":"<openeo.rest.datacube.DataCube at 0x7f7f9364bd90>","content_type":"text/plain"}}},"children":[],"key":"MFVcV8g99i"}],"key":"MVdgXIrYTl"}],"key":"cwFP8ovdme"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Creating a cloud mask","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rrKRk1Uv13"}],"identifier":"creating-a-cloud-mask","label":"Creating a cloud mask","html_id":"creating-a-cloud-mask","implicit":true,"key":"Dpetp9DpTI"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We are going to use “SCL” band for creating a cloud mask and then applying it to the NDSI.\n","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"dzYMZB3s8f"},{"type":"inlineCode","value":"8 = cloud medium probability","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Ade81FdNuQ"},{"type":"text","value":", ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Lv0MLesiYx"},{"type":"inlineCode","value":"9 = cloud high probability","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"tNba5tI77K"},{"type":"text","value":", ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"i7bkgFEFPM"},{"type":"inlineCode","value":"3 = cloud shadow","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"jUSloNpUo5"}],"key":"XPmeYKEp4Y"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Here is more information on the Scene Classification ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jVUac7uSOC"},{"type":"link","url":"https://sentinels.copernicus.eu/web/sentinel/technical-guides/sentinel-2-msi/level-2a/algorithm-overview","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"https://​sentinels​.copernicus​.eu​/web​/sentinel​/technical​-guides​/sentinel​-2​-msi​/level​-2a​/algorithm​-overview","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"R5QwJl3DJp"}],"urlSource":"https://sentinels.copernicus.eu/web/sentinel/technical-guides/sentinel-2-msi/level-2a/algorithm-overview","key":"BYTqlzVEsP"}],"key":"Kzy6011vBU"},{"type":"table","position":{"start":{"line":7,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Value","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"nf6XXmpizp"}],"key":"RLflJ4u7ZE"},{"type":"tableCell","header":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Label","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"u4vwNrOhl0"}],"key":"trNk21hy7u"}],"key":"si91e8XBLe"},{"type":"tableRow","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"0","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"vsdD8a912y"}],"key":"iR7M5tZ5kb"},{"type":"tableCell","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"NO_DATA","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ki89byPle3"}],"key":"XkpFDCtyvn"}],"key":"RlwxDpNB66"},{"type":"tableRow","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"1","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"PK5uO7c9et"}],"key":"d4NOSosw99"},{"type":"tableCell","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"SATURATED_OR_DEFECTIVE","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"OBe2dEFMrJ"}],"key":"qVeddZcXyT"}],"key":"AYU1Xfvduy"},{"type":"tableRow","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"2","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"D61UmSFHWF"}],"key":"uEg1v82HEX"},{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"CAST_SHADOWS","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"BHt71I6N0T"}],"key":"U9mFQNM7I0"}],"key":"e4oHo31XTm"},{"type":"tableRow","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"3","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"eK1HysbIPg"}],"key":"kimH3LBazR"},{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"CLOUD_SHADOWS","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"VsuGOTB8FH"}],"key":"lFktZtm8nr"}],"key":"XFFhlyJvBN"},{"type":"tableRow","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"4","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"PhQ4URLXny"}],"key":"CEzpiItfwZ"},{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"VEGETATION","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"FGL1VYJTIB"}],"key":"ctnyw0uWhl"}],"key":"ApopFDKBDS"},{"type":"tableRow","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"5","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"O131WuRBja"}],"key":"ZwyESJ0oyk"},{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"NOT_VEGETATED","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"sqxmIlJ62d"}],"key":"AMjI9H9sR2"}],"key":"NMUJIIOvPO"},{"type":"tableRow","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"6","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"NZOBaZPvPA"}],"key":"bob7jVKkGk"},{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"WATER","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"s2EmwWZWlw"}],"key":"gu2mXzww6y"}],"key":"XnCIFmbqXf"},{"type":"tableRow","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"7","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"hHjWfklsfw"}],"key":"LVPJ0V6z1M"},{"type":"tableCell","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"UNCLASSIFIED","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"pvm0mu3Gz1"}],"key":"B1sYjddqC0"}],"key":"o9jR3nJuIj"},{"type":"tableRow","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"8","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"Vi2f1ixQWQ"}],"key":"V9hQTgUl22"},{"type":"tableCell","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"CLOUD_MEDIUM_PROBABILITY","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"myoJuy0YgX"}],"key":"HMxDClu2Hq"}],"key":"vqFIbiQrlA"},{"type":"tableRow","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"9","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"GSQghLK8we"}],"key":"GTwXjBc8VM"},{"type":"tableCell","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"CLOUD_HIGH_PROBABILITY","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"z0O21OJwto"}],"key":"wN7BKFJHK2"}],"key":"MCtshb0aNY"},{"type":"tableRow","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"10","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"TMAVSsmrid"}],"key":"ugP7E6Zpl6"},{"type":"tableCell","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"THIN_CIRRUS","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"MBQdWpjcvg"}],"key":"dztwlGL4qF"}],"key":"GIOXfYOLDD"},{"type":"tableRow","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"11","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"cSGHS4WLvX"}],"key":"yzHKEED8KY"},{"type":"tableCell","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"SNOW or ICE","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"it8IQJ1SOe"}],"key":"t9SQGlXOCb"}],"key":"FpEQWTLFta"}],"key":"HcIGNqyRpQ"}],"key":"LYxiqYRQzX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"scl_band = s2_20m.band(\"SCL\")\ncloud_mask = ( (scl_band == 8) | (scl_band == 9) | (scl_band == 3) ).add_dimension(name=\"band\",label=\"cloud_mask\",type=\"bands\")\ncloud_mask","key":"o9bDhP5Gw6"},{"type":"outputs","id":"o2Dms2z5lA-PNc7gWLyr4","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":16,"metadata":{},"data":{"text/html":{"content":"\n    <script>\n    if (!window.customElements || !window.customElements.get('openeo-model-builder')) {\n        var el = document.createElement('script');\n        el.src = \"https://cdn.jsdelivr.net/npm/@openeo/vue-components@2/assets/openeo.min.js\";\n        document.head.appendChild(el);\n\n        var font = document.createElement('font');\n        font.as = \"font\";\n        font.type = \"font/woff2\";\n        font.crossOrigin = true;\n        font.href = \"https://use.fontawesome.com/releases/v5.13.0/webfonts/fa-solid-900.woff2\"\n        document.head.appendChild(font);\n    }\n    </script>\n    <openeo-model-builder>\n        <script type=\"application/json\">{\"id\": \"79d713d0347149d1b0cf540bcfcda050\", \"explicit-zoom\": true, \"height\": \"400px\", \"value\": {\"process_graph\": {\"loadstac1\": {\"process_id\": \"load_stac\", \"arguments\": {\"bands\": [\"B03\"], \"properties\": {\"eo:cloud_cover\": {\"lt\": 75}, \"s2:mgrs_tile\": {\"eq\": \"32TPS\"}}, \"spatial_extent\": {\"west\": 11.020833333333357, \"east\": 11.366666666666694, \"south\": 46.653599378797765, \"north\": 46.954166666666694}, \"temporal_extent\": [\"2018-02-01\", \"2018-06-30\"], \"url\": \"https://planetarycomputer.microsoft.com/api/stac/v1/collections/sentinel-2-l2a\"}}, \"loadstac2\": {\"process_id\": \"load_stac\", \"arguments\": {\"bands\": [\"B11\", \"SCL\"], \"properties\": {\"eo:cloud_cover\": {\"lt\": 75}, \"s2:mgrs_tile\": {\"eq\": \"32TPS\"}}, \"spatial_extent\": {\"west\": 11.020833333333357, \"east\": 11.366666666666694, \"south\": 46.653599378797765, \"north\": 46.954166666666694}, \"temporal_extent\": [\"2018-02-01\", \"2018-06-30\"], \"url\": \"https://planetarycomputer.microsoft.com/api/stac/v1/collections/sentinel-2-l2a\"}}, \"resamplecubespatial1\": {\"process_id\": \"resample_cube_spatial\", \"arguments\": {\"data\": {\"from_node\": \"loadstac1\"}, \"method\": \"average\", \"target\": {\"from_node\": \"loadstac2\"}}}, \"mergecubes1\": {\"process_id\": \"merge_cubes\", \"arguments\": {\"cube1\": {\"from_node\": \"resamplecubespatial1\"}, \"cube2\": {\"from_node\": \"loadstac2\"}}}, \"reducedimension1\": {\"process_id\": \"reduce_dimension\", \"arguments\": {\"data\": {\"from_node\": \"mergecubes1\"}, \"dimension\": \"band\", \"reducer\": {\"process_graph\": {\"arrayelement1\": {\"process_id\": \"array_element\", \"arguments\": {\"data\": {\"from_parameter\": \"data\"}, \"index\": 2}}, \"eq1\": {\"process_id\": \"eq\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement1\"}, \"y\": 8}}, \"eq2\": {\"process_id\": \"eq\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement1\"}, \"y\": 9}}, \"or1\": {\"process_id\": \"or\", \"arguments\": {\"x\": {\"from_node\": \"eq1\"}, \"y\": {\"from_node\": \"eq2\"}}}, \"eq3\": {\"process_id\": \"eq\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement1\"}, \"y\": 3}}, \"or2\": {\"process_id\": \"or\", \"arguments\": {\"x\": {\"from_node\": \"or1\"}, \"y\": {\"from_node\": \"eq3\"}}, \"result\": true}}}}}, \"adddimension1\": {\"process_id\": \"add_dimension\", \"arguments\": {\"data\": {\"from_node\": \"reducedimension1\"}, \"label\": \"cloud_mask\", \"name\": \"band\", \"type\": \"bands\"}, \"result\": true}}}}</script>\n    </openeo-model-builder>\n    ","content_type":"text/html"},"text/plain":{"content":"<openeo.rest.datacube.DataCube at 0x7f7f9380b390>","content_type":"text/plain"}}},"children":[],"key":"c37GlEkxwP"}],"key":"vv8qNUppiv"}],"key":"QeTtPxbcx7"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Applying the cloud mask to the snowmap","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rIpWQZ8d59"}],"identifier":"applying-the-cloud-mask-to-the-snowmap","label":"Applying the cloud mask to the snowmap","html_id":"applying-the-cloud-mask-to-the-snowmap","implicit":true,"key":"VtQIzLxvt1"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We will mask out all pixels that are covered by clouds. This will result in: 0 = no_snow, 1 = snow, 2 = cloud","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"MqM5YhdnyL"}],"key":"qF4iBzcNBs"}],"key":"DDmikEnWfa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"snowmap_cloudfree = snowmap.mask(cloud_mask,replacement=2) # replacement is null by default\nsnowmap_cloudfree","key":"eHKLD6H29b"},{"type":"outputs","id":"-LZpwy3kcrF47jkwKS1HP","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":17,"metadata":{},"data":{"text/html":{"content":"\n    <script>\n    if (!window.customElements || !window.customElements.get('openeo-model-builder')) {\n        var el = document.createElement('script');\n        el.src = \"https://cdn.jsdelivr.net/npm/@openeo/vue-components@2/assets/openeo.min.js\";\n        document.head.appendChild(el);\n\n        var font = document.createElement('font');\n        font.as = \"font\";\n        font.type = \"font/woff2\";\n        font.crossOrigin = true;\n        font.href = \"https://use.fontawesome.com/releases/v5.13.0/webfonts/fa-solid-900.woff2\"\n        document.head.appendChild(font);\n    }\n    </script>\n    <openeo-model-builder>\n        <script type=\"application/json\">{\"id\": \"bedba51d1d9344cc810612af981d1fb5\", \"explicit-zoom\": true, \"height\": \"400px\", \"value\": {\"process_graph\": {\"loadstac1\": {\"process_id\": \"load_stac\", \"arguments\": {\"bands\": [\"B03\"], \"properties\": {\"eo:cloud_cover\": {\"lt\": 75}, \"s2:mgrs_tile\": {\"eq\": \"32TPS\"}}, \"spatial_extent\": {\"west\": 11.020833333333357, \"east\": 11.366666666666694, \"south\": 46.653599378797765, \"north\": 46.954166666666694}, \"temporal_extent\": [\"2018-02-01\", \"2018-06-30\"], \"url\": \"https://planetarycomputer.microsoft.com/api/stac/v1/collections/sentinel-2-l2a\"}}, \"loadstac2\": {\"process_id\": \"load_stac\", \"arguments\": {\"bands\": [\"B11\", \"SCL\"], \"properties\": {\"eo:cloud_cover\": {\"lt\": 75}, \"s2:mgrs_tile\": {\"eq\": \"32TPS\"}}, \"spatial_extent\": {\"west\": 11.020833333333357, \"east\": 11.366666666666694, \"south\": 46.653599378797765, \"north\": 46.954166666666694}, \"temporal_extent\": [\"2018-02-01\", \"2018-06-30\"], \"url\": \"https://planetarycomputer.microsoft.com/api/stac/v1/collections/sentinel-2-l2a\"}}, \"resamplecubespatial1\": {\"process_id\": \"resample_cube_spatial\", \"arguments\": {\"data\": {\"from_node\": \"loadstac1\"}, \"method\": \"average\", \"target\": {\"from_node\": \"loadstac2\"}}}, \"mergecubes1\": {\"process_id\": \"merge_cubes\", \"arguments\": {\"cube1\": {\"from_node\": \"resamplecubespatial1\"}, \"cube2\": {\"from_node\": \"loadstac2\"}}}, \"reducedimension1\": {\"process_id\": \"reduce_dimension\", \"arguments\": {\"data\": {\"from_node\": \"mergecubes1\"}, \"dimension\": \"band\", \"reducer\": {\"process_graph\": {\"arrayelement1\": {\"process_id\": \"array_element\", \"arguments\": {\"data\": {\"from_parameter\": \"data\"}, \"index\": 0}}, \"arrayelement2\": {\"process_id\": \"array_element\", \"arguments\": {\"data\": {\"from_parameter\": \"data\"}, \"index\": 1}}, \"subtract1\": {\"process_id\": \"subtract\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement1\"}, \"y\": {\"from_node\": \"arrayelement2\"}}}, \"add1\": {\"process_id\": \"add\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement1\"}, \"y\": {\"from_node\": \"arrayelement2\"}}}, \"divide1\": {\"process_id\": \"divide\", \"arguments\": {\"x\": {\"from_node\": \"subtract1\"}, \"y\": {\"from_node\": \"add1\"}}}, \"gt1\": {\"process_id\": \"gt\", \"arguments\": {\"x\": {\"from_node\": \"divide1\"}, \"y\": 0.42}, \"result\": true}}}}}, \"adddimension1\": {\"process_id\": \"add_dimension\", \"arguments\": {\"data\": {\"from_node\": \"reducedimension1\"}, \"label\": \"snow_map\", \"name\": \"band\", \"type\": \"bands\"}}, \"reducedimension2\": {\"process_id\": \"reduce_dimension\", \"arguments\": {\"data\": {\"from_node\": \"mergecubes1\"}, \"dimension\": \"band\", \"reducer\": {\"process_graph\": {\"arrayelement3\": {\"process_id\": \"array_element\", \"arguments\": {\"data\": {\"from_parameter\": \"data\"}, \"index\": 2}}, \"eq1\": {\"process_id\": \"eq\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement3\"}, \"y\": 8}}, \"eq2\": {\"process_id\": \"eq\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement3\"}, \"y\": 9}}, \"or1\": {\"process_id\": \"or\", \"arguments\": {\"x\": {\"from_node\": \"eq1\"}, \"y\": {\"from_node\": \"eq2\"}}}, \"eq3\": {\"process_id\": \"eq\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement3\"}, \"y\": 3}}, \"or2\": {\"process_id\": \"or\", \"arguments\": {\"x\": {\"from_node\": \"or1\"}, \"y\": {\"from_node\": \"eq3\"}}, \"result\": true}}}}}, \"adddimension2\": {\"process_id\": \"add_dimension\", \"arguments\": {\"data\": {\"from_node\": \"reducedimension2\"}, \"label\": \"cloud_mask\", \"name\": \"band\", \"type\": \"bands\"}}, \"mask1\": {\"process_id\": \"mask\", \"arguments\": {\"data\": {\"from_node\": \"adddimension1\"}, \"mask\": {\"from_node\": \"adddimension2\"}, \"replacement\": 2}, \"result\": true}}}}</script>\n    </openeo-model-builder>\n    ","content_type":"text/html"},"text/plain":{"content":"<openeo.rest.datacube.DataCube at 0x7f7f938567d0>","content_type":"text/plain"}}},"children":[],"key":"wPwDE04zmw"}],"key":"DVG4vqrPRF"}],"key":"zxmdeQarKb"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize one time step of the timeseries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HvW7INRzDf"}],"identifier":"visualize-one-time-step-of-the-timeseries","label":"Visualize one time step of the timeseries","html_id":"visualize-one-time-step-of-the-timeseries","implicit":true,"key":"ajlv5Evg2R"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Let’s create the lazy xarray view of the result and look how our first results look like","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"hmr3JoHWx8"}],"key":"FqdHoKUFGO"}],"key":"dTNGA4iYod"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"snowmap_cloudfree_1d = snowmap_cloudfree.filter_temporal('2018-02-10', '2018-02-12').mask_polygon(catchment_outline[\"geometry\"][0])\nsnowmap_cloudfree_1d_xr = snowmap_cloudfree_1d.execute()","key":"uscjQ48TaI"},{"type":"outputs","id":"9EiXvEfqBMmi3B1FvACPi","children":[],"key":"b0qiqI9gf1"}],"key":"jcVrESbIFs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"snowmap_cloudfree_1d_xr[0,0].plot.imshow()","key":"wljtHSThMM"},{"type":"outputs","id":"pnAaUd3V9izktCGGWuO9u","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8cbc6970f25181580ea73414c22fdddf","path":"/cubes-and-clouds/build/8cbc6970f25181580ea73414c22fdddf.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"MVTWGs9cPr"}],"key":"wgfS6TEUKE"}],"key":"iSyJdnCfl9"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Calculate Catchment Statistics","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cNvxbsMZsN"}],"identifier":"calculate-catchment-statistics","label":"Calculate Catchment Statistics","html_id":"calculate-catchment-statistics","implicit":true,"key":"wAOCnRaccl"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We are looking at a region over time. We need to make sure that the information content meets our expected quality. Therefore, we calculate the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"M7WuQmVlRb"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"cloud percentage","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XfA67QtTlf"}],"key":"Z8eN30zuX6"},{"type":"text","value":" for the catchment for each timestep. We use this information to filter the timeseries. All timesteps that have a cloud coverage of over 25% will be discarded.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YwU0dCt01i"}],"key":"uKxcM4qf5x"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Ultimately we are interested in the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"n9rUz0t9OD"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"snow covered area (SCA)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aPzim4AWw4"}],"key":"VvdWm0obph"},{"type":"text","value":" within the catchment. We count all snow covered pixels within the catchment for each time step. Multiplied by the pixel size that would be the snow covered area. Divided the pixel count by the total number of pixels in the catchment is the percentage of pixels covered with snow. We will use this number.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"sTKMCOYnwk"}],"key":"Z974Mqrx04"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Get number of pixels in catchment: total, clouds, snow.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ZvPLTynN9P"}],"key":"D4sJUaARrg"}],"key":"sChAGviTsE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"snow_cloud_map_0 = (snowmap_cloudfree == 1).merge_cubes(cloud_mask)\nsnow_cloud_map = (ndsi_mask > -1).add_dimension(name=\"band\",label=\"valid_px\",type=\"bands\").merge_cubes(snow_cloud_map_0)","key":"SRk4FENtPF"},{"type":"outputs","id":"PF5XkW3c_G0YRRC9rwEIF","children":[],"key":"LaOTgNVf6I"}],"key":"SdE2SJpxAj"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Aggregate to catchment using the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ttPJ8LWkMe"},{"type":"inlineCode","value":"aggregate_spatial","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nCLlssDUcE"},{"type":"text","value":" process.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LJzE3bVRpQ"}],"key":"NPcHmCwgfL"}],"key":"G8YcGmB1PU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"snow_cloud_map_timeseries = snow_cloud_map.aggregate_spatial(geometries=catchment_outline[\"geometry\"][0],reducer=\"sum\")\nsnow_cloud_map_timeseries","key":"hqGxz9PJLE"},{"type":"outputs","id":"l4aBzoaeiZLw6MaLl769L","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":21,"metadata":{},"data":{"text/html":{"content":"\n    <script>\n    if (!window.customElements || !window.customElements.get('openeo-model-builder')) {\n        var el = document.createElement('script');\n        el.src = \"https://cdn.jsdelivr.net/npm/@openeo/vue-components@2/assets/openeo.min.js\";\n        document.head.appendChild(el);\n\n        var font = document.createElement('font');\n        font.as = \"font\";\n        font.type = \"font/woff2\";\n        font.crossOrigin = true;\n        font.href = \"https://use.fontawesome.com/releases/v5.13.0/webfonts/fa-solid-900.woff2\"\n        document.head.appendChild(font);\n    }\n    </script>\n    <openeo-model-builder>\n        <script type=\"application/json\">{\"id\": \"fba5f87d0b154c5e99d465d08dda06bb\", \"explicit-zoom\": true, \"height\": \"400px\", \"value\": {\"process_graph\": {\"loadstac1\": {\"process_id\": \"load_stac\", \"arguments\": {\"bands\": [\"B03\"], \"properties\": {\"eo:cloud_cover\": {\"lt\": 75}, \"s2:mgrs_tile\": {\"eq\": \"32TPS\"}}, \"spatial_extent\": {\"west\": 11.020833333333357, \"east\": 11.366666666666694, \"south\": 46.653599378797765, \"north\": 46.954166666666694}, \"temporal_extent\": [\"2018-02-01\", \"2018-06-30\"], \"url\": \"https://planetarycomputer.microsoft.com/api/stac/v1/collections/sentinel-2-l2a\"}}, \"loadstac2\": {\"process_id\": \"load_stac\", \"arguments\": {\"bands\": [\"B11\", \"SCL\"], \"properties\": {\"eo:cloud_cover\": {\"lt\": 75}, \"s2:mgrs_tile\": {\"eq\": \"32TPS\"}}, \"spatial_extent\": {\"west\": 11.020833333333357, \"east\": 11.366666666666694, \"south\": 46.653599378797765, \"north\": 46.954166666666694}, \"temporal_extent\": [\"2018-02-01\", \"2018-06-30\"], \"url\": \"https://planetarycomputer.microsoft.com/api/stac/v1/collections/sentinel-2-l2a\"}}, \"resamplecubespatial1\": {\"process_id\": \"resample_cube_spatial\", \"arguments\": {\"data\": {\"from_node\": \"loadstac1\"}, \"method\": \"average\", \"target\": {\"from_node\": \"loadstac2\"}}}, \"mergecubes1\": {\"process_id\": \"merge_cubes\", \"arguments\": {\"cube1\": {\"from_node\": \"resamplecubespatial1\"}, \"cube2\": {\"from_node\": \"loadstac2\"}}}, \"reducedimension1\": {\"process_id\": \"reduce_dimension\", \"arguments\": {\"data\": {\"from_node\": \"mergecubes1\"}, \"dimension\": \"band\", \"reducer\": {\"process_graph\": {\"arrayelement1\": {\"process_id\": \"array_element\", \"arguments\": {\"data\": {\"from_parameter\": \"data\"}, \"index\": 0}}, \"arrayelement2\": {\"process_id\": \"array_element\", \"arguments\": {\"data\": {\"from_parameter\": \"data\"}, \"index\": 1}}, \"subtract1\": {\"process_id\": \"subtract\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement1\"}, \"y\": {\"from_node\": \"arrayelement2\"}}}, \"add1\": {\"process_id\": \"add\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement1\"}, \"y\": {\"from_node\": \"arrayelement2\"}}}, \"divide1\": {\"process_id\": \"divide\", \"arguments\": {\"x\": {\"from_node\": \"subtract1\"}, \"y\": {\"from_node\": \"add1\"}}}, \"gt1\": {\"process_id\": \"gt\", \"arguments\": {\"x\": {\"from_node\": \"divide1\"}, \"y\": 0.42}}, \"gt2\": {\"process_id\": \"gt\", \"arguments\": {\"x\": {\"from_node\": \"gt1\"}, \"y\": -1}, \"result\": true}}}}}, \"adddimension1\": {\"process_id\": \"add_dimension\", \"arguments\": {\"data\": {\"from_node\": \"reducedimension1\"}, \"label\": \"valid_px\", \"name\": \"band\", \"type\": \"bands\"}}, \"reducedimension2\": {\"process_id\": \"reduce_dimension\", \"arguments\": {\"data\": {\"from_node\": \"mergecubes1\"}, \"dimension\": \"band\", \"reducer\": {\"process_graph\": {\"arrayelement3\": {\"process_id\": \"array_element\", \"arguments\": {\"data\": {\"from_parameter\": \"data\"}, \"index\": 0}}, \"arrayelement4\": {\"process_id\": \"array_element\", \"arguments\": {\"data\": {\"from_parameter\": \"data\"}, \"index\": 1}}, \"subtract2\": {\"process_id\": \"subtract\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement3\"}, \"y\": {\"from_node\": \"arrayelement4\"}}}, \"add2\": {\"process_id\": \"add\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement3\"}, \"y\": {\"from_node\": \"arrayelement4\"}}}, \"divide2\": {\"process_id\": \"divide\", \"arguments\": {\"x\": {\"from_node\": \"subtract2\"}, \"y\": {\"from_node\": \"add2\"}}}, \"gt3\": {\"process_id\": \"gt\", \"arguments\": {\"x\": {\"from_node\": \"divide2\"}, \"y\": 0.42}, \"result\": true}}}}}, \"adddimension2\": {\"process_id\": \"add_dimension\", \"arguments\": {\"data\": {\"from_node\": \"reducedimension2\"}, \"label\": \"snow_map\", \"name\": \"band\", \"type\": \"bands\"}}, \"reducedimension3\": {\"process_id\": \"reduce_dimension\", \"arguments\": {\"data\": {\"from_node\": \"mergecubes1\"}, \"dimension\": \"band\", \"reducer\": {\"process_graph\": {\"arrayelement5\": {\"process_id\": \"array_element\", \"arguments\": {\"data\": {\"from_parameter\": \"data\"}, \"index\": 2}}, \"eq1\": {\"process_id\": \"eq\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement5\"}, \"y\": 8}}, \"eq2\": {\"process_id\": \"eq\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement5\"}, \"y\": 9}}, \"or1\": {\"process_id\": \"or\", \"arguments\": {\"x\": {\"from_node\": \"eq1\"}, \"y\": {\"from_node\": \"eq2\"}}}, \"eq3\": {\"process_id\": \"eq\", \"arguments\": {\"x\": {\"from_node\": \"arrayelement5\"}, \"y\": 3}}, \"or2\": {\"process_id\": \"or\", \"arguments\": {\"x\": {\"from_node\": \"or1\"}, \"y\": {\"from_node\": \"eq3\"}}, \"result\": true}}}}}, \"adddimension3\": {\"process_id\": \"add_dimension\", \"arguments\": {\"data\": {\"from_node\": \"reducedimension3\"}, \"label\": \"cloud_mask\", \"name\": \"band\", \"type\": \"bands\"}}, \"mask1\": {\"process_id\": \"mask\", \"arguments\": {\"data\": {\"from_node\": \"adddimension2\"}, \"mask\": {\"from_node\": \"adddimension3\"}, \"replacement\": 2}}, \"apply1\": {\"process_id\": \"apply\", \"arguments\": {\"data\": {\"from_node\": \"mask1\"}, \"process\": {\"process_graph\": {\"eq4\": {\"process_id\": \"eq\", \"arguments\": {\"x\": {\"from_parameter\": \"x\"}, \"y\": 1}, \"result\": true}}}}}, \"mergecubes2\": {\"process_id\": \"merge_cubes\", \"arguments\": {\"cube1\": {\"from_node\": \"apply1\"}, \"cube2\": {\"from_node\": \"adddimension3\"}}}, \"mergecubes3\": {\"process_id\": \"merge_cubes\", \"arguments\": {\"cube1\": {\"from_node\": \"adddimension1\"}, \"cube2\": {\"from_node\": \"mergecubes2\"}}}, \"aggregatespatial1\": {\"process_id\": \"aggregate_spatial\", \"arguments\": {\"data\": {\"from_node\": \"mergecubes3\"}, \"geometries\": {\"type\": \"Polygon\", \"coordinates\": [[[11.075, 46.72916666666669], [11.072575547960094, 46.728813340928845], [11.069091118706622, 46.72535332573787], [11.048285590277802, 46.724646674262175], [11.042024739583358, 46.73087632921009], [11.041666666666691, 46.733333333333356], [11.038123575846377, 46.73424241807728], [11.0375, 46.74583333333336], [11.03664923773874, 46.74914923773874], [11.030017428927975, 46.75085076226131], [11.028599378797768, 46.756377156575546], [11.025567287868947, 46.76028951009117], [11.0244327121311, 46.76471048990888], [11.02140062120228, 46.7686228434245], [11.020833333333357, 46.77083333333336], [11.024291653103322, 46.77172071668839], [11.025567287868947, 46.781377156575545], [11.032766045464435, 46.78945617675784], [11.033900621202282, 46.79387715657555], [11.036932712131101, 46.79778951009117], [11.038067287868948, 46.80221048990888], [11.042586263020858, 46.80762905544707], [11.052210489908878, 46.808900621202284], [11.06028951009117, 46.816099378797766], [11.06471048990888, 46.81723395453562], [11.068622843424503, 46.820266045464436], [11.073043823242212, 46.82140062120228], [11.077974107530407, 46.82522176106773], [11.079733954535614, 46.83010389539933], [11.071295166015648, 46.83957451714412], [11.0744327121311, 46.843622843424505], [11.075567287868948, 46.846579996744815], [11.071400621202281, 46.85195617675784], [11.070266045464434, 46.859321424696205], [11.082766045464435, 46.872789510091174], [11.084041680230058, 46.882445949978326], [11.089710489908878, 46.88390062120228], [11.09995964898006, 46.89319695366756], [11.096400621202282, 46.89778951009117], [11.095266045464435, 46.91343722873266], [11.103599378797767, 46.92278951009117], [11.104166666666691, 46.929166666666696], [11.114924452039954, 46.92951999240454], [11.11875, 46.9333187527127], [11.12328694661461, 46.92881334092885], [11.139924452039956, 46.92951999240454], [11.143408881293428, 46.93298000759551], [11.148288302951414, 46.933691067165825], [11.157980007595512, 46.94340888129343], [11.158691406250025, 46.948290337456626], [11.16424221462676, 46.953813340928846], [11.166666666666693, 46.954166666666694], [11.167024739583358, 46.95170966254343], [11.172575547960095, 46.94618665907121], [11.177424452039956, 46.94548000759551], [11.180908881293428, 46.94201999240454], [11.185757785373289, 46.94131334092884], [11.189242214626761, 46.937853325737876], [11.194123670789956, 46.93714192708336], [11.199646674262178, 46.93159111870662], [11.200353325737872, 46.9100755479601], [11.204519992404538, 46.90587972005211], [11.203813340928845, 46.901742214626765], [11.199646674262178, 46.89754638671877], [11.200353325737872, 46.89340888129343], [11.203813340928845, 46.889924452039956], [11.204519992404538, 46.8850755479601], [11.21248609754777, 46.877084011501765], [11.208686659071207, 46.87325778537329], [11.208333333333359, 46.85833333333336], [11.210543823242213, 46.85776604546444], [11.214456176757839, 46.85473395453562], [11.231377156575547, 46.85359937879777], [11.239456176757837, 46.846400621202285], [11.260543823242212, 46.845266045464435], [11.26458333333336, 46.84213528103301], [11.26875, 46.84536471896704], [11.272789510091172, 46.842233954535615], [11.323043823242214, 46.84109937879777], [11.331122843424506, 46.83390062120228], [11.343877156575548, 46.83276604546444], [11.347789510091172, 46.82973395453561], [11.35331590440541, 46.82831590440541], [11.354733954535616, 46.82278951009117], [11.357766045464437, 46.818877156575546], [11.358900621202284, 46.81445617675784], [11.36609937879777, 46.80637715657554], [11.366666666666694, 46.80416666666669], [11.365779283311658, 46.80070834689673], [11.356122843424506, 46.7994327121311], [11.35208333333336, 46.796301947699675], [11.347916666666693, 46.799531385633706], [11.343877156575548, 46.79640062120228], [11.339456176757839, 46.79526604546444], [11.335543823242213, 46.79223395453562], [11.321806165907145, 46.79101189507381], [11.31306728786895, 46.781377156575545], [11.311932712131103, 46.776956176757835], [11.304733954535617, 46.76887715657555], [11.30359937879777, 46.76445617675784], [11.30056728786895, 46.760543823242216], [11.299149237738742, 46.75501742892798], [11.293622843424505, 46.753599378797766], [11.289710489908881, 46.75056728786895], [11.279166666666693, 46.75], [11.278813340928846, 46.73924221462676], [11.27464667426218, 46.73504638671878], [11.275353325737873, 46.73090888129343], [11.283319430881102, 46.722917344835096], [11.27951999240454, 46.71909111870662], [11.278813340928846, 46.705908881293425], [11.275353325737873, 46.702424452039956], [11.275, 46.7], [11.274032253689262, 46.69622938368058], [11.267413330078151, 46.691099378797766], [11.260289510091171, 46.69223395453562], [11.25491333007815, 46.69640062120228], [11.251956176757838, 46.695266045464436], [11.248043823242213, 46.69223395453562], [11.239456176757837, 46.691099378797766], [11.235543823242214, 46.68806728786895], [11.218622843424505, 46.6869327121311], [11.21471048990888, 46.683900621202284], [11.197789510091171, 46.68276604546443], [11.193877156575546, 46.679733954535614], [11.184220716688394, 46.67845831976999], [11.182413736979193, 46.671416219075546], [11.173043823242214, 46.66306728786895], [11.168622843424505, 46.6619327121311], [11.159270562065997, 46.653599378797765], [11.154985215928845, 46.655143907335095], [11.154166666666692, 46.65833333333336], [11.15085076226131, 46.65918409559464], [11.15, 46.6625], [11.150353325737871, 46.66909111870662], [11.155876329210095, 46.67464192708336], [11.160757785373288, 46.67535332573787], [11.166668023003497, 46.68123406304256], [11.162853325737872, 46.685075547960096], [11.162146674262178, 46.68992445203995], [11.15451999240454, 46.69757554796009], [11.153813340928846, 46.702424452039956], [11.148290337456622, 46.70797526041669], [11.143408881293428, 46.708686659071205], [11.139924452039956, 46.71214667426218], [11.122575547960095, 46.712853325737875], [11.119091118706622, 46.71631334092884], [11.11424221462676, 46.71701999240454], [11.110757785373288, 46.72048000759551], [11.10174221462676, 46.72118665907121], [11.098257785373288, 46.724646674262175], [11.085075547960095, 46.72535332573787], [11.081591118706623, 46.728813340928845], [11.075, 46.72916666666669]]]}, \"reducer\": {\"process_graph\": {\"sum1\": {\"process_id\": \"sum\", \"arguments\": {\"data\": {\"from_parameter\": \"data\"}}, \"result\": true}}}}, \"result\": true}}}}</script>\n    </openeo-model-builder>\n    ","content_type":"text/html"},"text/plain":{"content":"<openeo.rest.vectorcube.VectorCube at 0x7f7f93558b50>","content_type":"text/plain"}}},"children":[],"key":"gyiB6ByYeZ"}],"key":"Ty7T4k5p5g"}],"key":"i3Lh5Ip2j0"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Get the result as a Dask based xArray object","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kG5nSp4zTx"}],"key":"TciQs8w42n"}],"key":"D9P6eloDg2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"snow_cloud_map_timeseries_xr = snow_cloud_map_timeseries.execute()\nsnow_cloud_map_timeseries_xr","key":"kKk6oBiG1J"},{"type":"outputs","id":"tMV7Wea45IL8_VjZCQo2Y","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"Did not load machine learning processes due to missing dependencies: Install them like this: `pip install openeo-processes-dask[implementations, ml]`\n"},"children":[],"key":"Y8iDu7wyM6"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":22,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"2db16072755b6116dfbb95ceed0ef81e","path":"/cubes-and-clouds/build/2db16072755b6116dfbb95ceed0ef81e.html"},"text/plain":{"content":"<xarray.DataArray (geometry: 1, band: 3, time: 32)> Size: 768B\ndask.array<broadcast_to, shape=(1, 3, 32), dtype=float64, chunksize=(1, 1, 1), chunktype=numpy.ndarray>\nCoordinates: (12/46)\n  * time                                     (time) datetime64[ns] 256B 2018-...\n  * band                                     (band) <U10 120B 'valid_px' ... ...\n    id                                       (time) <U54 7kB 'S2A_MSIL2A_2018...\n    s2:not_vegetated_percentage              (time) float64 256B 0.8429 ... 8...\n    s2:cloud_shadow_percentage               (time) float64 256B 0.84 ... 1.406\n    s2:granule_id                            (time) <U62 8kB 'S2A_OPER_MSI_L2...\n    ...                                       ...\n    common_name                              <U5 20B 'green'\n    center_wavelength                        float64 8B 0.56\n    full_width_half_max                      float64 8B 0.045\n    epsg                                     int64 8B 32632\n    spatial_ref                              int64 8B 0\n  * geometry                                 (geometry) object 8B POLYGON ((6...\nIndexes:\n    geometry  GeometryIndex (crs=EPSG:32632)\nAttributes:\n    crs:                            epsg:32632\n    reduced_dimensions_min_values:  {'band': 'B03'}","content_type":"text/plain"}}},"children":[],"key":"BJGy6Tux67"}],"key":"WUoVoD6839"}],"key":"boQFRxW2nq"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Compute the result. Please note, this will trigger the download and processing of the requested data.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oSeUi4iAhf"}],"key":"Vicrp5oTrF"}],"key":"TvYdIOrlRz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"snow_cloud_map_timeseries_xr = snow_cloud_map_timeseries_xr.compute()","key":"zU3UeFx9YQ"},{"type":"outputs","id":"S4yNrR5C1paeB2FU2pwlu","children":[],"key":"GHTRvJLJfD"}],"key":"eCmPmaG5I0"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"snow_cloud_map_timeseries_xr","key":"KRgmSarPD1"},{"type":"outputs","id":"P0_GheG2ZTR1ev96XwcCP","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":24,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"bb7a883518d28cc8dac4543e8472c3e9","path":"/cubes-and-clouds/build/bb7a883518d28cc8dac4543e8472c3e9.html"},"text/plain":{"content":"<xarray.DataArray (geometry: 1, band: 3, time: 32)> Size: 768B\narray([[[1039875., 1039875., 1039875., 1039875., 1039875., 1039875.,\n         1039875., 1039875., 1039875., 1039875., 1039875., 1039875.,\n         1039875., 1039875., 1039875., 1039875., 1039875., 1039875.,\n         1039875., 1039875., 1039875., 1039875., 1039875., 1039875.,\n         1039875., 1039875., 1039875., 1039875., 1039875., 1039875.,\n         1039875., 1039875.],\n        [ 721108.,  746324.,  505519.,  666087.,  574287.,  717432.,\n          181569.,  341945.,  447801.,  276157.,  683636.,  444741.,\n          737500.,  589989.,  449066.,  113861.,  689327.,  654874.,\n          670597.,  553375.,  576242.,  535398.,  428109.,  173667.,\n           65467.,   11728.,    2120.,   59170.,   20304.,   16569.,\n           33761.,   13923.],\n        [  43282.,   50500.,  265340.,   99748.,  190841.,   60625.,\n          678521.,  456600.,  320558.,  656121.,  200369.,  525781.,\n           66535.,  170522.,  268273.,  877061.,   23772.,   49337.,\n           58783.,  171374.,   27758.,   27322.,  155250.,  518898.,\n          558722.,  676188.,  912866.,   27335.,  472718.,  403790.,\n           25324.,  248254.]]])\nCoordinates: (12/46)\n  * time                                     (time) datetime64[ns] 256B 2018-...\n  * band                                     (band) <U10 120B 'valid_px' ... ...\n    id                                       (time) <U54 7kB 'S2A_MSIL2A_2018...\n    s2:not_vegetated_percentage              (time) float64 256B 0.8429 ... 8...\n    s2:cloud_shadow_percentage               (time) float64 256B 0.84 ... 1.406\n    s2:granule_id                            (time) <U62 8kB 'S2A_OPER_MSI_L2...\n    ...                                       ...\n    common_name                              <U5 20B 'green'\n    center_wavelength                        float64 8B 0.56\n    full_width_half_max                      float64 8B 0.045\n    epsg                                     int64 8B 32632\n    spatial_ref                              int64 8B 0\n  * geometry                                 (geometry) object 8B POLYGON ((6...\nIndexes:\n    geometry  GeometryIndex (crs=EPSG:32632)\nAttributes:\n    crs:                            epsg:32632\n    reduced_dimensions_min_values:  {'band': 'B03'}","content_type":"text/plain"}}},"children":[],"key":"VGtzT8xEsQ"}],"key":"CnXkKoVCgq"}],"key":"bqAF3p1fjD"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot the timeseries and the cloud threshold of 25%. If the cloud cover is higher the timestep will be excluded later on.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JRyI23uwKG"}],"key":"GybaR8ZeoI"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Plot the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"L8t1maQChS"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"cloud percentage","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ITdBnNyF23"}],"key":"kkkiUpw6Nd"},{"type":"text","value":" with the threshold.s","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WAVxxpRvNc"}],"key":"KC2LizqBLQ"}],"key":"ZhiuvzjcAu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cloud_percent = (snow_cloud_map_timeseries_xr.loc[dict(band=\"cloud_mask\")] / snow_cloud_map_timeseries_xr.loc[dict(band=\"valid_px\")]) * 100\ncloud_percent.plot(marker='o')\n# plot the cloud percentage and a threshold\nplt.axhline(y = 25, color = \"r\", linestyle = \"-\")\nplt.show()","key":"TUCRDyolNI"},{"type":"outputs","id":"XglSoQufSm5Eqd6OShA4q","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"997863bea2777317b35f7be0cdacec1e","path":"/cubes-and-clouds/build/997863bea2777317b35f7be0cdacec1e.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"xbRjcvtp9U"}],"key":"GKb9mM08VI"}],"key":"iRP1qUozpP"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FZ9igFAx8r"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"unfiltered snow percentage","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xt8f8HnKaU"}],"key":"WSndT5TmDa"}],"key":"aQHoS4dMu5"}],"key":"CclDM4Mah2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"snow_percent = (snow_cloud_map_timeseries_xr.loc[dict(band=\"snow_map\")] / snow_cloud_map_timeseries_xr.loc[dict(band=\"valid_px\")]) * 100\nsnow_percent.plot(marker='o')\nplt.show()","key":"o5HN1B0jwh"},{"type":"outputs","id":"Ihd24MgDLjsxlQw8v5YvK","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"af1e8463033013125928ae7b60513dac","path":"/cubes-and-clouds/build/af1e8463033013125928ae7b60513dac.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"nhPZ187VYc"}],"key":"AHB0sXqyim"}],"key":"COxquxoLpH"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Keep only the dates with cloud coverage less than the threshold","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GhqIP4zFjZ"}],"key":"uq3xShaNTp"}],"key":"Stx95z5HAp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"snow_percent = snow_percent.where(cloud_percent<25,drop=True)","key":"DWoqVLIVXv"},{"type":"outputs","id":"r4m20lQM666-bjtMxRzwi","children":[],"key":"q6ZAs6kJvA"}],"key":"GrIUKbwjwM"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dwTwr6kENw"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"cloud filtered snow percentage","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pUahLzWtiv"}],"key":"gCXvBkN2Sq"}],"key":"OGR6abiv4O"}],"key":"HVlEy0hN1w"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"snow_percent.plot(marker='o')\nplt.show()","key":"ZbhxNEbD5k"},{"type":"outputs","id":"1-QchNc6nXKUeTS7697H6","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b0300e6a1d5c8cb147f8cd816c223816","path":"/cubes-and-clouds/build/b0300e6a1d5c8cb147f8cd816c223816.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"QVinhnoFAc"}],"key":"bnOezL31ka"}],"key":"Iihhjg9XZH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Compare to discharge data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KM9d20iIza"}],"identifier":"compare-to-discharge-data","label":"Compare to discharge data","html_id":"compare-to-discharge-data","implicit":true,"key":"qxTg26mYO0"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Load the discharge data at Meran. The main outlet of the catchment.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UJ3cfO1jaf"}],"key":"zk0LNTmdon"}],"key":"PaJZOtlxUj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"discharge_ds = pd.read_csv('../../../3.2_validation/exercises/32_data/ADO_DSC_ITH1_0025.csv', sep=',', index_col='Time', parse_dates=True)\ndischarge_ds.head()","key":"EvoQ2PCtr7"},{"type":"outputs","id":"eYuwhaBbTfmVW2gpPONBg","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":30,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>discharge_m3_s</th>\n    </tr>\n    <tr>\n      <th>Time</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1994-01-01 01:00:00</th>\n      <td>4.03</td>\n    </tr>\n    <tr>\n      <th>1994-01-02 01:00:00</th>\n      <td>3.84</td>\n    </tr>\n    <tr>\n      <th>1994-01-03 01:00:00</th>\n      <td>3.74</td>\n    </tr>\n    <tr>\n      <th>1994-01-04 01:00:00</th>\n      <td>3.89</td>\n    </tr>\n    <tr>\n      <th>1994-01-05 01:00:00</th>\n      <td>3.80</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"                     discharge_m3_s\nTime                               \n1994-01-01 01:00:00            4.03\n1994-01-02 01:00:00            3.84\n1994-01-03 01:00:00            3.74\n1994-01-04 01:00:00            3.89\n1994-01-05 01:00:00            3.80","content_type":"text/plain"}}},"children":[],"key":"Y97X5cnlr2"}],"key":"ZdaHSiEgcZ"}],"key":"Sua5lrmmTJ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Compare the discharge data to the snow covered area.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iMnu7OAi9w"}],"key":"A5lzKszZ4g"}],"key":"u93N96SI72"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig,ax0 = plt.subplots(1, figsize=(10,5),sharey=True)\nax1 = ax0.twinx() \n\nstart_date = date(2018, 2, 1)\nend_date = date(2018, 6, 30)\n# filter discharge data to start and end dates\ndischarge_ds = discharge_ds.loc[start_date:end_date]\n\ndischarge_ds.discharge_m3_s.plot(label='Discharge', xlabel='', ylabel='Discharge (m$^3$/s)',ax=ax0)\nsnow_percent.plot(marker='o',ax=ax1,color='orange')\nax0.legend(loc='center left', bbox_to_anchor=(0, 0.6))\nax1.set_ylabel('Snow cover area (%)')\nax1.legend(loc='center left', bbox_to_anchor=(0, 0.5),labels=['SCA'])\nplt.show()","key":"nmjC7WCnqD"},{"type":"outputs","id":"-UMt0pE0zgXyyb-XDbv_q","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"cc3f863bd13fffa27e7a076e9c34f544","path":"/cubes-and-clouds/build/cc3f863bd13fffa27e7a076e9c34f544.png"},"text/plain":{"content":"<Figure size 1000x500 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"Ku0ReWNYuG"}],"key":"Z6FOmlEXiA"}],"key":"EQV9krh8LL"}],"key":"JKFdxtm0Zg"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"3.1 Data Processing","url":"/lectures/data-processing/exercises/data-processing-pangeo","group":"Process & Share"},"next":{"title":"3.1 Data Processing","url":"/lectures/data-processing/exercises/alternatives/data-processing-openeo-platform","group":"Process & Share"}}},"domain":"http://localhost:3000"}